import{u as D,T as O,Q as C,aa as $,Z as B}from"./connector-16147cef.js";import{bG as E,bH as z,av as K,bI as j,aZ as V}from"./BalBtn-cca6788c.js";import{g as Y,i as q,b as Z,P as G,p as L}from"./api-e32fdf3d.js";import{t as Q}from"./usePoolHelpers-eb955974.js";import{b as H}from"./balancer-api.service-037872f8.js";import{b as U}from"./pools-18fd7fb0.js";import{C as J,ah as W}from"./runtime-core.esm-bundler-558f8953.js";function I(){return{onFetch:e=>{e.fetchFn=()=>{var t,o,h,b,F,w;const m=(t=e.fetchOptions)==null||(o=t.meta)==null?void 0:o.refetchPage,d=(h=e.fetchOptions)==null||(b=h.meta)==null?void 0:b.fetchMore,P=d==null?void 0:d.pageParam,R=(d==null?void 0:d.direction)==="forward",N=(d==null?void 0:d.direction)==="backward",l=((F=e.state.data)==null?void 0:F.pages)||[],v=((w=e.state.data)==null?void 0:w.pageParams)||[];let p=v,x=!1;const a=i=>{Object.defineProperty(i,"signal",{enumerable:!0,get:()=>{var f;if((f=e.signal)!=null&&f.aborted)x=!0;else{var c;(c=e.signal)==null||c.addEventListener("abort",()=>{x=!0})}return e.signal}})},n=e.options.queryFn||(()=>Promise.reject("Missing queryFn")),s=(i,f,c,y)=>(p=y?[f,...p]:[...p,f],y?[c,...i]:[...i,c]),r=(i,f,c,y)=>{if(x)return Promise.reject("Cancelled");if(typeof c>"u"&&!f&&i.length)return Promise.resolve(i);const S={queryKey:e.queryKey,pageParam:c,meta:e.options.meta};a(S);const A=n(S);return Promise.resolve(A).then(M=>s(i,c,M,y))};let u;if(!l.length)u=r([]);else if(R){const i=typeof P<"u",f=i?P:_(e.options,l);u=r(l,i,f)}else if(N){const i=typeof P<"u",f=i?P:T(e.options,l);u=r(l,i,f,!0)}else{p=[];const i=typeof e.options.getNextPageParam>"u";u=(m&&l[0]?m(l[0],0,l):!0)?r([],i,v[0]):Promise.resolve(s([],v[0],l[0]));for(let c=1;c<l.length;c++)u=u.then(y=>{if(m&&l[c]?m(l[c],c,l):!0){const A=i?v[c]:_(e.options,y);return r(y,i,A)}return Promise.resolve(s(y,v[c],l[c]))})}return u.then(i=>({pages:i,pageParams:p}))}}}}function _(e,t){return e.getNextPageParam==null?void 0:e.getNextPageParam(t[t.length-1],t)}function T(e,t){return e.getPreviousPageParam==null?void 0:e.getPreviousPageParam(t[0],t)}function X(e,t){if(e.getNextPageParam&&Array.isArray(t)){const o=_(e,t);return typeof o<"u"&&o!==null&&o!==!1}}function ee(e,t){if(e.getPreviousPageParam&&Array.isArray(t)){const o=T(e,t);return typeof o<"u"&&o!==null&&o!==!1}}class te extends E{constructor(t,o){super(t,o)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,o){super.setOptions({...t,behavior:I()},o)}getOptimisticResult(t){return t.behavior=I(),super.getOptimisticResult(t)}fetchNextPage({pageParam:t,...o}={}){return this.fetch({...o,meta:{fetchMore:{direction:"forward",pageParam:t}}})}fetchPreviousPage({pageParam:t,...o}={}){return this.fetch({...o,meta:{fetchMore:{direction:"backward",pageParam:t}}})}createResult(t,o){var h,b,F,w,m,d;const{state:P}=t,R=super.createResult(t,o),{isFetching:N,isRefetching:l}=R,v=N&&((h=P.fetchMeta)==null||(b=h.fetchMore)==null?void 0:b.direction)==="forward",p=N&&((F=P.fetchMeta)==null||(w=F.fetchMore)==null?void 0:w.direction)==="backward";return{...R,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:X(o,(m=P.data)==null?void 0:m.pages),hasPreviousPage:ee(o,(d=P.data)==null?void 0:d.pages),isFetchingNextPage:v,isFetchingPreviousPage:p,isRefetching:l&&!v&&!p}}}function re(e,t,o){const h=z(te,e,t,o);return{...h,fetchNextPage:h.fetchNextPage.value,fetchPreviousPage:h.fetchPreviousPage.value,refetch:h.refetch.value,remove:h.remove.value}}function le(e,t={enabled:!0},o=!0){const{injectTokens:h,tokens:b}=K(),{networkId:F}=D();let w=m();function m(){const a=Y();return new a(R(),{timeout:30*1e3})}function d(){return{fetch:async a=>{const n=await H.pools.get(N(a));if(o){const s=O.flatten(n.map(r=>[...r.tokensList,...Q(r.tokens),r.address]));h(s)}return n}}}function P(){return{fetch:async a=>{const n=await Z.pools.get(N(a)),s=new G(n);let r=await s.decorate(b.value);if(o){const u=O.flatten(n.map(g=>[...g.tokensList,...Q(g.tokens),g.address]));await h(u)}return r=await s.reCalculateTotalLiquidities(),r}}}function R(){const a=[];if(q){const s=d();a.push(s)}const n=P();return a.push(n),a}function N(a){const{tokens:n,poolIds:s,poolTypes:r,sortField:u,poolAttributes:g}=e.value,i=!!(s!=null&&s.length)&&(s==null?void 0:s.length)>0,f=!!(r!=null&&r.length),c=!!(g!=null&&g.length),y=e.value.useExactTokens?"eq":"contains",S=(n==null?void 0:n.map(M=>M.toLowerCase()))||[],A=q&&u||"totalLiquidity",k={chainId:C.network.chainId,orderBy:A,orderDirection:"desc",where:{tokensList:{[y]:S},poolType:{in:$.IncludedPoolTypes},totalShares:{gt:1e-5},id:{not_in:$.BlockList}}};return k.where&&f&&(r!=null&&r.length)&&(k.where.poolType={in:r}),k.where&&i&&(k.where.id={in:e.value.poolIds}),a.first&&(k.first=e.value.first||a.first),a.skip&&(k.skip=a.skip),k.where&&c&&g.includes(U.New)&&(k.where.createTime={gt:j(1)}),k}function l(a=0){const n={};return n.first=e.value.pageSize||$.Pagination.PerPage,a&&a>0&&(n.skip=a),n}function v(a){const n=e.value.sortField||"totalLiquidity";return n==="totalLiquidity"?a:n==="apr"?a.sort((s,r)=>{var i,f;const u=((i=s==null?void 0:s.apr)==null?void 0:i.max)??0;return(((f=r==null?void 0:r.apr)==null?void 0:f.max)??0)-u}):n==="volume"?a.sort((s,r)=>{const u=B((s==null?void 0:s.totalSwapVolume)??0);return B((r==null?void 0:r.totalSwapVolume)??0).minus(u).toNumber()}):a}J(e,()=>{w=m(),L.setPools([])},{deep:!0});const p=V.Pools.All(F,e),x=async({pageParam:a=0})=>{if(!t.enabled||W(t.enabled)&&!t.enabled.value)return{pools:[],skip:0};const n=l(a),s=(n.first||0)+(n.skip||0);try{let r=await w.fetch(n);return q||(r=v(r)),L.addPools(r),{pools:r,skip:s}}catch(r){const u=L.pools.value;if(u&&u.length>0)return{pools:u,skip:s};throw r}};return t.getNextPageParam=a=>a.skip||0,re(p,x,t)}export{re as a,I as i,le as u};
//# sourceMappingURL=usePoolsQuery-5de67548.js.map
