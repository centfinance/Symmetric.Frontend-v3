import{aU as H,bl as X,bj as $,b4 as J,aZ as ee,a_ as se,aW as te,aX as ae}from"./BalBtn-cca6788c.js";import{f as oe,W as ne,a as v}from"./useVeBAL-5fa15e49.js";import{U as re,ag as y,Z as q,c as ue,u as ie,o as G}from"./connector-16147cef.js";import{d as le}from"./index-155f0d25.js";import{L as ce}from"./liquidity-gauge-c56bdf84.js";import{u as t,aj as U,r as V,ak as de}from"./runtime-core.esm-bundler-558f8953.js";import{u as ge}from"./useVotingPools-44058ee3.js";function Te(s){const a=s.gauge.addedTimestamp;return a?le(Date.now(),a*X)<2:!1}function w(s,a){return s?!!s.some(r=>re(a,r)):!1}function p(s){return s.gauge.isKilled}function Le(s,a){return a?s.every(r=>w(a,r)):!1}function W(s){return s==="0"?"":y(q(s),-2).toString()}function Pe(s){return ue.from(y(s||"0",2).toString())}function ke(s,a){return a(y(q(s),-4).toString(),H.percent)}function xe(s){return s===""?"0.00":$(s,{minimumFractionDigits:2})}function Ge(){const s=Date.now()+ne;return oe(J(new Date(s)),"d LLLL y")}function S(s){return Number(s.userVotes)>0}function fe(s){const a=ce.getMulticaller();for(const r of s)a.call(`${G(r)}.isKilled`,G(r),"is_killed");return a.execute()}function me(s,a={}){const{networkId:r}=ie(),d=t(()=>{var n;return!!((n=s.value)!=null&&n.length)}),g=U(ee.Gauges.Expired(s,r));async function f(){var i;const n=[];if((i=s.value)!=null&&i.length){const c=await fe(s.value).catch(l=>(console.error("Error when fetching voting gauges is_killed status",{error:l}),[]));for(const[l,b]of Object.entries(c))b.isKilled&&n.push(l)}return Object.freeze(n.map(c=>c.toLowerCase()))}const h=U({enabled:d,...a});return se(g,f,h)}const u=V({}),E=V(!1),A=V(!1);function Ue(){A.value=!0,E.value=!1}function ve(){const s=V(!1),{votingPools:a,votingGaugeAddresses:r,isLoading:d}=ge(),{data:g,isLoading:f}=me(r),h=t(()=>f.value||d.value),n=t(()=>a.value.filter(e=>m.value.includes(e.gauge.address))),i=t(()=>n.value.filter(e=>!v(e.lastUserVoteTime))),c=t(()=>i.value.sort((e,o)=>parseFloat(u.value[e.gauge.address])-parseFloat(u.value[o.gauge.address]))),l=t(()=>c.value.map(e=>({gaugeAddress:e.gauge.address,weight:u.value[e.gauge.address]}))),b=t(()=>n.value.reduce((e,o)=>e+Number(W(o.userVotes)),0)),m=t(()=>Object.keys(u.value)),I=t(()=>m.value.length),N=t(()=>l.value.length>8),T=t(()=>Object.values(u.value).reduce((e,o)=>e+Number(o),0)),L=t(()=>T.value>100),O=t(()=>i.value.some(e=>u.value[e.gauge.address]!=""&&!x(e.gauge.address))),D=t(()=>!L.value&&(R.value||O.value)),F=t(()=>a.value.some(e=>S(e))),K=t(()=>i.value.some(e=>p(e))),R=t(()=>i.value.some(e=>p(e)&&S(e))),_=t(()=>n.value.some(e=>v(e.lastUserVoteTime))),B=t(()=>n.value.every(e=>v(e.lastUserVoteTime))&&b.value===100);function Q(e){if(k(e))return C(e);P(e)}function P(e){const o=e.gauge.address,Z=p(e)?"0":W(e.userVotes);u.value[o]=Z}function C(e){const o=e.gauge.address;delete u.value[o]}function k(e){return m.value.includes(e.gauge.address)}function x(e){return w(g.value,e)}function M(e){return p(e)||v(e.lastUserVoteTime)}function Y(e){E.value||(u.value={},e.forEach(o=>{S(o)&&P(o)}),E.value=!0,A.value=!1)}function z(){s.value=!0}return{expiredGauges:g,selectedGaugeAddresses:m,selectedPools:n,unlockedSelectedPools:i,votingRequest:u,isLoading:h,isLoadingExpiredGauges:f,isLoadingVotingPools:d,totalAllocatedWeight:T,isRequestingTooMuchWeight:L,isVotingRequestValid:D,totalSelectedGauges:I,hasSubmittedVotes:F,shouldBatchVotes:N,isSubmissionStep:s,hasExpiredPoolsSelected:K,hasAllVotingPowerTimeLocked:B,hasTimeLockedPools:_,confirmedVotingRequest:l,getIsGaugeExpired:x,toggleSelection:Q,isSelected:k,isInputDisabled:M,loadRequestWithExistingVotes:Y,goToSubmissionStep:z}}const j=Symbol(ae.Providers.Voting);function We(){const s=ve();return de(j,s),s}function qe(){return te(j)}export{qe as a,ke as b,w as c,A as d,Le as e,xe as f,Pe as g,S as h,Te as i,Ge as j,We as p,Ue as s,me as u,u as v};
//# sourceMappingURL=voting.provider-3f46e556.js.map
