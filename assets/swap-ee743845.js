var ft=Object.defineProperty;var gt=(e,t,a)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var He=(e,t,a)=>(gt(e,typeof t!="symbol"?t+"":t,a),a);import{_ as ht}from"./BalAccordion.vue_vue_type_script_setup_true_lang-a2418c88.js";import{a as Ja,_ as Oa}from"./MyWallet.vue_vue_type_script_setup_true_lang-df5bc616.js";import{au as Ye,av as Pe,aq as Ue,a_ as St,aZ as yt,ao as na,bn as ga,aS as We,aJ as Ce,aU as oe,b5 as ra,cE as Ka,aT as de,cG as _t,at as Ya,aw as Xa,b8 as Me,ba as Oe,az as bt,ay as kt,aQ as oa,cH as $a,b1 as At,b9 as Te,aP as Et,bb as La,b6 as Ia,ch as Tt,aA as ka}from"./BalBtn-cca6788c.js";import{c as Da,f as xt,_ as $t}from"./coingecko.service-492c3cc3.js";import{_ as Ct}from"./BalBlankSlate.vue_vue_type_style_index_0_lang-8c053ed8.js";import{_ as et}from"./BalTooltip.vue_vue_type_style_index_0_lang-8bf6235c.js";import{_ as Pt,B as at}from"./BalAsset-fcab7531.js";import{_ as Bt}from"./coingecko-ea66c146.js";import{T as je,l as ha,Q as ke,n as ia,R as Ca,ao as Re,ap as aa,o as ze,B as De,U as Ze,a9 as Ft,c as fe,S as Ne,u as tt,Z as re,aA as ua,ad as Ma,V as Ot,O as Lt,aB as Aa}from"./connector-16147cef.js";import{u as Pa}from"./useBreakpoints-ee2a85bc.js";import{u as It}from"./useTailwind-38f80624.js";import{f as Dt,u as Mt}from"./useVeBAL-5fa15e49.js";import{d as Ve,r as O,u as i,aj as Sa,b as S,p as V,z as w,c as J,l as Z,q as n,v as B,j as D,i as le,A as wa,F as Je,E as ya,G as _a,y as Ra,k as ca,C as Ke,ap as st,x as xa,al as Ba,o as la,br as Rt,e as pa,T as Nt,ar as Ut}from"./runtime-core.esm-bundler-558f8953.js";import{_ as Qe}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Wt}from"./BalBtnGroup-92655bd2.js";import{_ as ot}from"./BalAlert-fdfde589.js";import{u as Vt}from"./vue-router-461057a5.js";import{_ as Ht,g as fa}from"./balancer-sdk-d0995fe4.js";import{_ as Gt}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-f37eca6e.js";import{_ as Qt}from"./BalStack.vue_vue_type_script_lang-342e535e.js";import{a as nt,R as ta,u as Ea,b as qt}from"./useRelayerApproval-b64164b6.js";import{u as zt,A as jt}from"./useTokenApprovalActions-42c413d9.js";import{ad as rt,ae as it,af as Zt,ag as Ge,ac as be,ah as sa,ai as Na,aj as $e,ak as Jt,al as Kt,am as Yt}from"./usePoolHelpers-eb955974.js";import{_ as Xt,S as es}from"./SwapSettingsPopover.vue_vue_type_style_index_0_lang-f08855d4.js";import{L as lt}from"./useDarkMode-6a81be08.js";import{a as Fa,O as da,c as as,s as ts,d as Ua,A as ma,b as ut,e as ss}from"./useTransactions-114fc9d7.js";import{c as os,V as ns,v as va}from"./vault.service-8fdea290.js";import{b as ct}from"./useGnosisSafeApp-bf4524fc.js";import{d as rs}from"./index-18b6daea.js";import{o as is}from"./helpers-7076a817.js";import{c as ls}from"./validations-969b3a37.js";import{_ as Wa}from"./TokenInput.vue_vue_type_script_setup_true_lang-16ac0e09.js";import{C as us}from"./Col3Layout-f6c1dd97.js";import{u as cs}from"./usePoolFilters-5be047ca.js";import{_ as ps}from"./BalLink-65772d8f.js";import{c as ds}from"./urls-2a720267.js";import{p as vs}from"./user-tokens.provider-ef101cbb.js";import"./BalAssetSet-0f096fdb.js";import"./_commonjsHelpers-87174ba5.js";import"./metamask.connector-0225016b.js";import"./numeral-77821a11.js";import"./echarts-2876138a.js";import"./browser-6c45db04.js";import"./Avatar.vue_vue_type_script_setup_true_lang-5ab9890e.js";import"./tailwind.config-235e68cf.js";import"./index-155f0d25.js";import"./wallet-logos-346092ca.js";import"./anime.es-de4e5aa0.js";import"./wallet-names-136aa5a2.js";import"./pools-18fd7fb0.js";import"./BalPopover-a283b4e9.js";import"./options-322e8a89.js";import"./index-fe1d1633.js";import"./events-5f626723.js";import"./readable-browser-a0df197a.js";import"./immutable-2b056f5a.js";import"./index-1de0572e.js";import"./meta.service-1c1722a9.js";import"./voting.provider-3f46e556.js";import"./liquidity-gauge-c56bdf84.js";import"./useVotingPools-44058ee3.js";import"./useQueryHelpers-8fe10019.js";import"./BalTextInput-57c2e4cc.js";import"./SelectTokenModal-1ed87681.js";import"./index.esm-d99d5267.js";const ms=e=>(ya("data-v-33c9e4ea"),e=e(),_a(),e),ws={class:"h-40 lg:h-56"},fs={class:"relative p-4 h-full bg-transparent"},gs={key:0,class:"flex"},hs={class:"font-medium"},Ss=ms(()=>n("img",{class:"h-5",src:Bt},null,-1)),ys={key:1,class:"flex justify-center items-center w-full h-full"},_s={class:"text-sm text-gray-400"},bs={key:2,class:"flex justify-center items-center w-full h-full"},ks={class:"text-sm text-center text-gray-400"},As={key:3,class:"flex-col"},Es={class:"-mt-2 lg:mt-2"},Ts={class:"flex justify-end w-full text-sm text-gray-500"},xs=Ve({__name:"PairPriceGraph",setup(e){async function t(g,M,j,R,Q,U){let Y=g===j?R:g,ne=M===j?R:M;U&&([Y,ne]=[ne,Y]);const Se=Q<=90?"hour":"day",A=Da.prices.getTokensHistorical([Y],Q,1,Se),I=Da.prices.getTokensHistorical([ne],Q,1,Se),[q,ee]=await Promise.all([A,I]),ge=je.mapValues(q,(z,me)=>ee[me]?1/z[0]*ee[me][0]:null),ve=je.pickBy(ge),he=je.mapKeys(ve,(z,me)=>Dt(xt(me/1e3),"yyyy/MM/dd HH:mm"));return je.toPairs(he)}const a=[{option:"1d",value:1},{option:"1w",value:7},{option:"1m",value:30},{option:"1y",value:365},{option:"All",value:4e3}],{upToLargeBreakpoint:s}=Pa(),{t:o}=Ye(),{getToken:d,wrappedNativeAsset:r,nativeAsset:m}=Pe(),{tokenInAddress:p,tokenOutAddress:f,initialized:k}=Ja(),u=It(),{chainId:y,appNetworkConfig:h}=Ue(),F=O(s?75:100),b=O(a[0]),_=i(()=>{var g;return p.value===""?"Unknown":(g=d(p.value))==null?void 0:g.symbol}),E=i(()=>{var g;return f.value===""?"Unknown":(g=d(f.value))==null?void 0:g.symbol}),{isLoading:$,data:C,error:T}=St(yt.Tokens.PairPriceData(p,f,b,y,m,r),()=>{var g;return t(p.value,f.value,m==null?void 0:m.address,(g=r.value)==null?void 0:g.address,b.value.value,!0)},Sa({enabled:k,retry:!1,refetchOnWindowFocus:!1})),X=[[h.tokens.Addresses.wNativeAsset,h.tokens.Addresses.nativeAsset]],K=i(()=>X.some(g=>g.includes(p.value)&&g.includes(f.value))),c=i(()=>K.value?[]:[{name:`${E.value}/${_.value}`,values:C.value||[]}]),W=i(()=>K.value?`${_.value} -> ${E.value} is 1:1`:o("noData")),L=i(()=>{const g=C.value||[];return g.length>2&&g[g.length-1][1]<g[g.length-2][1]}),G=i(()=>{let g=u.theme.colors.green[400];return L.value&&(g=u.theme.colors.red[400]),[g]}),P=i(()=>({left:"2.5%",right:"0",top:"10%",bottom:"15%",containLabel:!1}));return(g,M)=>{const j=Pt,R=et,Q=na,U=Ct,Y=$t,ne=ga;return S(),V("div",ws,[w($)?(S(),J(j,{key:0,class:"h-56"})):(S(),J(ne,{key:1,square:w(s),shadow:"none",hFull:"",growContent:"",noPad:"",noBorder:w(s)},{default:Z(()=>[n("div",fs,[!w(T)&&!w($)?(S(),V("div",gs,[n("h6",hs,B(w(E))+"/"+B(w(_)),1),D(R,{class:"ml-2",text:g.$t("coingeckoPricingTooltip")},{activator:Z(()=>[Ss]),_:1},8,["text"])])):le("",!0),w(T)&&w(f)?(S(),V("div",ys,[n("span",_s,B(g.$t("insufficientData")),1)])):le("",!0),w(T)&&!w(f)?(S(),V("div",bs,[n("span",ks,B(g.$t("chooseAPair")),1)])):le("",!0),!w(T)&&!w($)?(S(),V("div",As,[w(c).length===0?(S(),J(U,{key:0,class:"mt-4 h-40"},{default:Z(()=>[D(Q,{name:"bar-chart"}),wa(" "+B(w(W)),1)]),_:1})):(S(),V(Je,{key:1},[D(Y,{data:w(c),height:w(F),showLegend:!1,color:w(G),customGrid:w(P),axisLabelFormatter:{yAxis:{maximumSignificantDigits:6,fixedFormat:!0}},wrapperClass:"flex flex-row lg:flex-col flex-row",showTooltip:!w(s),chartType:"line",hideYAxis:"",hideXAxis:"",showHeader:"",useMinMax:""},null,8,["data","height","color","customGrid","showTooltip"]),n("div",Es,[n("span",Ts,B(w(b).option),1)])],64))])):le("",!0)])]),_:1},8,["square","noBorder"]))])}}});const Va=Qe(xs,[["__scopeId","data-v-33c9e4ea"]]),pt=O(ha(`inputAsset.${ia.value}`,ke.network.tokens.InitialSwapTokens.input)),dt=O(ha(`outputAsset.${ia.value}`,ke.network.tokens.InitialSwapTokens.output));function $s(e){pt.value=e,Ca(`inputAsset.${ia.value}`,e)}function Cs(e){dt.value=e,Ca(`outputAsset.${ia.value}`,e)}function vt(){return{inputAsset:pt,outputAsset:dt,setInputAsset:$s,setOutputAsset:Cs}}const Ps={},Bs={width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Fs=n("path",{d:"M0.888584 8.06059L7.77779 14.9498L14.667 8.06059L13.211 6.59752L8.83603 10.9796V0.333313H6.71955V10.9796L2.33745 6.59752L0.888584 8.06059Z",fill:"currentColor"},null,-1),Os=[Fs];function Ls(e,t){return S(),V("svg",Bs,Os)}const Is=Qe(Ps,[["render",Ls]]),Ds=e=>(ya("data-v-d22885a6"),e=e(),_a(),e),Ms={class:"mr-2"},Rs={key:0,class:"mt-5"},Ns=["textContent"],Us={key:1},Ws={class:"flex justify-between text-xs"},Vs={class:"font-semibold"},Hs={class:"flex flex-col items-end"},Gs={class:"font-semibold"},Qs={class:"relative mt-2"},qs=Ds(()=>n("div",{class:"absolute mx-9 h-1/2 border-b border-gray-500 border-dashed pair-line"},null,-1)),zs={class:"flex relative z-10 justify-between"},js={class:"relative my-1.5 mx-4"},Zs={class:"relative z-10"},Js={class:"flex items-center ml-4 w-4"},Ks={class:"flex"},Ys=["href"],Xs={class:"mr-4 w-10 text-xs text-right text-secondary"},eo=Ve({__name:"SwapRoute",props:{addressIn:{},amountIn:{},addressOut:{},amountOut:{},pools:{},sorReturn:{}},setup(e){const t=e,{fNum:a}=We(),{getToken:s}=Pe(),o=O(!1);function d(){o.value=!o.value}const r=i(()=>{const u=s(t.addressIn).symbol;return{amount:t.amountIn,address:t.addressIn,symbol:u}}),m=i(()=>{const u=s(t.addressOut).symbol;return{amount:t.amountOut,address:t.addressOut,symbol:u}}),p=i(()=>{const{sorReturn:u}=t;if(!u.hasSwaps)return[];const y=t.pools,h=u.result.swaps,F=u.result.tokenAddresses,b=t.addressIn,_=t.addressOut;return f(b,_,y,h,F)});function f(u,y,h,F,b){if(u=u===Re?aa:ze(u),y=y===Re?aa:ze(y),!h.length||!F.length||!b.length||b.length===1)return[];const _=F.reduce((C,T)=>C.plus(T.amount||"0"),new De(0)),E=[],$=[];for(let C=0;C<F.length;C++){const T=F[C],X=h.find(K=>K.id===T.poolId);if(X){const K=b[T.assetInIndex]===Ce?aa:ze(b[T.assetInIndex]),c=b[T.assetOutIndex]===Ce?aa:ze(b[T.assetOutIndex]),W=K===u&&c===y,G={pool:{address:X.address,id:X.id,tokens:X.tokens.map(P=>({address:ze(P.address),share:parseFloat(P.weight||"")||1/X.tokens.length})).sort((P,g)=>Ze(P.address,K)||Ze(g.address,c)?-1:Ze(P.address,c)||Ze(g.address,K)?1:P.share-g.share).filter((P,g,M)=>g<2||g>M.length-3)},tokenIn:K,tokenOut:c,amount:new De(T.amount||"0")};if($.push(G),W){const g={share:G.amount.div(_).toNumber(),hops:[G]};E.push(g)}else if(c===y&&T.amount==="0"){const M={share:new De($[C-1].amount).div(_).toNumber(),hops:[$[C-1],G]};E.push(M)}else if(K===u&&T.amount==="0"){const M={share:new De($[C-1].amount).div(_).toNumber(),hops:[G,$[C-1]]};E.push(M)}}}return E}function k(u){return a(u,oe.percent)}return(u,y)=>{const h=na,F=at,b=ga;return w(p).length>0?(S(),J(b,{key:0,shadow:"none"},{default:Z(()=>[n("div",{class:"flex items-center cursor-pointer text-secondary",onClick:d},[n("div",Ms,B(u.$t("swapRoute")),1),w(o)?(S(),J(h,{key:0,name:"chevron-up",size:"sm"})):(S(),J(h,{key:1,name:"chevron-down",size:"sm"}))]),w(o)?(S(),V("div",Rs,[w(p).length===0?(S(),V("div",{key:0,class:"mt-5 text-sm text-secondary",textContent:B(u.$t("noData"))},null,8,Ns)):(S(),V("div",Us,[n("div",null,[n("div",Ws,[n("div",null,[n("div",Vs,B(w(r).amount),1),n("div",null,B(w(r).symbol),1)]),n("div",Hs,[n("div",Gs,B(w(m).amount),1),n("div",null,B(w(m).symbol),1)])]),n("div",Qs,[qs,n("div",zs,[D(F,{address:w(r).address,size:36},null,8,["address"]),D(F,{address:w(m).address,size:36},null,8,["address"])])])]),n("div",{class:"flex justify-between",style:Ra({margin:`8px ${12+w(p).length}px`})},[D(h,{name:"triangle",size:"xxs",filled:!0,class:"rotate-180 text-secondary"}),D(h,{name:"triangle",size:"xxs",filled:!0,class:"text-secondary"})],4),n("div",js,[(S(!0),V(Je,null,ca(w(p),(_,E)=>(S(),V("div",{key:E,style:Ra({height:`${18+70*E}px`,width:`calc(100% - ${4*(w(p).length-E-1)}px + 1px)`,margin:`0 ${2*(w(p).length-E-1)-1}px`}),class:"absolute rounded-b-md border-r border-b border-l border-gray-500"},null,4))),128)),n("div",Zs,[(S(!0),V(Je,null,ca(w(p),_=>{var E,$;return S(),V("div",{key:($=(E=_.hops[0])==null?void 0:E.pool)==null?void 0:$.address,class:"flex justify-between mt-9 first:mt-0"},[n("div",Js,[D(h,{name:"triangle",size:"xxs",filled:!0,class:"rotate-90 text-secondary"})]),n("div",Ks,[(S(!0),V(Je,null,ca(_.hops,C=>{var T;return S(),V("div",{key:(T=C==null?void 0:C.pool)==null?void 0:T.address,class:"flex ml-4 first:ml-0 bg-white hover:bg-gray-50 dark:bg-gray-900 dark:hover:bg-gray-800 rounded-xl border border-gray-100 hover:border-gray-300 dark:border-gray-600 dark:hover:border-gray-400 shadow transition-colors"},[n("a",{class:"flex p-1.5",href:`/#/${w(Ft)}/pool/${C.pool.id}`,target:"_blank"},[(S(!0),V(Je,null,ca(C.pool.tokens,X=>(S(),J(F,{key:X.address,class:"ml-1.5 first:ml-0",address:X.address,size:20},null,8,["address"]))),128))],8,Ys)])}),128))]),n("div",Xs,B(k(_.share)),1)])}),128))])])]))])):le("",!0)]),_:1})):le("",!0)}}});const mt=Qe(eo,[["__scopeId","data-v-d22885a6"]]);var _e=(e=>(e[e.NonWrap=0]="NonWrap",e[e.Wrap=1]="Wrap",e[e.Unwrap=2]="Unwrap",e))(_e||{});const wt=(e,t)=>{const a=ke.network.tokens.Addresses.nativeAsset,s=ke.network.tokens.Addresses.wNativeAsset,{stETH:o,wstETH:d}=ke.network.tokens.Addresses;return e===a&&t===s||e===o&&t===d?1:t===a&&e===s||t===o&&e===d?2:0},Ha=async(e,t,a)=>{if(t===0)throw new Error("Invalid wrap type");const s=ke.network.tokens.Addresses.wNativeAsset,{wstETH:o}=ke.network.tokens.Addresses;if(e===s)return fe.from(a);if(e===o)return rt({amount:a,isWrap:t===1});throw new Error("Unknown wrapper")};async function ao(e,t,a,s){try{if(a===Ne[e].tokens.Addresses.wNativeAsset)return so(e,t,s);if(a===Ne[e].tokens.Addresses.wstETH)return no(e,t,s);throw new Error("Unrecognised wrapper contract")}catch(o){return console.log("[Wrapper] Wrap error:",o),Promise.reject(o)}}async function to(e,t,a,s){try{if(a===Ne[e].tokens.Addresses.wNativeAsset)return oo(e,t,s);if(a===Ne[e].tokens.Addresses.wstETH)return ro(e,t,s);throw new Error("Unrecognised wrapper contract")}catch(o){return console.log("[Wrapper] Unwrap error:",o),Promise.reject(o)}}const so=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:Ne[e].tokens.Addresses.wNativeAsset,abi:["function deposit() payable"],action:"deposit",options:{value:a}}),oo=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:Ne[e].tokens.Addresses.wNativeAsset,abi:["function withdraw(uint256 wad)"],action:"withdraw",params:[a]}),no=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:Ne[e].tokens.Addresses.wstETH,abi:["function wrap(uint256 _stETHAmount) returns (uint256)"],action:"wrap",params:[a]}),ro=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:Ne[e].tokens.Addresses.wstETH,abi:["function unwrap(uint256 _wstETHAmount) returns (uint256)"],action:"unwrap",params:[a]}),io={class:"w-full"},lo={class:"p-3 w-full text-sm bg-gray-50 dark:bg-gray-800 rounded-t-lg border-b dark:border-gray-800"},uo={class:"relative p-3 border-b border-gray-100 dark:border-gray-900"},co={class:"flex items-center"},po={class:"mr-3"},vo={class:"font-medium"},mo={class:"text-sm text-secondary"},wo={class:"arrow-down"},fo={class:"p-3"},go={class:"flex items-center"},ho={class:"mr-3"},So={class:"font-medium"},yo={class:"text-sm text-secondary"},_o={key:0},bo={class:"flex justify-between items-center p-3 w-full border-b dark:border-gray-900"},ko={class:"font-semibold"},Ao={class:"flex text-xs uppercase divide-x dark:divide-gray-500"},Eo={key:0,class:"p-3 text-sm"},To={class:"summary-item-row"},xo=["innerHTML"],$o={class:"summary-item-row"},Co={class:"text-green-400"},Po={class:"summary-item-row"},Bo=["innerHTML"],Fo={class:"p-3 w-full text-sm bg-white dark:bg-gray-800 rounded-b-lg"},Oo={class:"font-medium summary-item-row"},Lo={class:"w-64"},Io=["innerHTML"],Do={class:"summary-item-row text-secondary"},Mo={class:"w-64"},Ro=["innerHTML"],Ta=.02,No=Ve({__name:"SwapPreviewModal",props:{swapping:{},error:{},warning:{}},emits:["swap","close"],setup(e,{emit:t}){const a=e,{t:s}=Ye(),{fNum:o,toFiat:d}=We(),{balanceFor:r}=Pe(),{blockNumber:m,account:p,startConnectWithInjectedProvider:f}=Ue(),{slippage:k}=Ka(),{networkConfig:u}=tt(),y=O(a.swapping.isWrapUnwrapSwap.value?null:a.swapping.getQuote()),h=O(!1),F=O(!1),b=O(!1),_=O(!0),E=i(()=>o(k.value,oe.percent)),$=i(()=>a.swapping.tokenIn.value.address),C=i(()=>o(d(a.swapping.tokenInAmountInput.value,a.swapping.tokenIn.value.address),oe.fiat)),T=i(()=>o(d(a.swapping.tokenOutAmountInput.value,a.swapping.tokenOut.value.address),oe.fiat)),X=i(()=>a.swapping.isBalancerSwap.value),K=i(()=>b.value?o("0",oe.fiat):"0.0 ETH"),c=i(()=>p.value&&re(a.swapping.tokenInAmountInput.value).isGreaterThan(r(a.swapping.tokenInAddressInput.value))),W=i(()=>!!c.value||!!a.error||!!_.value),L=i(()=>{const l={amountBeforeFees:"",swapFees:"",totalWithoutSlippage:"",totalWithSlippage:""},ie=a.swapping.exactIn.value,ue=a.swapping.tokenIn.value,ye=a.swapping.tokenOut.value,v=a.swapping.tokenInAmountInput.value,N=a.swapping.tokenOutAmountInput.value;if(a.swapping.isWrapUnwrapSwap.value)l.amountBeforeFees=N,l.swapFees="0",l.totalWithoutSlippage=N,l.totalWithSlippage=N;else{const x=a.swapping.getQuote();ie?(l.amountBeforeFees=N,l.swapFees=de(x.feeAmountOutToken,ye.decimals),l.totalWithoutSlippage=re(l.amountBeforeFees).minus(l.swapFees).toString(),l.totalWithSlippage=de(x.minimumOutAmount,ye.decimals)):(l.amountBeforeFees=v,l.swapFees=de(x.feeAmountInToken,ue.decimals),l.totalWithoutSlippage=re(l.amountBeforeFees).plus(l.swapFees).toString(),l.totalWithSlippage=de(x.maximumInAmount,ue.decimals))}return b.value?je.mapValues(l,x=>`${o(d(x,ie?ye.address:ue.address),oe.fiat)}`):je.mapValues(l,x=>`${o(x,oe.token)} ${ie||a.swapping.isWrapUnwrapSwap.value?ye.symbol:ue.symbol}`)}),G=i(()=>a.swapping.isWrap.value?{modalTitle:s("previewWrap",[a.swapping.tokenIn.value.symbol]),confirmSwap:s("confirmWrap",[a.swapping.tokenIn.value.symbol]),swapSummary:{title:s("swapSummary.wrap.title"),swapFees:s("swapSummary.wrap.swapFees"),totalBeforeFees:s("swapSummary.wrap.totalBeforeFees"),totalAfterFees:s("swapSummary.wrap.totalAfterFees"),totalWithSlippage:s("swapSummary.wrap.totalWithSlippage",[a.swapping.tokenIn.value.symbol])}}:a.swapping.isUnwrap.value?{modalTitle:s("previewUnwrap",[a.swapping.tokenOut.value.symbol]),confirmSwap:s("confirmUnwrap",[a.swapping.tokenOut.value.symbol]),swapSummary:{title:s("swapSummary.unwrap.title"),swapFees:s("swapSummary.unwrap.swapFees"),totalBeforeFees:s("swapSummary.unwrap.totalBeforeFees"),totalAfterFees:s("swapSummary.unwrap.totalAfterFees"),totalWithSlippage:s("swapSummary.unwrap.totalWithSlippage",[a.swapping.tokenOut.value.symbol])}}:a.swapping.exactIn.value?{modalTitle:s("previewSwap"),confirmSwap:s("confirmSwap"),swapSummary:{title:s("swapSummary.exactIn.title",[a.swapping.tokenIn.value.symbol]),swapFees:s("swapSummary.exactIn.swapFees"),totalBeforeFees:s("swapSummary.exactIn.totalBeforeFees"),totalAfterFees:s("swapSummary.exactIn.totalAfterFees"),totalWithSlippage:s("swapSummary.exactIn.totalWithSlippage",[E.value])}}:{modalTitle:s("previewSwap"),confirmSwap:s("confirmSwap"),swapSummary:{title:s("swapSummary.exactOut.title",[a.swapping.tokenOut.value.symbol]),swapFees:s("swapSummary.exactOut.swapFees"),totalBeforeFees:s("swapSummary.exactOut.totalBeforeFees"),totalAfterFees:s("swapSummary.exactOut.totalAfterFees"),totalWithSlippage:s("swapSummary.exactOut.totalWithSlippage",[E.value])}}),P=i(()=>wt(a.swapping.tokenIn.value.address,a.swapping.tokenOut.value.address)),g=i(()=>it($.value,a.swapping.tokenOut.value.address)&&P.value===_e.NonWrap),{getTokenApprovalActions:M}=zt(),j=O([]),{relayerSignature:R,relayerApprovalAction:Q}=nt(ta.BATCH),U=Ea(ta.BATCH),Y=Ea(ta.COWSWAP,a.swapping.isCowswapSwap),ne=Ea(ta.LIDO,g),Se=i(()=>a.swapping.sor.pools.value),A=i(()=>a.swapping.isJoinExitSwap.value&&!U.isUnlocked.value&&!R.value),I=i(()=>a.swapping.isCowswapSwap.value&&a.swapping.requiresTokenApproval.value&&!Y.isUnlocked.value),q=i(()=>a.swapping.isBalancerSwap.value&&!ne.isUnlocked.value),ee=i(()=>a.swapping.isJoinExitSwap.value&&!U.isUnlocked.value),ge=i(()=>I.value||Y.init.value||Y.approved.value||Y.approving.value),ve=i(()=>!a.swapping.isJoinExitSwap.value&&(q.value||ne.init.value||ne.approved.value||ne.approving.value)),he=i(()=>A.value||I.value||q.value),z=i(()=>!he.value&&h.value&&!F.value),me=i(()=>{const l=[];return ge.value?l.push(Y.action.value):ve.value?l.push(ne.action.value):ee.value&&l.push(Q.value),j.value.length>0&&l.push(...j.value),l.push({label:G.value.confirmSwap,loadingLabel:s("actionSteps.swap.loadingLabel"),confirmingLabel:s("confirming"),action:Be,stepTooltip:a.swapping.isCowswapSwap.value&&!a.swapping.isJoinExitSwap?s("swapSummary.transactionTypesTooltips.sign.content"):s("swapSummary.transactionTypesTooltips.swap.content")}),l});async function Be(){return a.swapping.swap(()=>{a.swapping.resetAmounts(),t("close")})}function Ae(){t("close")}function Le(){h.value=!1,F.value=!0,y.value=a.swapping.getQuote()}function Ie(){if(y.value!=null){const l=a.swapping.getQuote();if(a.swapping.exactIn.value){const ie=re(y.value.minimumOutAmount.toString()),ue=re(l.minimumOutAmount.toString());if(ie.eq(ua))ue.eq(ua)?h.value=!1:h.value=!0;else{const ye=ie.minus(ue).abs().div(ie);h.value=ye.gt(Ta)}}else{const ie=re(y.value.maximumInAmount.toString()),ue=re(l.maximumInAmount.toString());if(ie.eq(ua))ue.eq(ua)?h.value=!1:h.value=!0;else{const ye=ie.minus(ue).abs().div(ie);h.value=ye.gt(Ta)}}h.value&&(F.value=!1)}}const Xe=i(()=>a.swapping.isWrap.value&&!a.swapping.isNativeAssetSwap.value?a.swapping.tokenOut.value.address:u.addresses.vault);return Ke(m,()=>{Ie()}),st(async()=>{j.value=await M({amountsToApprove:[{address:$.value,amount:a.swapping.tokenInAmountInput.value}],spender:Xe.value,actionType:jt.Swapping}),_.value=!1}),(l,ie)=>{const ue=na,ye=Qt,v=ot,N=at,x=Is,we=ga,ce=Xa,ae=Gt,te=Ht;return S(),J(te,{show:"",onClose:Ae},{default:Z(()=>[n("div",null,[D(ye,{horizontal:"",align:"center",spacing:"xs",class:"mb-4"},{default:Z(()=>[n("button",{class:"flex text-blue-500 hover:text-blue-700",onClick:Ae},[D(ue,{class:"flex",name:"chevron-left"})]),n("h4",null,B(G.value.modalTitle),1)]),_:1}),D(we,{noPad:"",class:"overflow-auto relative mb-6"},{header:Z(()=>[n("div",io,[n("div",null,[l.error?(S(),J(v,{key:0,class:"p-3 mb-2",type:"error",size:"sm",title:l.error.header,description:l.error.body,actionLabel:l.error.label,block:""},null,8,["title","description","actionLabel"])):l.warning?(S(),J(v,{key:1,class:"p-3 mb-2",type:"warning",size:"sm",title:l.warning.header,description:l.warning.body,block:""},null,8,["title","description"])):le("",!0)]),n("div",lo,[n("span",null,B(l.$t("effectivePrice"))+" "+B(l.swapping.exactIn.value?l.swapping.effectivePriceMessage.value.tokenIn:l.swapping.effectivePriceMessage.value.tokenOut),1)])])]),default:Z(()=>[n("div",null,[c.value?(S(),J(v,{key:0,class:"p-3",type:"error",size:"sm",title:`${w(s)("exceedsBalance")} ${w(o)(w(r)(a.swapping.tokenInAddressInput.value),w(oe).token)} ${a.swapping.tokenIn.value.symbol}`,block:"",square:""},null,8,["title"])):le("",!0),n("div",uo,[n("div",co,[n("div",po,[D(N,{address:l.swapping.tokenIn.value.address,size:36},null,8,["address"])]),n("div",null,[n("div",vo,B(w(o)(l.swapping.tokenInAmountInput.value,w(oe).token))+" "+B(l.swapping.tokenIn.value.symbol),1),n("div",mo,B(C.value),1)])])]),n("div",wo,[D(x)]),n("div",fo,[n("div",go,[n("div",ho,[D(N,{address:l.swapping.tokenOut.value.address,size:36},null,8,["address"])]),n("div",null,[n("div",So,B(w(o)(l.swapping.tokenOutAmountInput.value,w(oe).token))+" "+B(l.swapping.tokenOut.value.symbol),1),n("div",yo,[wa(B(T.value)+" ",1),l.swapping.isBalancerSwap.value||l.swapping.isWrapUnwrapSwap.value?(S(),V("span",_o," / "+B(l.$t("priceImpact"))+": "+B(w(o)(l.swapping.sor.priceImpact.value,w(oe).percent)),1)):le("",!0)])])])])])]),_:1}),D(we,{noPad:"",shadow:"none",class:"mb-3"},{header:Z(()=>[n("div",bo,[n("div",ko,B(G.value.swapSummary.title),1),n("div",Ao,[n("div",{class:xa(["pr-2 cursor-pointer font-medium",{"text-blue-600":!b.value}]),onClick:ie[0]||(ie[0]=se=>b.value=!1)},B(l.$t("tokens")),3),n("div",{class:xa(["pl-2 cursor-pointer font-medium uppercase",{"text-blue-600":b.value}]),onClick:ie[1]||(ie[1]=se=>b.value=!0)},B(w(_t).usd),3)])])]),footer:Z(()=>[n("div",Fo,[n("div",Oo,[n("div",Lo,B(G.value.swapSummary.totalAfterFees),1),n("div",{innerHTML:L.value.totalWithoutSlippage},null,8,Io)]),n("div",Do,[n("div",Mo,B(G.value.swapSummary.totalWithSlippage),1),n("div",{innerHTML:l.swapping.isWrapUnwrapSwap.value?"":L.value.totalWithSlippage},null,8,Ro)])])]),default:Z(()=>[l.swapping.isCowswapSwap.value?(S(),V("div",Eo,[n("div",To,[n("div",null,B(G.value.swapSummary.totalBeforeFees),1),n("div",{innerHTML:L.value.amountBeforeFees},null,8,xo)]),n("div",$o,[n("div",null,B(l.$t("swapSummary.gasCosts")),1),n("div",Co,"-"+B(K.value),1)]),n("div",Po,[n("div",null,B(G.value.swapSummary.swapFees),1),n("div",{innerHTML:l.swapping.isWrapUnwrapSwap.value?K.value:l.swapping.exactIn.value?`-${L.value.swapFees}`:`+${L.value.swapFees}`},null,8,Bo)])])):le("",!0)]),_:1}),z.value?(S(),J(v,{key:0,class:"p-3 mb-4",type:"error",size:"md",title:l.$t("priceUpdatedAlert.title"),description:l.$t("priceUpdatedAlert.description",[w(o)(Ta,w(oe).percent)]),actionLabel:l.$t("priceUpdatedAlert.actionLabel"),block:"",onActionClick:Le},null,8,["title","description","actionLabel"])):le("",!0),w(p)?(S(),J(ae,{key:2,actions:me.value,primaryActionType:"swap",disabled:W.value||z.value},null,8,["actions","disabled"])):(S(),J(ce,{key:1,color:"gradient",block:"",onClick:Ya(w(f),["prevent"])},{default:Z(()=>[wa(B(l.$t("connectWallet")),1)]),_:1},8,["onClick"])),l.swapping.submissionError.value!=null?(S(),J(v,{key:3,class:"p-3 mt-4",type:"error",size:"md",title:l.$t("swapSubmissionError.title"),description:l.swapping.submissionError.value,block:"",actionLabel:l.$t("swapSubmissionError.actionLabel"),onActionClick:l.swapping.resetSubmissionError},null,8,["title","description","actionLabel","onActionClick"])):le("",!0),l.swapping.isJoinExitSwap.value?(S(),J(v,{key:4,class:"p-3 mt-4",type:"tip",size:"md",title:"",description:ee.value?l.$t("isJoinExitTipDescription.withApproval"):l.$t("isJoinExitTipDescription.withoutApproval"),block:""},null,8,["description"])):le("",!0)]),X.value?(S(),J(mt,{key:0,addressIn:l.swapping.tokenIn.value.address,amountIn:l.swapping.tokenInAmountInput.value,addressOut:l.swapping.tokenOut.value.address,amountOut:l.swapping.tokenOutAmountInput.value,pools:Se.value,sorReturn:l.swapping.sor.sorReturn.value,class:"mt-3"},null,8,["addressIn","amountIn","addressOut","amountOut","pools","sorReturn"])):le("",!0)]),_:1})}}});const Uo=Qe(No,[["__scopeId","data-v-3f556d3c"]]),Ga=Me("0.2",18),Wo={}.VITE_GNOSIS_APP_DATA??"0xE9F29AE547955463ED535162AEFEE525D8D309571A2B18BC26086C8C35D781EB",Ee=Sa({warnings:{highFees:!1},validationError:null,submissionError:null});function Vo({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:s,tokenOutAmountInput:o,tokenInAmountScaled:d,tokenOutAmountScaled:r,tokenIn:m,tokenOut:p,slippageBufferRate:f}){const{transactionDeadline:k}=ct(),{account:u,getSigner:y}=Ue(),{addTransaction:h}=Fa(),{fNum:F}=We(),{balanceFor:b}=Pe(),{t:_}=Ye(),E=O(!1),$=O(!1),C=O(null),T=O(0),X=i(()=>Ee.validationError!=null);function K(){const P=C.value??"0",g=d.value.isZero()?"0":r.value.mul(P).div(d.value).toString();return{feeAmountInToken:P,feeAmountOutToken:g}}function c(){const{feeAmountInToken:P,feeAmountOutToken:g}=K(),M=d.value.add(P).mul(Me(String(1+f.value),18)).div(Oe),j=r.value.sub(g).mul(Oe).div(Me(String(1+f.value),18));return{feeAmountInToken:P,feeAmountOutToken:g,maximumInAmount:M,minimumOutAmount:j}}async function W(P){let g;try{$.value=!0,Ee.submissionError=null,g=c();const M={sellToken:t.value,buyToken:s.value,sellAmount:(e.value?d.value:g.maximumInAmount).sub(g.feeAmountInToken).toString(),buyAmount:e.value?g.minimumOutAmount.toString():r.value.toString(),validTo:os(k.value),appData:Wo,feeAmount:g.feeAmountInToken,kind:e.value?da.SELL:da.BUY,receiver:u.value,partiallyFillable:!1,sellTokenBalance:as.EXTERNAL},{signature:j,signingScheme:R}=await ts(M,y()),Q=await Ua.sendSignedOrder({order:{...M,signature:j,receiver:u.value,signingScheme:R},owner:u.value}),U=e.value?a.value:de(g.maximumInAmount,m.value.decimals).toString(),Y=e.value?de(g.minimumOutAmount,p.value.decimals).toString():o.value,ne=e.value?"":"~",Se=e.value?"~":"",A=`${ne}${F(U,oe.token)} ${m.value.symbol} -> ${Se}${F(Y,oe.token)} ${p.value.symbol}`,{validTo:I,partiallyFillable:q}=M;h({id:Q,type:"order",action:"swap",summary:A,details:{tokenIn:m.value,tokenOut:p.value,tokenInAddress:t.value,tokenOutAddress:s.value,tokenInAmount:a.value,tokenOutAmount:o.value,exactIn:e.value,quote:g,slippageBufferRate:f.value,order:{validTo:I,partiallyFillable:q}}}),P!=null&&P(),$.value=!1,bt(kt.CowswapSwap)}catch(M){const j=_("swapException",["Cowswap"]);throw oa({error:M,action:"swap",msgPrefix:j,context:{level:"fatal",extra:{sender:u.value,tokenIn:m.value,tokenOut:p.value,tokenInAmount:a.value,tokenOutAmount:o.value,quote:g}}}),$a(M)||(Ee.submissionError=j),$.value=!1,M}}function L(P=!0){Ee.warnings.highFees=!1,Ee.validationError=null,Ee.submissionError=null,P&&(C.value=null)}async function G(){if(e.value&&!a.value||!e.value&&!o.value)return;const P=e.value?d.value:r.value;if(P===void 0)return;if(P.isZero()){e.value?o.value="0":a.value="0";return}E.value=!0,Ee.validationError=null,T.value+=1;const g=T.value;try{const M={sellToken:t.value,buyToken:s.value,kind:e.value?da.SELL:da.BUY,fromDecimals:m.value.decimals,toDecimals:p.value.decimals,from:u.value||Ce,receiver:u.value||Ce,[e.value?"sellAmountAfterFee":"buyAmountAfterFee"]:P.toString(),partiallyFillable:!1},j=await Ua.getPriceQuote(M);if(e.value&&!a.value||!e.value&&!o.value){E.value=!1;return}if(j&&g===T.value)if(C.value=j.feeAmount,e.value){o.value=re(de(j.buyAmount??"0",p.value.decimals)).toFixed(6,De.ROUND_DOWN);const{feeAmountInToken:R}=c();Ee.warnings.highFees=fe.from(R).gt(P.mul(Ga).div(Oe))}else{a.value=re(de(j.sellAmount??"0",m.value.decimals)).toFixed(6,De.ROUND_DOWN);const{feeAmountOutToken:R,maximumInAmount:Q}=c();Ee.warnings.highFees=fe.from(R).gt(P.mul(Ga).div(Oe)),u.value&&re(de(Q,m.value.decimals)).gt(b(m.value.address))&&(Ee.validationError=ma.PriceExceedsBalance)}}catch(M){console.log("[CoWswap Quotes] Failed to update quotes",M)}E.value=!1}return{swap:W,handleAmountChange:G,resetState:L,...Ba(Ee),feeQuote:C,updatingQuotes:E,hasValidationError:X,confirming:$,getQuote:c}}const Qa={}.VITE_SWAP_COST||"100000";class Ho{constructor(t,a,s){He(this,"sorV2");He(this,"fetchStatus",{v2finishedFetch:!1,v2success:!1});He(this,"isFetching");He(this,"maxPools");He(this,"gasPrice");He(this,"selectedPools",[]);this.sorV2=fa().sor,this.gasPrice=a,this.maxPools=s,this.isFetching=!1}async setCostOutputToken(t,a,s=null){t=t===Re?aa:t,s&&await this.sorV2.swapCostCalculator.setNativeAssetPriceInToken(t,s);const o=await this.sorV2.getCostOfSwapInToken(t,a,this.gasPrice,fe.from(Qa));return console.log(`[SorManager] Cost for token ${t}: ${o.toString()}`),o}async fetchPools(){if(!this.isFetching){this.isFetching=!0,console.time("[SorManager] fetchPools");try{const t=await this.sorV2.fetchPools();console.log("v2Result: ",t),this.fetchStatus.v2finishedFetch=!0,this.fetchStatus.v2success=t,t||oa({error:new Error("SOR Fetch pools failed"),context:{level:"fatal"}})}catch(t){console.log(`[SorManager] V2 fetchPools issue: ${t.message}`),this.fetchStatus.v2finishedFetch=!0,this.fetchStatus.v2success=!1,oa({error:t,msgPrefix:"SORFetchPools",context:{level:"fatal"}})}console.log(`[SorManager] V2 fetchPools result: ${this.fetchStatus.v2success}`),console.timeEnd("[SorManager] V2 fetchPools"),this.selectedPools=this.sorV2.getPools(),this.isFetching=!1}}async getBestSwap(t,a,s,o,d,r){const m=t===Re?Ce:t,p=a===Re?Ce:a,f=Math.floor(Date.now()/1e3),k={maxPools:this.maxPools,gasPrice:this.gasPrice,swapGas:fe.from(Qa),poolTypeFilter:Zt.All,timestamp:f,forceRefresh:!0},u=await this.sorV2.getSwaps(m.toLowerCase(),p.toLowerCase(),d,r,k);return console.log(`[SorManager] ${u.returnAmount.toString()}: V2 return amount`),console.log(`[SorManager] ${u.returnAmountConsideringFees.toString()}: V2 return amount with fees`),{tokenIn:t,tokenOut:a,returnDecimals:d===Ge.SwapExactIn?o:s,hasSwaps:u.swaps.length>0,returnAmount:u.returnAmount,result:u,marketSpNormalised:u.marketSp}}hasPoolData(){return this.fetchStatus.v2finishedFetch?this.fetchStatus.v2success===!1?(console.log("[SorManager] Error Fetching V2 Pools - No Liquidity Sources."),!1):!0:(console.log("[SorManager] Not finished fetching pools."),!1)}}class Go extends ns{constructor(){super(),this.abi=rs.LidoRelayer__factory.abi}get address(){return this.config.network.addresses.lidoRelayer}}const qa=new Go;var Fe=(e=>(e[e.fixed=0]="fixed",e[e.min=1]="min",e[e.max=2]="max",e))(Fe||{});class Qo{constructor(t,a=ke,s=At){this.transactionDeadline=t,this.config=a,this.walletService=s}async batchSwapV2(t,a,s,o){if(it(t.address,a.address))return this.lidoBatchSwap(t,a,s,o);console.log("[Swap Service] batchSwapV2");const d={};Ze(t.address,Ce)&&(d.value=t.amount);const r=a.type===1?be.SwapExactIn:be.SwapExactOut,m=await this.getFundManagement();try{if(s.length==1){const f={poolId:s[0].poolId,kind:r,assetIn:o[s[0].assetInIndex],assetOut:o[s[0].assetOutIndex],amount:s[0].amount,userData:s[0].userData},k=r===be.SwapExactIn?a.amount.toString():t.amount.toString();return va.swap(f,m,k,this.transactionDeadline.value,d)}const p=this.calculateLimits([t],[a],o);return va.batchSwap(r,s,o,m,p,this.transactionDeadline.value,d)}catch(p){return console.log("[Swapper] batchSwapV2 Error:",p),Promise.reject(p)}}async lidoBatchSwap(t,a,s,o){console.log("[Swapper] lidoBatchSwap");const d={};Ze(t.address,Ce)&&(d.value=t.amount);const r=this.config.network.tokens.Addresses.wstETH||"";sa(t.address)?t={address:r.toLowerCase(),amount:await Na(t.amount),type:t.type}:sa(a.address)&&(a={address:r.toLowerCase(),amount:await Na(a.amount),type:a.type});const m=a.type===1?be.SwapExactIn:be.SwapExactOut,p=await this.getFundManagement();try{if(s.length==1){const k={poolId:s[0].poolId,kind:m,assetIn:o[s[0].assetInIndex],assetOut:o[s[0].assetOutIndex],amount:s[0].amount,userData:s[0].userData};return qa.swap(k,p,a.amount.toString(),this.transactionDeadline.value,d)}const f=this.calculateLimits([t],[a],o);return qa.batchSwap(m,s,o,p,f,this.transactionDeadline.value,d)}catch(f){return console.log("[Swapper] lidoBatchSwap Error:",f),Promise.reject(f)}}async boostedJoinBatchSwap(t,a,s,o){try{const d={},r=await this.getFundManagement(),m=this.calculateLimits(t,[a],o);return va.batchSwap(be.SwapExactIn,s,o,r,m,this.transactionDeadline.value,d)}catch(d){throw console.log("[Swapper] batchSwapGivenInV2 Error:",d),d}}async boostedExitBatchSwap(t,a,s,o,d){try{const r={},m=await this.getFundManagement(),p=this.calculateLimits([t],a,o);return console.log("limits",p),va.batchSwap(d,s,o,m,p,this.transactionDeadline.value,r)}catch(r){throw console.log("[Swapper] batchSwapGivenInV2 Error:",r),r}}async getFundManagement(){const t=await this.walletService.getUserAddress();return{sender:t,recipient:t,fromInternalBalance:!1,toInternalBalance:!1}}calculateLimits(t,a,s){const o=[];return s.forEach((d,r)=>{const m=t.find(f=>d.toLowerCase()===f.address.toLowerCase()),p=a.find(f=>d.toLowerCase()===f.address.toLowerCase());m?o[r]=m.amount.toString():p?o[r]=p.amount.mul(-1).toString():o[r]="0"}),console.log("Limits",o),o}}function qo(){const{transactionDeadline:e}=ct(),t=new Qo(e);async function a(r,m,p){const f=r.result.tokenIn,k=r.result.tokenOut,u={address:f,amount:m,type:Fe.fixed},y={address:k,amount:p,type:Fe.min};return console.log("PERFORM SWAP"),t.batchSwapV2(u,y,r.result.swaps,r.result.tokenAddresses)}async function s(r,m,p){const f=r.result.tokenIn,k=r.result.tokenOut,u={address:f,amount:m,type:Fe.max},y={address:k,amount:p,type:Fe.fixed};return t.batchSwapV2(u,y,r.result.swaps,r.result.tokenAddresses)}async function o(r,m,p,f,k){const u=Object.entries(f).map(([h,F])=>({address:h,amount:F,type:Fe.fixed})),y={address:p,amount:k,type:Fe.min};return t.boostedJoinBatchSwap(u,y,r,m)}async function d(r,m,p,f,k,u=be.SwapExactIn){const y={address:p,amount:fe.from(f),type:Fe.min},h=Object.entries(k).map(([F,b])=>({address:F,amount:fe.from(b),type:Fe.fixed}));return t.boostedExitBatchSwap(y,h,r,m,u)}return{swapIn:a,swapOut:s,boostedJoinBatchSwap:o,boostedExitBatchSwap:d}}const zo={}.VITE_GAS_PRICE||"100000000000",jo={}.VITE_MAX_POOLS||"4",za=1e-4,Zo=.05,xe=Sa({validationErrors:{highPriceImpact:!1,noSwaps:!1},submissionError:null});function ja(e,t,a,s,o,d){const r=$e(e.toString(),s),m=$e(a.toString(),t),p=18,f=fe.from(10).pow(p),k=r.mul(f).div(m),u=$e(d,p);let y;o==be.SwapExactIn?y=u.mul(f).div(k):y=k.mul(f).div(u);const h=4,F=Math.round(y.div(fe.from(10).pow(p-h)));return y=fe.from(F).mul(fe.from(10).pow(p-h)),Oe.sub(y)}function Jo({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:s,tokenOutAmountInput:o,wrapType:d,tokenInAmountScaled:r,tokenOutAmountScaled:m,sorConfig:p={handleAmountsOnFetchPools:!0},tokenIn:f,tokenOut:k,slippageBufferRate:u,isCowswapSwap:y}){let h;const F=O([]),b=O({hasSwaps:!1,tokenIn:"",tokenOut:"",returnDecimals:18,returnAmount:Te,marketSpNormalised:"0",result:{tokenAddresses:[],swaps:[],swapAmount:Te,returnAmount:Te,returnAmountConsideringFees:Te,tokenIn:"",tokenOut:"",marketSp:"0",swapAmountForSwaps:Te,returnAmountFromSwaps:Te}}),_=O(!1),E=O(!1),$=O(0),C=O(""),T=O(!0),{account:X,getProvider:K,appNetworkConfig:c}=Ue(),W=i(()=>K()),{trackGoal:L,Goals:G}=Tt(),{txListener:P}=ut(),{addTransaction:g}=Fa(),{fNum:M,toFiat:j}=We(),{t:R}=Ye(),{injectTokens:Q,priceFor:U,getToken:Y}=Pe(),{swapIn:ne,swapOut:Se}=qo();la(async()=>{const v=[];t.value&&!Y(t.value)&&v.push(t.value),s.value&&!Y(s.value)&&v.push(s.value),await Q(v),await I(),await he()});function A(){xe.validationErrors.highPriceImpact=!1,xe.validationErrors.noSwaps=!1,xe.submissionError=null}async function I(){h=new Ho(Et.jsonProvider,fe.from(zo),Number(jo)),q()}async function q(){h&&(console.time("[SOR] fetchPools"),await h.fetchPools(),console.timeEnd("[SOR] fetchPools"),T.value=!1,p.handleAmountsOnFetchPools&&he())}function ee(){L(G.BalancerSwap),Ma.value&&L(G.BalancerSwapMainnet)}async function ge(){if(h&&b.value.hasSwaps&&!E.value){const{result:v}=b.value,N=e.value?be.SwapExactIn:be.SwapExactOut,x=await fa().swaps.queryBatchSwap({kind:N,swaps:v.swaps,assets:v.tokenAddresses});if(v!==b.value.result)return;if(x.length>=2){const we=ie(t.value),ce=ie(s.value);let ae=t.value===Re?Ce:t.value,te=s.value===Re?Ce:s.value;sa(t.value)&&(ae=ke.network.tokens.Addresses.wstETH||""),sa(s.value)&&(te=ke.network.tokens.Addresses.wstETH||"");const se=v.tokenAddresses.indexOf(ae.toLowerCase()),pe=v.tokenAddresses.indexOf(te.toLowerCase());if(N===be.SwapExactOut){let H=x[se]?fe.from(x[se]).abs():fe.from(0);H=await ue({amount:H,address:t.value,isInputToken:!1}),a.value=H.gt(0)?l(de(H,we)):""}if(N===be.SwapExactIn){let H=x[pe]?fe.from(x[pe]).abs():fe.from(0);H=await ue({amount:H,address:s.value,isInputToken:!1}),o.value=H.gt(0)?l(de(H,ce)):""}}}}function ve(v){e.value&&re(v).isZero()?o.value="":!e.value&&re(v).isZero()?a.value="":(a.value=v,o.value=v),$.value=0,b.value.hasSwaps=!1,b.value.returnAmount=Te}async function he(){if(y.value)return;let v=e.value?a.value:o.value;if(v===""||re(v).isZero()){ve(v);return}const x=t.value,we=s.value;if(!x||!we){e.value?o.value="":a.value="";return}const ce=ie(t.value),ae=ie(s.value),te=e.value?ce:ae;if(v=is(v,te),d.value!==_e.NonWrap){const se=d.value===_e.Wrap?we:x;if(e.value){a.value=v;const pe=await Ha(se,d.value,$e(v,ce));o.value=La(pe,ce)}else{o.value=v;const pe=await Ha(se,d.value===_e.Wrap?_e.Unwrap:_e.Wrap,$e(v,ae));a.value=La(pe,ae)}b.value.hasSwaps=!1,$.value=0;return}if(!h||!h.hasPoolData()){e.value?o.value="":a.value="";return}if(e.value){await Ae(s.value,ae,h);let se=Ia(v,ce);console.log("[SOR Manager] swapExactIn");const pe=await h.getBestSwap(x,we,ce,ae,Ge.SwapExactIn,se);b.value=pe;let H=pe.returnAmount;if(o.value=H.gt(0)?l(de(H,ae)):"",!b.value.hasSwaps)$.value=0,xe.validationErrors.noSwaps=!0;else{se=await ue({amount:se,address:x,isInputToken:!0}),H=await ue({amount:H,address:we,isInputToken:!1});const ba=ja(se,ce,H,ae,be.SwapExactIn,pe.marketSpNormalised);$.value=Math.max(Number(de(ba)),za)}}else{await Ae(t.value,ce,h);let se=Ia(v,ae);console.log("[SOR Manager] swapExactOut");const pe=await h.getBestSwap(x,we,ce,ae,Ge.SwapExactOut,se);b.value=pe;let H=pe.returnAmount;if(a.value=H.gt(0)?l(de(H,ce)):"",!b.value.hasSwaps)$.value=0,xe.validationErrors.noSwaps=!0;else{se=await ue({amount:se,address:we,isInputToken:!0}),H=await ue({amount:H,address:x,isInputToken:!1});const ba=ja(H,ce,se,ae,be.SwapExactIn,pe.marketSpNormalised);$.value=Math.max(Number(de(ba)),za)}}F.value=h.selectedPools,xe.validationErrors.highPriceImpact=$.value>=Zo}function z(v,N){E.value=!1;let x="";const we=M(a.value,{...oe.token,maximumSignificantDigits:6}),ce=M(o.value,{...oe.token,maximumSignificantDigits:6}),ae=f.value.symbol,te=k.value.symbol;["wrap","unwrap"].includes(N)?x=R("transactionSummary.wrapUnwrap",[we,ae,te]):x=`${we} ${ae} -> ${ce} ${te}`,g({id:v.hash,type:"tx",action:N,summary:x,details:{tokenIn:f.value,tokenOut:k.value,tokenInAddress:t.value,tokenOutAddress:s.value,tokenInAmount:a.value,tokenOutAmount:o.value,exactIn:e.value,quote:Xe(),priceImpact:$.value,slippageBufferRate:u.value}});const se=j(a.value,t.value)||"0";P(v,{onTxConfirmed:async()=>{L(G.Swapped,re(se).times(100).toNumber()||0),_.value=!1,C.value=v.hash},onTxFailed:()=>{_.value=!1}})}async function me(v){L(G.ClickSwap),_.value=!0,E.value=!0,xe.submissionError=null;const N=t.value,x=s.value,we=Y(N).decimals,ce=Y(x).decimals,ae=$e(a.value,we);if(d.value==_e.Wrap){try{const te=await ao(c.key,W.value,x,ae);console.log("Wrap tx",te),z(te,"wrap"),v!=null&&v(),ee()}catch(te){ye(te,N,x)}return}else if(d.value==_e.Unwrap){try{const te=await to(c.key,W.value,N,ae);console.log("Unwrap tx",te),z(te,"unwrap"),v!=null&&v(),ee()}catch(te){ye(te,N,x)}return}if(e.value){const te=$e(o.value,ce),se=Ie(te),pe=b.value;try{const H=await ne(pe,ae,se);console.log("Swap in tx",H),z(H,"swap"),v!=null&&v(),ee()}catch(H){ye(H,N,x)}}else{const te=Le(ae),se=b.value,pe=$e(o.value,ce);try{const H=await Se(se,te,pe);console.log("Swap out tx",H),z(H,"swap"),v!=null&&v(),ee()}catch(H){ye(H,N,x)}}}function Be(v){const N=U(c.nativeAsset.address),x=U(v);return x===0?0:N/x}async function Ae(v,N,x){await x.setCostOutputToken(v,N,Be(v).toString())}function Le(v){return v.mul($e(String(1+u.value),18)).div(Oe)}function Ie(v){return v.mul(Oe).div($e(String(1+u.value),18))}function Xe(){const v=r!=null?Le(r.value):Te,N=m!=null?Ie(m.value):Te;return{feeAmountInToken:"0",feeAmountOutToken:"0",maximumInAmount:v,minimumOutAmount:N}}function l(v){return M(v,{maximumSignificantDigits:6,useGrouping:!1,fixedFormat:!0})}function ie(v){var N;return(N=Y(v))==null?void 0:N.decimals}async function ue({amount:v,address:N,isInputToken:x}){return sa(N)&&Ma.value?rt({amount:v,isWrap:x}):v}function ye(v,N,x){throw $a(v)||(console.trace(v),xe.submissionError=R("swapException",["Balancer"]),oa({error:v,action:"swap",msgPrefix:xe.submissionError,context:{extra:{sender:X.value,tokenIn:N,tokenOut:x},tags:{swapType:"balancer"}}})),_.value=!1,E.value=!1,v}return{...Ba(xe),sorManager:h,sorReturn:b,pools:F,initSor:I,handleAmountChange:he,exactIn:e,swap:me,swapping:_,priceImpact:$,latestTxHash:C,fetchPools:q,poolsLoading:T,getQuote:Xe,resetState:A,confirming:E,updateSwapAmounts:ge,resetInputAmounts:ve,setSwapCost:Ae}}const Ko=[{inputs:[{internalType:"contract IVault",name:"vault",type:"address"},{internalType:"address",name:"libraryAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"getLibrary",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getVault",outputs:[{internalType:"contract IVault",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}],qe=Sa({validationErrors:{highPriceImpact:!1},submissionError:null});function Yo({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:s,tokenOutAmountInput:o,tokenInAmountScaled:d,tokenOutAmountScaled:r,tokenIn:m,tokenOut:p,slippageBufferRate:f,pools:k}){const u=O(null),y=O(!1),h=O(!1),F=O(0),b=O(""),_=O(!1),{account:E,getSigner:$}=Ue(),{injectTokens:C,getToken:T}=Pe(),{relayerSignature:X}=nt(ta.BATCH),K=qt(O(ke.network.addresses.batchRelayer)),{addTransaction:c}=Fa(),{txListener:W}=ut(),{fNum:L}=We(),{t:G}=Ye(),P=i(()=>qe.validationErrors.highPriceImpact!=!1);function g(){qe.validationErrors.highPriceImpact=!1,qe.submissionError=null}function M(A){a.value=A,o.value=A,F.value=0}async function j(){_.value=!0,u.value=await fa().sor.getSwaps(t.value,s.value,e.value?Ge.SwapExactIn:Ge.SwapExactOut,Me(a.value||o.value||"0",18),void 0,!0),_.value=!1}async function R(){var ge;if(e.value&&!a.value||!e.value&&!o.value||k.value.length===0||(e.value?d.value:r.value)===void 0)return;await j();const I=Se(t.value),q=Se(s.value),ee=((ge=u.value)==null?void 0:ge.returnAmount)||fe.from("0");ee.isZero()||(e.value?o.value=re(de(ee,q)).toFixed(6,De.ROUND_DOWN):a.value=re(de(ee,I)).toFixed(6,De.ROUND_DOWN))}async function Q(A){var ee,ge;const I=fa();let q;try{if(h.value=!0,qe.submissionError=null,!u.value)return;const ve=Jt(u.value,k.value,E.value,((ee=I.contracts.relayer)==null?void 0:ee.address)??"",I.networkConfig.addresses.tokens.wrappedNativeAsset,String(f.value*1e4),X.value||void 0);q=await new ra($()).contract.sendTransaction({contractAddress:((ge=I.contracts.relayer)==null?void 0:ge.address)??"",abi:Ko,action:"multicall",params:[ve.rawCalls]}),console.log(q);const z=L(a.value,{...oe.token,maximumSignificantDigits:6}),me=L(o.value,{...oe.token,maximumSignificantDigits:6});c({id:q.hash,type:"tx",action:"swap",summary:`${z} ${m.value.symbol} -> ${me} ${p.value.symbol}`,details:{tokenIn:m.value,tokenOut:p.value,tokenInAddress:t.value,tokenOutAddress:s.value,tokenInAmount:a.value,tokenOutAmount:o.value,exactIn:e.value,quote:ne(),priceImpact:F.value,slippageBufferRate:f.value}}),A!=null&&A(),await W(q,{onTxConfirmed:async()=>{h.value=!1,K.refetch()},onTxFailed:()=>{h.value=!1}})}catch(ve){const he=G("swapException",["Relayer"]);throw oa({error:ve,action:"swap",msgPrefix:he,context:{level:"fatal",extra:{sender:E.value,swapInfo:u.value,tx:q}}}),$a(ve)||(qe.submissionError=G("swapException",["Relayer"])),y.value=!1,h.value=!1,ve}}function U(A){return A.mul(Me(String(1+f.value),18)).div(Oe)}function Y(A){return A.mul(Oe).div(Me(String(1+f.value),18))}function ne(){const A=d!=null?U(d.value):Te,I=r!=null?Y(r.value):Te;return{feeAmountInToken:"0",feeAmountOutToken:"0",maximumInAmount:A,minimumOutAmount:I}}function Se(A){var I;return(I=T(A))==null?void 0:I.decimals}return la(async()=>{const A=[];t.value&&!T(t.value)&&A.push(t.value),s.value&&!T(s.value)&&A.push(s.value),await C(A)}),Ke(k,()=>{R()}),{...Ba(qe),pools:k,hasValidationError:P,handleAmountChange:R,exactIn:e,swap:Q,swapInfo:u,swapping:y,priceImpact:F,latestTxHash:b,getQuote:ne,resetState:g,confirming:h,swapInfoLoading:_,resetInputAmounts:M}}const ea=O(ha(lt.Swap.Gasless,!0));function Xo(e,t,a,s,o){const{fNum:d}=We(),{getToken:r,tokens:m}=Pe(),{blockNumber:p}=Ue(),{slippage:f}=Ka(),{setInputAsset:k,setOutputAsset:u}=vt(),y=i(()=>parseFloat(f.value)),h=i(()=>wt(t.value,s.value)),F=i(()=>h.value===_e.Wrap),b=i(()=>h.value===_e.Unwrap),_=i(()=>r(t.value)),E=i(()=>r(s.value)),$=i(()=>t.value===Re),C=i(()=>Me(a.value||"0",_.value.decimals)),T=i(()=>Me(o.value||"0",E.value.decimals)),X=i(()=>!(h.value===_e.Unwrap||$.value)),K=i(()=>{var Be,Ae,Le,Ie;const z=parseFloat(a.value),me=parseFloat(o.value);return z>0&&me>0?{tokenIn:`1 ${(Be=_.value)==null?void 0:Be.symbol} = ${d(re(me).div(z).toString(),oe.token)} ${(Ae=E.value)==null?void 0:Ae.symbol}`,tokenOut:`1 ${(Le=E.value)==null?void 0:Le.symbol} = ${d(re(z).div(me).toString(),oe.token)} ${(Ie=_.value)==null?void 0:Ie.symbol}`}:{tokenIn:"",tokenOut:""}}),c=i(()=>ss.includes(ia.value)),W=i(()=>{var z,me,Be,Ae;return h.value!==_e.NonWrap?"wrapUnwrap":$.value?"balancer":ea.value&&c.value?"cowswap":((((z=U.swapInfo.value)==null?void 0:z.returnAmount)&&!((me=U.swapInfo.value)!=null&&me.returnAmount.isZero())?Kt(e.value?Ge.SwapExactIn:Ge.SwapExactOut,t.value,s.value):!1)?Yt(R.pools.value,((Be=U.swapInfo.value)==null?void 0:Be.swaps)??[],((Ae=U.swapInfo.value)==null?void 0:Ae.tokenAddresses)??[]):!1)?"joinExit":"balancer"}),L=i(()=>W.value==="cowswap"),G=i(()=>W.value==="balancer"),P=i(()=>W.value==="joinExit"),g=i(()=>W.value==="wrapUnwrap"),M=i(()=>$.value||g.value),j=i(()=>parseFloat(a.value)>0&&parseFloat(o.value)>0),R=Jo({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:s,tokenOutAmountInput:o,wrapType:h,tokenInAmountScaled:C,tokenOutAmountScaled:T,sorConfig:{handleAmountsOnFetchPools:!0},tokenIn:_,tokenOut:E,slippageBufferRate:y,isCowswapSwap:L}),Q=Vo({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:s,tokenOutAmountInput:o,tokenInAmountScaled:C,tokenOutAmountScaled:T,tokenIn:_,tokenOut:E,slippageBufferRate:y}),U=Yo({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:s,tokenOutAmountInput:o,tokenInAmountScaled:C,tokenOutAmountScaled:T,tokenIn:_,tokenOut:E,slippageBufferRate:y,pools:R.pools}),Y=i(()=>j.value||g.value?!1:L.value?Q.updatingQuotes.value:U.swapInfoLoading.value||R.poolsLoading.value),ne=i(()=>R.confirming.value||Q.confirming.value||U.confirming.value),Se=i(()=>R.submissionError.value||Q.submissionError.value||U.submissionError.value);async function A(z){return L.value?Q.swap(()=>{z&&z(),Q.resetState()}):P.value?U.swap(()=>{z&&z(),U.resetState()}):R.swap(()=>{z&&z(),R.resetState()})}function I(){R.submissionError.value=null,Q.submissionError.value=null,U.submissionError.value=null}function q(z){ea.value=z,Ca(lt.Swap.Gasless,ea.value)}function ee(){q(!ea.value),he()}function ge(){return L.value?Q.getQuote():P.value?U.getQuote():R.getQuote()}function ve(){R.resetInputAmounts("")}async function he(){e.value?o.value="":a.value="",Q.resetState(!1),R.resetState(),U.resetState(),L.value?Q.handleAmountChange():(await R.handleAmountChange(),await U.handleAmountChange())}return Ke(t,async()=>{k(t.value),he()}),Ke(s,()=>{u(s.value),he()}),la(()=>{window.location.href.includes("gasless=false")&&q(!1)}),Ke(p,()=>{L.value?Q.hasValidationError.value||Q.handleAmountChange():P.value?U.hasValidationError.value||U.handleAmountChange():G.value&&R.updateSwapAmounts()}),Ke(y,()=>{he()}),{isWrap:F,isUnwrap:b,isNativeAssetSwap:$,tokenIn:_,tokenOut:E,tokenInAmountScaled:C,tokenOutAmountScaled:T,tokens:m,requiresTokenApproval:X,effectivePriceMessage:K,swapRoute:W,exactIn:e,isLoading:Y,cowswap:Q,sor:R,joinExit:U,isCowswapSwap:L,isBalancerSwap:G,isJoinExitSwap:P,wrapType:h,isWrapUnwrapSwap:g,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:s,tokenOutAmountInput:o,slippageBufferRate:y,isConfirming:ne,submissionError:Se,resetSubmissionError:I,swapGasless:ea,toggleSwapGasless:ee,isGaslessSwappingDisabled:M,isCowswapSupportedOnNetwork:c,resetAmounts:ve,getQuote:ge,swap:A,handleAmountChange:he}}function en(e,t,a,s){const{isWalletReady:o}=Ue(),{balances:d}=Pe(),r=i(()=>!k(t.value)&&!k(s.value)),m=i(()=>!e.value||!a.value),p=i(()=>!d.value[e.value]||re(d.value[e.value]).lt(t.value)),f=i(()=>r.value||m.value?2:o.value&&p.value?4:0);function k(y){return re(y).gt(0)&&y.trim()!==""}const u=i(()=>f.value);return{validationStatus:f,errorMessage:u,isValidTokenAmount:k}}const an=Ve({emits:["toggle"],setup(e,{emit:t}){const a=O(!1);function s(){a.value=!a.value,t("toggle")}return{isRotated:a,toggle:s}}});const tn=e=>(ya("data-v-a887edec"),e=e(),_a(),e),sn=tn(()=>n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 21 18",class:"w-5 h-3 icon-swap-toggle"},[n("path",{d:"M6.26693 16.2421L6.26693 3.5252L8.70412 5.96238C9.03943 6.29801 9.58349 6.29801 9.91943 5.96238C10.2554 5.62676 10.2551 5.08301 9.91943 4.74707L6.01537 0.843008C5.97568 0.80332 5.93193 0.767695 5.88537 0.736133C5.87349 0.728633 5.86037 0.72332 5.84849 0.716445C5.81287 0.694883 5.77693 0.67332 5.73787 0.657383C5.72005 0.650195 5.70099 0.646758 5.68287 0.640195C5.64818 0.628633 5.6138 0.615508 5.57724 0.608008C5.52162 0.596758 5.46505 0.59082 5.40724 0.59082C5.34943 0.59082 5.29287 0.596758 5.23724 0.608008C5.20068 0.615195 5.1663 0.62832 5.13162 0.640195C5.11349 0.646758 5.09443 0.649883 5.07662 0.657383C5.03787 0.673633 5.00193 0.694883 4.96599 0.716445C4.95412 0.72332 4.94099 0.728633 4.92912 0.736133C4.88255 0.767695 4.8388 0.80332 4.79912 0.843008L0.895679 4.74645C0.727866 4.91426 0.643804 5.13395 0.643804 5.35395C0.643804 5.57395 0.727866 5.79363 0.895679 5.96145C1.23099 6.29707 1.77505 6.29707 2.11099 5.96145L4.54787 3.52488L4.54787 16.2418C4.54787 16.7164 4.93255 17.1011 5.40724 17.1011C5.88193 17.1011 6.26693 16.7168 6.26693 16.2421Z",class:"fill-current text-secondary"}),n("path",{d:"M15.7625 17.2669C15.7987 17.2597 15.8328 17.2469 15.8672 17.235C15.8856 17.2284 15.905 17.2253 15.9231 17.2175C15.9612 17.2013 15.9966 17.1806 16.0322 17.1591C16.0447 17.1519 16.0584 17.1462 16.0706 17.1384C16.1172 17.1069 16.1609 17.0713 16.2006 17.0316L20.1037 13.1284C20.4394 12.7928 20.4394 12.2491 20.1037 11.9131C19.7684 11.5775 19.2244 11.5775 18.8884 11.9131L16.4516 14.3497V1.63281C16.4516 1.15813 16.0669 0.773438 15.5922 0.773438C15.1175 0.773438 14.7328 1.15813 14.7328 1.63281V14.3497L12.2956 11.9125C11.9603 11.5769 11.4163 11.5769 11.0803 11.9125C10.9125 12.0803 10.8284 12.3 10.8284 12.52C10.8284 12.74 10.9125 12.9597 11.0803 13.1275L14.9841 17.0316C15.0238 17.0713 15.0675 17.1069 15.1141 17.1384C15.1262 17.1462 15.14 17.1519 15.1525 17.1591C15.1878 17.1803 15.2234 17.2013 15.2616 17.2175C15.2797 17.225 15.2991 17.2284 15.3175 17.235C15.3519 17.2466 15.3859 17.2594 15.4222 17.2669C15.4778 17.2778 15.5344 17.2841 15.5922 17.2841C15.65 17.2841 15.7069 17.2778 15.7625 17.2669Z",class:"text-blue-600 group-hover:text-pink-500 dark:text-blue-400 dark:group-hover:text-yellow-500 dark:group-focus:text-yellow-500 fill-current"})],-1)),on=[sn];function nn(e,t,a,s,o,d){return S(),V("div",{class:"group flex justify-center items-center w-9 h-9 bg-gray-50 dark:bg-gray-900 rounded-full shadow cursor-pointer toggle-btn",onClick:t[0]||(t[0]=(...r)=>e.toggle&&e.toggle(...r))},[n("div",{class:xa(["duration-300 ease-in-out",{"rotate-180":e.isRotated}])},on,2)])}const rn=Qe(an,[["render",nn],["__scopeId","data-v-a887edec"]]),ln={class:"flex items-center my-2"},un=n("div",{class:"mx-2 h-px bg-gray-100 dark:bg-gray-700 grow"},null,-1),cn=["innerHTML"],pn=Ve({__name:"SwapPair",props:{tokenInAmount:{},tokenInAddress:{},tokenOutAmount:{},tokenOutAddress:{},exactIn:{type:Boolean},priceImpact:{},effectivePriceMessage:{},swapLoading:{type:Boolean}},emits:["update:tokenInAmount","update:tokenInAddress","update:tokenOutAmount","update:tokenOutAddress","update:exactIn","amountChange"],setup(e,{emit:t}){const a=e,{fNum:s}=We(),{getToken:o}=Pe(),{veBalTokenInfo:d}=Mt(),r=O(""),m=O(""),p=O(""),f=O(""),k=O(!0),u=O(void 0),y=i(()=>!m.value||!f.value),h=i(()=>!r.value||!p.value),F=i(()=>o(m.value)),b=i(()=>o(f.value)),_=i(()=>{if(y.value||h.value)return"";if(a.effectivePriceMessage)return k.value?a.effectivePriceMessage.value.tokenIn:a.effectivePriceMessage.value.tokenOut;let c,W,L;return k.value?(c=re(p.value).div(r.value).toString(),W=F.value.symbol,L=b.value.symbol):(c=re(r.value).div(p.value).toString(),W=b.value.symbol,L=F.value.symbol),`1 ${W} = ${s(c,oe.token)} ${L}`});function E(c){u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{c()},300)}function $(c){t("update:tokenInAmount",c),E(()=>{t("amountChange")})}function C(c){t("update:tokenOutAmount",c),E(()=>{t("amountChange")})}function T(){t("update:exactIn",!a.exactIn),t("update:tokenInAmount",p.value),t("update:tokenInAddress",f.value),t("update:tokenOutAmount",r.value),t("update:tokenOutAddress",m.value),t("amountChange")}async function X(c){if(c===f.value){T();return}t("update:tokenInAddress",c)}async function K(c){if(c===m.value){T();return}t("update:tokenOutAddress",c)}return Rt(()=>{r.value=a.tokenInAmount,m.value=a.tokenInAddress,p.value=a.tokenOutAmount,f.value=a.tokenOutAddress}),la(()=>{a.tokenOutAmount&&C(a.tokenOutAmount)}),(c,W)=>(S(),V("div",null,[D(Wa,{amount:w(r),address:w(m),name:"tokenIn","aria-label":c.$t("inputLabels.tokenIn"),excludedTokens:w(d)?[w(d).address]:[],ignoreWalletBalance:c.swapLoading,autoFocus:"","onUpdate:amount":$,"onUpdate:address":X,onInput:W[0]||(W[0]=L=>t("update:exactIn",!0)),onSetMax:W[1]||(W[1]=L=>t("update:exactIn",!0))},null,8,["amount","address","aria-label","excludedTokens","ignoreWalletBalance"]),n("div",ln,[D(rn,{onToggle:T}),un,w(_)?(S(),V("div",{key:0,class:"flex items-center text-xs text-gray-600 dark:text-gray-400 cursor-pointer",onClick:W[2]||(W[2]=L=>k.value=!w(k)),innerHTML:w(_)},null,8,cn)):le("",!0)]),D(Wa,{amount:w(p),address:w(f),name:"tokenOut","aria-label":c.$t("inputLabels.tokenOut"),priceImpact:c.priceImpact,noRules:"",noMax:"",disableNativeAssetBuffer:"",excludedTokens:w(d)?[w(d).address]:[],"onUpdate:amount":C,"onUpdate:address":K,onInput:W[3]||(W[3]=L=>t("update:exactIn",!1))},null,8,["amount","address","aria-label","priceImpact","excludedTokens"])]))}}),dn=Ve({components:{SwapPair:pn,SwapPreviewModal:Uo,SwapRoute:mt,SwapSettingsPopover:Xt},setup(){const{inputAsset:e,outputAsset:t}=vt(),a=Vt(),{t:s}=Ye(),{bp:o}=Pa(),{fNum:d}=We(),{appNetworkConfig:r,isMismatchedNetwork:m}=Ue(),{nativeAsset:p}=Pe(),{tokenInAddress:f,tokenOutAddress:k,tokenInAmount:u,tokenOutAmount:y,setTokenInAddress:h,setTokenOutAddress:F,setTokenInAmount:b,setTokenOutAmount:_,setInitialized:E}=Ja(),$=O(!0),C=O(!1),T=O({highPriceImpact:!1}),X=ha("alwaysShowRoutes",!1),K=i(()=>{switch(o.value){case"xs":return"none";case"sm":return"lg";default:return"xl"}}),c=Xo($,f,u,k,y),{errorMessage:W}=en(f,u,k,y),L=i(()=>c.sor.validationErrors.value.highPriceImpact&&!T.value.highPriceImpact),G=i(()=>{const A=m.value,I=!u.value||!y.value,q=c.isCowswapSwap.value&&c.cowswap.hasValidationError.value,ee=c.isBalancerSwap.value&&L.value;return I||q||ee||A}),P=i(()=>{var A,I;return c.wrapType.value===_e.Wrap?`${s("wrap")} ${(A=c.tokenIn.value)==null?void 0:A.symbol}`:c.wrapType.value===_e.Unwrap?`${s("unwrap")} ${(I=c.tokenOut.value)==null?void 0:I.symbol}`:s("swap")}),g=i(()=>c.sor.pools.value),M=i(()=>{if(m.value)return{header:s("switchNetwork"),body:s("networkMismatch",[r.name])};if(c.isBalancerSwap.value&&!c.isLoading.value&&c.sor.validationErrors.value.noSwaps)return{header:s("insufficientLiquidity"),body:s("insufficientLiquidityDetailed")};if(c.isCowswapSwap.value){if(c.cowswap.validationError.value!=null){const A=c.cowswap.validationError.value;return A===ma.SellAmountDoesNotCoverFee?{header:s("cowswapErrors.lowAmount.header"),body:s("cowswapErrors.lowAmount.body")}:A===ma.PriceExceedsBalance?{header:s("cowswapErrors.lowBalance.header",[c.tokenIn.value.symbol]),body:s("cowswapErrors.lowBalance.body",[c.tokenIn.value.symbol,d(de(c.getQuote().maximumInAmount,c.tokenIn.value.decimals),oe.token),d(c.slippageBufferRate.value,oe.percent)])}:A===ma.NoLiquidity?{header:s("cowswapErrors.noLiquidity.header",[c.tokenIn.value.symbol]),body:s("cowswapErrors.noLiquidity.body")}:{header:s("cowswapErrors.genericError.header"),body:c.cowswap.validationError.value}}}else if(c.isBalancerSwap.value&&L.value)return{header:s("highPriceImpact"),body:s("highPriceImpactDetailed"),label:s("accept")}}),j=i(()=>{if(c.isCowswapSwap.value&&c.cowswap.warnings.value.highFees)return{header:s("cowswapWarnings.highFees.header"),body:s("cowswapWarnings.highFees.body")}});function R(){c.sor.validationErrors.value.highPriceImpact&&(T.value.highPriceImpact=!0)}function Q(A){var I,q;return(A==null?void 0:A.toLowerCase())===((I=p.deeplinkId)==null?void 0:I.toLowerCase())||(A==null?void 0:A.toLowerCase())===((q=p.symbol)==null?void 0:q.toLowerCase())}function U(A){for(const I of A){if(Q(I))return p.address;if(Lt(I))return ze(I)}}function Y(){var ge,ve;const A=U([a.currentRoute.value.params.assetIn,e.value,r.tokens.InitialSwapTokens.input]);A&&h(A);const I=U([a.currentRoute.value.params.assetOut,t.value,r.tokens.InitialSwapTokens.output]);I&&F(I);let q=(ge=a.currentRoute.value.query)==null?void 0:ge.inAmount,ee=(ve=a.currentRoute.value.query)==null?void 0:ve.outAmount;q&&b(q),!q&&ee&&_(ee)}function ne(){c.resetSubmissionError(),C.value=!0}function Se(){c.resetSubmissionError(),C.value=!1}return st(()=>{Y(),E(!0)}),{TOKENS:Ot,SwapSettingsContext:es,tokenInAddress:f,tokenInAmount:u,tokenOutAddress:k,tokenOutAmount:y,modalSwapPreviewIsOpen:C,alwaysShowRoutes:X,exactIn:$,swapping:c,pools:g,title:P,error:M,warning:j,errorMessage:W,isRequired:ls,swapDisabled:G,swapCardShadow:K,handlePreviewButton:ne,handlePreviewModalClose:Se,handleErrorButtonClick:R}}});const vn=e=>(ya("data-v-da03a3e5"),e=e(),_a(),e),mn={class:"flex justify-between items-center w-full"},wn={key:4,class:"flex items-center mt-5 h-8 text-sm"},fn={key:0,class:"text-secondary"},gn={class:"flex gap-2 items-center"},hn=vn(()=>n("span",{class:"text-lg"},"⛽",-1)),Sn={key:0},yn={key:1},_n={key:2},bn={key:1},kn={class:"flex items-center swap-gasless"},An=["textContent"],En={key:0,class:"pl-2 text-sm text-gray-600 dark:text-gray-400"},Tn={key:1,class:"pl-2 text-sm text-gray-600 dark:text-gray-400"},xn=["innerHTML"];function $n(e,t,a,s,o,d){const r=pa("SwapSettingsPopover"),m=pa("SwapPair"),p=ot,f=Xa,k=Wt,u=et,y=na,h=pa("SwapRoute"),F=ga,b=pa("SwapPreviewModal");return S(),V(Je,null,[D(F,{class:"relative card-container",shadow:e.swapCardShadow,noBorder:""},{header:Z(()=>[n("div",mn,[n("h4",null,B(e.title),1),D(r,{context:e.SwapSettingsContext.swap,isGasless:e.swapping.swapGasless.value},null,8,["context","isGasless"])])]),default:Z(()=>[n("div",null,[D(m,{tokenInAmount:e.tokenInAmount,"onUpdate:tokenInAmount":t[0]||(t[0]=_=>e.tokenInAmount=_),tokenInAddress:e.tokenInAddress,"onUpdate:tokenInAddress":t[1]||(t[1]=_=>e.tokenInAddress=_),tokenOutAmount:e.tokenOutAmount,"onUpdate:tokenOutAmount":t[2]||(t[2]=_=>e.tokenOutAmount=_),tokenOutAddress:e.tokenOutAddress,"onUpdate:tokenOutAddress":t[3]||(t[3]=_=>e.tokenOutAddress=_),exactIn:e.exactIn,"onUpdate:exactIn":t[4]||(t[4]=_=>e.exactIn=_),swapLoading:e.swapping.isBalancerSwap.value?e.swapping.isLoading.value:!1,effectivePriceMessage:e.swapping.effectivePriceMessage,class:"mb-4",onAmountChange:e.swapping.handleAmountChange},null,8,["tokenInAmount","tokenInAddress","tokenOutAmount","tokenOutAddress","exactIn","swapLoading","effectivePriceMessage","onAmountChange"]),e.error?(S(),J(p,{key:0,class:"p-3 mb-4",type:"error",size:"sm",title:e.error.header,description:e.error.body,actionLabel:e.error.label,block:"",onActionClick:e.handleErrorButtonClick},null,8,["title","description","actionLabel","onActionClick"])):e.warning?(S(),J(p,{key:1,class:"p-3 mb-4",type:"warning",size:"sm",title:e.warning.header,description:e.warning.body,block:""},null,8,["title","description"])):le("",!0),e.swapping.isLoading.value?(S(),J(f,{key:2,loading:"",disabled:"",loadingLabel:e.swapping.isCowswapSwap.value?e.$t("loadingBestPrice"):e.$t("loading"),block:""},null,8,["loadingLabel"])):(S(),J(f,{key:3,label:e.$t("preview"),disabled:e.swapDisabled,color:"gradient",block:"",onClick:Ya(e.handlePreviewButton,["prevent"])},null,8,["label","disabled","onClick"])),e.swapping.isCowswapSupportedOnNetwork.value?(S(),V("div",wn,[D(ka,{name:"fade",mode:"out-in"},{default:Z(()=>[e.swapping.isGaslessSwappingDisabled.value?(S(),V("div",fn,[n("div",gn,[hn,D(ka,{name:"fade",mode:"out-in"},{default:Z(()=>[e.swapping.isWrap.value?(S(),V("p",Sn,B(e.$t("swapToggle.wrapEth")),1)):e.swapping.isUnwrap.value?(S(),V("p",yn,B(e.$t("swapToggle.unwrapEth")),1)):(S(),V("p",_n,B(e.$t("swapToggle.fromEth")),1))]),_:1})])])):(S(),V("div",bn,[n("div",kn,[D(u,{width:"64",disabled:!e.swapping.isGaslessSwappingDisabled.value},{activator:Z(()=>[D(k,{name:"swapGasless",checked:e.swapping.swapGasless.value,disabled:e.swapping.isGaslessSwappingDisabled.value,onToggle:e.swapping.toggleSwapGasless},null,8,["checked","disabled","onToggle"])]),default:Z(()=>[n("div",{textContent:B(e.swapping.isWrapUnwrapSwap.value?e.$t("swapGaslessToggle.disabledTooltip.wrapUnwrap"):e.$t("swapGaslessToggle.disabledTooltip.eth"))},null,8,An)]),_:1},8,["disabled"]),D(ka,{name:"fade",mode:"out-in"},{default:Z(()=>[e.swapping.swapGasless.value?(S(),V("span",En,B(e.$t("swapToggle.swapGasless")),1)):(S(),V("span",Tn,B(e.$t("swapToggle.swapWithGas")),1))]),_:1}),D(u,{width:"64"},{activator:Z(()=>[D(y,{name:"info",size:"xs",class:"flex ml-1 text-gray-400"})]),default:Z(()=>[n("div",{innerHTML:e.$t("swapGaslessToggle.tooltip")},null,8,xn)]),_:1})])]))]),_:1})])):le("",!0),e.alwaysShowRoutes?(S(),J(h,{key:5,addressIn:e.swapping.tokenIn.value.address,amountIn:e.swapping.tokenInAmountInput.value,addressOut:e.swapping.tokenOut.value.address,amountOut:e.swapping.tokenOutAmountInput.value,pools:e.pools,sorReturn:e.swapping.sor.sorReturn.value,class:"mt-4"},null,8,["addressIn","amountIn","addressOut","amountOut","pools","sorReturn"])):le("",!0)])]),_:1},8,["shadow"]),(S(),J(Nt,{to:"#modal"},[e.modalSwapPreviewIsOpen?(S(),J(b,{key:0,swapping:e.swapping,error:e.error,warning:e.warning,onClose:e.handlePreviewModalClose},null,8,["swapping","error","warning","onClose"])):le("",!0)]))],64)}const Cn=Qe(dn,[["render",$n],["__scopeId","data-v-da03a3e5"]]),Pn=["src","alt"],Za=Ve({__name:"BridgeLink",setup(e){const{networkId:t}=tt(),a=i(()=>ke.network.bridgeUrl),s=i(()=>`Bridge assets to ${ke.network.chainName}`);return(o,d)=>{const r=na,m=ps;return S(),J(m,{href:a.value,external:"",noStyle:"",class:"flex items-center p-4 text-sm dark:bg-gray-850 rounded-lg border dark:border-0"},{default:Z(()=>[n("img",{src:w(ds)(w(t)),alt:s.value,class:"mr-4 w-6 h-6"},null,8,Pn),wa(" "+B(s.value)+" ",1),D(r,{name:"arrow-up-right",size:"sm",class:"ml-2 text-gray-500 hover:text-blue-500 dark:hover:text-blue-400 transition-colors"})]),_:1},8,["href"])}}}),Bn={class:"p-4 sm:p-0 lg:p-0 mt-8"},Fn=Ve({__name:"swap",setup(e){vs();const{setSelectedTokens:t}=cs(),{upToLargeBreakpoint:a}=Pa(),s=i(()=>{const o=[{title:"My wallet",id:"my-wallet"},{title:"Price chart",id:"price-chart"}];return Aa.value&&o.push({title:"Bridge assets",id:"bridge"}),o});return la(()=>{t([])}),(o,d)=>{const r=ht;return S(),V("div",null,[D(us,{offsetGutters:"",mobileHideGutters:"",class:"mt-8"},{gutterLeft:Z(()=>[D(Oa)]),gutterRight:Z(()=>[D(Va),w(Aa)?(S(),J(Za,{key:0,class:"mt-4"})):le("",!0)]),default:Z(()=>[D(Cn),n("div",Bn,[w(a)?(S(),J(r,{key:0,class:"w-full",sections:s.value},Ut({"my-wallet":Z(()=>[D(Oa)]),"price-chart":Z(()=>[D(Va)]),_:2},[w(Aa)?{name:"bridge",fn:Z(()=>[D(Za)]),key:"0"}:void 0]),1032,["sections"])):le("",!0)])]),_:1})])}}});const Qr=Qe(Fn,[["__scopeId","data-v-515e550b"]]);export{Qr as default};
//# sourceMappingURL=swap-ee743845.js.map
