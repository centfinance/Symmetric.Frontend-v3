var L=Object.defineProperty;var D=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var I=(n,e,t)=>(D(n,typeof e!="symbol"?e+"":e,t),t);import{C as y,o as A}from"./usePoolHelpers-eb955974.js";import{Q as R,a3 as W,n as U,N as d,aa as P}from"./connector-16147cef.js";import{bp as c,br as b,bq as v,by as B,bz as N,aP as O,b2 as Y,bA as G,bB as _,bC as q,bD as l,bE as g,aq as H,a_ as K,aZ as Q,bF as $}from"./BalBtn-cca6788c.js";import{aj as Z,u as w,r as z,s as J}from"./runtime-core.esm-bundler-558f8953.js";import{i as j}from"./useQueryHelpers-8fe10019.js";import{d as C,c as V,b as X,e as ee}from"./useVeBAL-5fa15e49.js";import{g as F,b as te}from"./index-155f0d25.js";function x(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?x=function(t){return typeof t}:x=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(n)}function M(n,e){if(c(2,arguments),!e||x(e)!=="object")return new Date(NaN);var t=e.years?b(e.years):0,a=e.months?b(e.months):0,s=e.weeks?b(e.weeks):0,i=e.days?b(e.days):0,u=e.hours?b(e.hours):0,p=e.minutes?b(e.minutes):0,r=e.seconds?b(e.seconds):0,f=v(n),T=a||t?B(f,a+t*12):f,E=i||s?N(T,i+s*7):T,o=p+u*60,h=r+o*60,m=h*1e3,S=new Date(E.getTime()+m);return S}var ae=6e4,ne=36e5;function se(n,e){c(2,arguments);var t=v(n),a=v(e);return t.getFullYear()-a.getFullYear()}function ie(n,e,t){c(2,arguments);var a=C(n,e)/ne;return F(t==null?void 0:t.roundingMethod)(a)}function re(n,e,t){c(2,arguments);var a=C(n,e)/ae;return F(t==null?void 0:t.roundingMethod)(a)}function ue(n,e){c(2,arguments);var t=v(n),a=v(e),s=V(t,a),i=Math.abs(se(t,a));t.setFullYear(1584),a.setFullYear(1584);var u=V(t,a)===-s,p=s*(i-Number(u));return p===0?0:p}function oe(n){c(1,arguments);var e=v(n),t=e.getDay();return t}function k(n){c(1,arguments);var e=v(n.start),t=v(n.end);if(isNaN(e.getTime()))throw new RangeError("Start Date is invalid");if(isNaN(t.getTime()))throw new RangeError("End Date is invalid");var a={};a.years=Math.abs(ue(t,e));var s=V(t,e),i=M(e,{years:s*a.years});a.months=Math.abs(X(t,i));var u=M(i,{months:s*a.months});a.days=Math.abs(te(t,u));var p=M(u,{days:s*a.days});a.hours=Math.abs(ie(t,p));var r=M(p,{hours:s*a.hours});a.minutes=Math.abs(re(t,r));var f=M(r,{minutes:s*a.minutes});return a.seconds=Math.abs(ee(t,f)),a}function pe(n,e){c(2,arguments);var t=e-oe(n);return t<=0&&(t+=7),N(n,t)}function de(n){return c(1,arguments),pe(n,4)}const le=[{name:"CommitOwnership",inputs:[{name:"admin",type:"address",indexed:!1}],anonymous:!1,type:"event"},{name:"ApplyOwnership",inputs:[{name:"admin",type:"address",indexed:!1}],anonymous:!1,type:"event"},{name:"AddType",inputs:[{name:"name",type:"string",indexed:!1},{name:"type_id",type:"int128",indexed:!1}],anonymous:!1,type:"event"},{name:"NewTypeWeight",inputs:[{name:"type_id",type:"int128",indexed:!1},{name:"time",type:"uint256",indexed:!1},{name:"weight",type:"uint256",indexed:!1},{name:"total_weight",type:"uint256",indexed:!1}],anonymous:!1,type:"event"},{name:"NewGaugeWeight",inputs:[{name:"gauge_address",type:"address",indexed:!1},{name:"time",type:"uint256",indexed:!1},{name:"weight",type:"uint256",indexed:!1},{name:"total_weight",type:"uint256",indexed:!1}],anonymous:!1,type:"event"},{name:"VoteForGauge",inputs:[{name:"time",type:"uint256",indexed:!1},{name:"user",type:"address",indexed:!1},{name:"gauge_addr",type:"address",indexed:!1},{name:"weight",type:"uint256",indexed:!1}],anonymous:!1,type:"event"},{name:"NewGauge",inputs:[{name:"addr",type:"address",indexed:!1},{name:"gauge_type",type:"int128",indexed:!1},{name:"weight",type:"uint256",indexed:!1}],anonymous:!1,type:"event"},{stateMutability:"nonpayable",type:"constructor",inputs:[{name:"_voting_escrow",type:"address"}],outputs:[]},{stateMutability:"view",type:"function",name:"token",inputs:[],outputs:[{name:"",type:"address"}]},{stateMutability:"view",type:"function",name:"voting_escrow",inputs:[],outputs:[{name:"",type:"address"}]},{stateMutability:"nonpayable",type:"function",name:"commit_transfer_ownership",inputs:[{name:"addr",type:"address"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"apply_transfer_ownership",inputs:[],outputs:[]},{stateMutability:"view",type:"function",name:"gauge_types",inputs:[{name:"_addr",type:"address"}],outputs:[{name:"",type:"int128"}]},{stateMutability:"nonpayable",type:"function",name:"add_gauge",inputs:[{name:"addr",type:"address"},{name:"gauge_type",type:"int128"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"add_gauge",inputs:[{name:"addr",type:"address"},{name:"gauge_type",type:"int128"},{name:"weight",type:"uint256"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"checkpoint",inputs:[],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"checkpoint_gauge",inputs:[{name:"addr",type:"address"}],outputs:[]},{stateMutability:"view",type:"function",name:"gauge_relative_weight",inputs:[{name:"addr",type:"address"},{name:"time",type:"uint256"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"nonpayable",type:"function",name:"gauge_relative_weight_write",inputs:[{name:"addr",type:"address"},{name:"time",type:"uint256"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"nonpayable",type:"function",name:"add_type",inputs:[{name:"_name",type:"string"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"add_type",inputs:[{name:"_name",type:"string"},{name:"weight",type:"uint256"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"change_type_weight",inputs:[{name:"type_id",type:"int128"},{name:"weight",type:"uint256"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"change_gauge_weight",inputs:[{name:"addr",type:"address"},{name:"weight",type:"uint256"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"vote_for_many_gauge_weights",inputs:[{name:"_gauge_addrs",type:"address[8]"},{name:"_user_weight",type:"uint256[8]"}],outputs:[]},{stateMutability:"nonpayable",type:"function",name:"vote_for_gauge_weights",inputs:[{name:"_gauge_addr",type:"address"},{name:"_user_weight",type:"uint256"}],outputs:[]},{stateMutability:"view",type:"function",name:"get_gauge_weight",inputs:[{name:"addr",type:"address"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"get_type_weight",inputs:[{name:"type_id",type:"int128"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"get_total_weight",inputs:[],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"get_weights_sum_per_type",inputs:[{name:"type_id",type:"int128"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"admin",inputs:[],outputs:[{name:"",type:"address"}]},{stateMutability:"view",type:"function",name:"future_admin",inputs:[],outputs:[{name:"",type:"address"}]},{stateMutability:"view",type:"function",name:"n_gauge_types",inputs:[],outputs:[{name:"",type:"int128"}]},{stateMutability:"view",type:"function",name:"n_gauges",inputs:[],outputs:[{name:"",type:"int128"}]},{stateMutability:"view",type:"function",name:"gauge_type_names",inputs:[{name:"arg0",type:"int128"}],outputs:[{name:"",type:"string"}]},{stateMutability:"view",type:"function",name:"gauges",inputs:[{name:"arg0",type:"uint256"}],outputs:[{name:"",type:"address"}]},{stateMutability:"view",type:"function",name:"vote_user_slopes",inputs:[{name:"arg0",type:"address"},{name:"arg1",type:"address"}],outputs:[{name:"",type:"tuple",components:[{name:"slope",type:"uint256"},{name:"power",type:"uint256"},{name:"end",type:"uint256"}]}]},{stateMutability:"view",type:"function",name:"vote_user_power",inputs:[{name:"arg0",type:"address"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"last_user_vote",inputs:[{name:"arg0",type:"address"},{name:"arg1",type:"address"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"points_weight",inputs:[{name:"arg0",type:"address"},{name:"arg1",type:"uint256"}],outputs:[{name:"",type:"tuple",components:[{name:"bias",type:"uint256"},{name:"slope",type:"uint256"}]}]},{stateMutability:"view",type:"function",name:"time_weight",inputs:[{name:"arg0",type:"address"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"points_sum",inputs:[{name:"arg0",type:"int128"},{name:"arg1",type:"uint256"}],outputs:[{name:"",type:"tuple",components:[{name:"bias",type:"uint256"},{name:"slope",type:"uint256"}]}]},{stateMutability:"view",type:"function",name:"time_sum",inputs:[{name:"arg0",type:"uint256"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"points_total",inputs:[{name:"arg0",type:"uint256"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"time_total",inputs:[],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"points_type_weight",inputs:[{name:"arg0",type:"int128"},{name:"arg1",type:"uint256"}],outputs:[{name:"",type:"uint256"}]},{stateMutability:"view",type:"function",name:"time_type_weight",inputs:[{name:"arg0",type:"uint256"}],outputs:[{name:"",type:"uint256"}]}],me=1648684800;class ye{constructor(e=le,t=R){I(this,"multicaller");I(this,"network");I(this,"provider");this.abi=e,this.config=t,this.network=this.getNetwork(),this.provider=O.getJsonProvider(this.network),this.multicaller=this.resetMulticaller()}async decorateWithVotes(e,t){const a=e.map(u=>u.gauge);this.multicaller=this.resetMulticaller(),this.callGaugeWeightThisPeriod(a),this.callGaugeWeightNextPeriod(a),t&&(this.callUserGaugeVotes(a,t),this.callUserGaugeVoteTime(a,t));const s=await this.multicaller.execute();return e.map(u=>({...u,...this.formatVotes(s.gauges[u.gauge.address])}))}formatVotes(e){var s,i;const t=e.gaugeWeightThisPeriod.toString(),a=e.gaugeWeightNextPeriod.toString();return{votes:t,votesNextPeriod:a,userVotes:((s=e==null?void 0:e.userVotes)==null?void 0:s.power.toString())||"0",lastUserVoteTime:((i=e==null?void 0:e.lastUserVoteTime)==null?void 0:i.toNumber())||0}}callGaugeWeightThisPeriod(e){let t=G(Math.floor(Date.now()/_)*_);t==me&&(t=t-q),e.forEach(a=>{this.multicaller.call(`gauges.${a.address}.gaugeWeightThisPeriod`,this.config.network.addresses.gaugeController,"gauge_relative_weight_write",[a.address,t])})}callGaugeWeightNextPeriod(e){const t=G(Math.floor((Date.now()+_)/_)*_);e.forEach(a=>{this.multicaller.call(`gauges.${a.address}.gaugeWeightNextPeriod`,this.config.network.addresses.gaugeController,"gauge_relative_weight_write",[a.address,t])})}callUserGaugeVotes(e,t){e.forEach(a=>{this.multicaller.call(`gauges.${a.address}.userVotes`,this.config.network.addresses.gaugeController,"vote_user_slopes",[t,a.address])})}callUserGaugeVoteTime(e,t){e.forEach(a=>{this.multicaller.call(`gauges.${a.address}.lastUserVoteTime`,this.config.network.addresses.gaugeController,"last_user_vote",[t,a.address])})}getNetwork(){return W.value?U.value:d.MAINNET}resetMulticaller(){const e=Y();return new e(this.network.toString(),this.provider,this.abi)}}function ge(n){const e={chain:n,id:"0xf8a0623ab66f985effc1c69d05f1af4badb01b00000200000000000000000060",address:"0xf8a0623ab66F985EfFc1C69D05F1af4BaDB01b00",type:l.Stable,symbol:"vTSYMM",tokens:[{address:"0x33A99Dcc4C85C014cf12626959111D5898bbCAbF",weight:null,symbol:"vTSYMM",logoURI:"https://raw.githubusercontent.com/balancer/assets/master/assets/0x5c6ee304399dbdb9c8ef030ab642b10820db8f56.png"}],gauge:{address:"0xF2ca6F8961e91F1ee0D688F9926183314D866f1E",isKilled:!1,addedTimestamp:1654312627,relativeWeightCap:null}},t={chain:n,id:"0x16faf9f73748013155b7bc116a3008b57332d1e600020000000000000000005b",address:"0x16faF9f73748013155B7bC116a3008b57332D1e6",type:l.Weighted,symbol:"B-50WBTC-50WETH",tokens:[{address:"0x37f03a12241E9FD3658ad6777d289c3fb8512Bc9",weight:"0.5",symbol:"WBTC",logoURI:""},{address:"0xdFCeA9088c8A88A76FF74892C1457C17dfeef9C1",weight:"0.5",symbol:"WETH",logoURI:""}],gauge:{address:"0xf0f572ad66baacDd07d8c7ea3e0E5EFA56a76081",isKilled:!1,relativeWeightCap:null,addedTimestamp:1654312702}};return[e,t]}function ce(n){switch(n){case g.Arbitrum:return d.ARBITRUM;case g.Avalanche:return d.AVALANCHE;case g.Base:return d.BASE;case g.Gnosis:return d.GNOSIS;case g.Fantom:return d.FANTOM;case g.Optimism:return d.OPTIMISM;case g.Polygon:return d.POLYGON;case g.Mainnet:return d.MAINNET;case g.Zkevm:return d.ZKEVM;case"SEPOLIA":return d.SEPOLIA;case"GOERLI":return d.GOERLI;default:throw new Error(`Unexpected API chain: ${n}`)}}function fe(n){switch(n){case l.Element:return y.Element;case l.Gyro3:return y.Gyro3;case l.Gyroe:return y.GyroE;case l.Investment:return y.Investment;case l.Linear:return y.Linear;case l.LiquidityBootstrapping:return y.LiquidityBootstrapping;case l.MetaStable:return y.MetaStable;case l.PhantomStable:return y.StablePhantom;case l.Stable:return y.Stable;case l.Weighted:return y.Weighted;default:return null}}function he(n={}){const{account:e}=H(),t=Q.Gauges.Voting(e),a=async()=>{try{let i;if(W.value)i=ge("GOERLI");else{const r=$(),{veBalGetVotingList:f}=await r.VeBalGetVotingList();i=f}return(await new ye().decorateWithVotes(i,e.value)).map(r=>({...r,network:ce(r.chain),poolType:fe(r.type)})).map(r=>Object.freeze(r))}catch(i){return console.error("Failed to get voting pools",i),[]}},s=Z({enabled:!0,...n});return K(t,a,s)}function xe(n){return A(n.tokens)}function Pe(n){return A(n.tokens).map(e=>e.logoURI)}function Ve(n){return[P.IdsMap.veBAL,P.IdsMap.veLIT,P.IdsMap.veUSH].includes(n.id.toLowerCase())}function Se(){const e=he(),t=w(()=>j(e)),a=w(()=>e.data.value||[]),s=w(()=>a.value.map(o=>o.gauge)),i=w(()=>a.value.map(o=>o.gauge.address)||[]),u=w(()=>t.value||!a.value?1e4:a.value.reduce((h,m)=>h-parseFloat(m.userVotes),1e4)),p=z(Date.now()),r=setInterval(()=>{p.value=Date.now()},1e3);J(()=>{r&&clearInterval(r)});const f=w(()=>{const o=E(),h={start:p.value,end:o},m=k(h);return[(m.days||0)%7,m.hours||0,m.minutes||0,m.seconds||0]}),T=w(()=>{const o=E(),h={start:p.value,end:o},m=k(h);return(m.days||0)<1&&(m.hours||0)<1});function E(){const o=de(new Date);return Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0)}return{totalVotes:1e4,isLoading:t,isRefetchingVotingPools:e.isRefetching,votingPools:a,votingGauges:s,votingGaugeAddresses:i,unallocatedVotes:u,votingPeriodEnd:f,votingPeriodLastHour:T,votingPoolsQuery:e,refetchVotingPools:e.refetch}}export{le as G,xe as a,oe as g,Ve as i,de as n,Pe as o,Se as u};
//# sourceMappingURL=useVotingPools-44058ee3.js.map
