var p=Object.defineProperty;var g=(a,e,s)=>e in a?p(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var f=(a,e,s)=>(g(a,typeof e!="symbol"?e+"":e,s),s);import{e as v}from"./events-5f626723.js";import{S as m}from"./index-1de0572e.js";import{ai as k,aj as _}from"./connector-16147cef.js";import"./_commonjsHelpers-87174ba5.js";import"./runtime-core.esm-bundler-558f8953.js";var l={},c={},h={};Object.defineProperty(h,"__esModule",{value:!0});h.getLowerCase=void 0;function b(a){return a&&a.toLowerCase()}h.getLowerCase=b;Object.defineProperty(c,"__esModule",{value:!0});c.SafeAppProvider=void 0;const y=v,u=h;class w{constructor(e,s){this.submittedTxs=new Map,this.events=new y.EventEmitter,this.safe=e,this.sdk=s}async connect(){this.events.emit("connect",{chainId:this.chainId})}async disconnect(){}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}get chainId(){return this.safe.chainId}async request(e){const{method:s,params:t=[]}=e;switch(s){case"eth_accounts":return[this.safe.safeAddress];case"net_version":case"eth_chainId":return`0x${this.chainId.toString(16)}`;case"eth_sendTransaction":const r=Object.assign({value:"0",data:"0x"},t[0]),d=await this.sdk.txs.send({txs:[r]});return this.submittedTxs.set(d.safeTxHash,{from:this.safe.safeAddress,hash:d.safeTxHash,gas:0,gasPrice:"0x00",nonce:0,input:r.data,value:r.value,to:r.to,blockHash:null,blockNumber:null,transactionIndex:null}),d.safeTxHash;case"eth_blockNumber":return(await this.sdk.eth.getBlockByNumber(["latest"])).number;case"eth_getBalance":return this.sdk.eth.getBalance([u.getLowerCase(t[0]),t[1]]);case"eth_getCode":return this.sdk.eth.getCode([u.getLowerCase(t[0]),t[1]]);case"eth_getStorageAt":return this.sdk.eth.getStorageAt([u.getLowerCase(t[0]),t[1],t[2]]);case"eth_getBlockByNumber":return this.sdk.eth.getBlockByNumber([t[0],t[1]]);case"eth_getBlockByHash":return this.sdk.eth.getBlockByHash([t[0],t[1]]);case"eth_getTransactionByHash":let i=t[0];try{i=(await this.sdk.txs.getBySafeTxHash(i)).txHash||i}catch{}return this.submittedTxs.has(i)?this.submittedTxs.get(i):this.sdk.eth.getTransactionByHash([i]).then(n=>(n&&(n.hash=t[0]),n));case"eth_getTransactionReceipt":{let n=t[0];try{n=(await this.sdk.txs.getBySafeTxHash(n)).txHash||n}catch{}return this.sdk.eth.getTransactionReceipt([n]).then(o=>(o&&(o.transactionHash=t[0]),o))}case"eth_estimateGas":return 0;case"eth_call":return this.sdk.eth.call([t[0],t[1]]);case"eth_getLogs":return this.sdk.eth.getPastLogs([t[0]]);default:throw Error(`"${e.method}" not implemented`)}}send(e,s){e||s("Undefined request"),this.request(e).then(t=>s(null,{jsonrpc:"2.0",id:e.id,result:t})).catch(t=>s(t,null))}}c.SafeAppProvider=w;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.SafeAppProvider=void 0;var e=c;Object.defineProperty(a,"SafeAppProvider",{enumerable:!0,get:function(){return e.SafeAppProvider}})})(l);class P extends k{constructor(){super(...arguments);f(this,"id",_.Gnosis)}async connect(){const s=new m,t=await s.safe.getInfo(),r=new l.SafeAppProvider(t,s);return r?(this.provider=r,this.active.value=!0,this.handleChainChanged(t.chainId),this.handleAccountsChanged([t.safeAddress])):console.error("Tried to connect to Gnosis Safe but it was not detected. Please install make sure you are using the Gnosis interface."),{provider:r,account:this.account,chainId:this.chainId}}}export{P as SafeConnector};
//# sourceMappingURL=gnosis.connector-193bd29c.js.map
