import{_ as ie}from"./BalStack.vue_vue_type_script_lang-342e535e.js";import{aq as ae,ao as oe,aA as re,b_ as le,au as ce,aQ as ue,c0 as de,aw as pe}from"./BalBtn-cca6788c.js";import{_ as fe}from"./BalTooltip.vue_vue_type_style_index_0_lang-8bf6235c.js";import{g as me,_ as ge}from"./wallet-logos-346092ca.js";import{d as F,u as v,b as r,p as f,F as U,k as _e,x as P,i as b,j as L,l as k,q as j,z as a,c as C,v as z,r as B,o as ve,C as D,n as be,h as ye,ap as he,A as Ae}from"./runtime-core.esm-bundler-558f8953.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as xe}from"./BalAlert-fdfde589.js";import{a as x}from"./anime.es-de4e5aa0.js";import{b as ke,p as Ce}from"./useTransactions-114fc9d7.js";var o=(e=>(e[e.Todo=0]="Todo",e[e.Active=1]="Active",e[e.WalletOpen=2]="WalletOpen",e[e.Pending=3]="Pending",e[e.Success=4]="Success",e[e.Warning=5]="Warning",e[e.Error=6]="Error",e[e.Completed=7]="Completed",e))(o||{});const we={class:"flex items-center"},Be=["src"],Le={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},Te={key:3},We=F({__name:"BalHorizSteps",props:{steps:{default:()=>[{tooltip:"You did this",state:o.Success},{tooltip:"Wallet is tiggered",state:o.WalletOpen},{tooltip:"This is pending",state:o.Pending},{tooltip:"Do this now",state:o.Active},{tooltip:"Do this next",state:o.Todo}]},spacerWidth:{default:16}},setup(e){const c=o,{connector:s,provider:y}=ae(),p=v(()=>{var i;return me((i=s==null?void 0:s.value)==null?void 0:i.id,y)});function m(i){switch(i){case o.Success:return"border-green-500 dark:border-green-500 text-green-500";case o.Pending:return"border-none dark:border-none text-orange-500";case o.Active:return"border-purple-500 dark:border-purple-500 text-gradient";case o.WalletOpen:return"border-purple-500 dark:border-purple-500 text-gradient";default:return"dark:border-gray-700"}}return(i,H)=>{const T=oe,W=ge,$=fe;return r(),f("div",we,[(r(!0),f(U,null,_e(i.steps,(g,u)=>(r(),f("div",{key:u,class:"flex items-center"},[u!==0?(r(),f("div",{key:0,class:P(["h-px bg-gray-100 dark:bg-gray-700",`w-${i.spacerWidth}`])},null,2)):b("",!0),L($,{text:g.tooltip,width:"44",textAlign:"center"},{activator:k(()=>[j("div",{class:P(["step",m(g.state)])},[g.state===a(c).Success?(r(),C(T,{key:0,name:"check"})):g.state===a(c).WalletOpen?(r(),f("img",{key:1,src:a(p),class:"w-4 h-4"},null,8,Be)):g.state===a(c).Pending?(r(),f(U,{key:2},[j("span",Le,z(u+1),1),L(W,{class:"w-8 h-8 animate-spin"})],64)):(r(),f("span",Te,z(u+1),1))],2)]),_:2},1032,["text"])]))),128))])}}});const $e=X(We,[["__scopeId","data-v-d15daee0"]]),Ee=F({props:{initial:{type:Object,default:()=>({opacity:0})},animate:{type:Object,default:()=>({opacity:1})},exit:{type:Object,default:()=>({opacity:0})},unmountInstantly:{type:Boolean,default:()=>!1},isVisible:{type:Boolean,default:()=>!0}},emits:["on-exit","update-dimensions","on-presence"],setup(e,{emit:c}){const s=B();return ve(()=>{s.value&&x.set(s.value,{...e.initial})}),D(()=>e.isVisible,async()=>{e.isVisible&&(await be(),s.value&&x.set(s.value,{...e.initial}))}),{animateContainer:s,enter:async(m,i)=>{c("on-presence",{isCompleted:!1}),setTimeout(()=>{x({targets:m,...e.animate,easing:"spring(0.2, 80, 10, 0)",complete:()=>{i(),c("on-presence",{isCompleted:!0})}})},0),setTimeout(()=>{s.value&&c("update-dimensions",{width:s.value.offsetWidth,height:s.value.offsetHeight})},0)},leave:(m,i)=>{e.unmountInstantly&&(i(),c("on-exit",{isCompleted:!0})),x.set(m,{"pointer-events":"none"}),x({targets:m,...e.exit,easing:"spring(0.2, 80, 10, 0)",complete:()=>{i(),c("on-exit",{isCompleted:!0})}})}}}}),Ve={key:0,id:"animateContainer",ref:"animateContainer"};function Oe(e,c,s,y,p,m){return r(),C(re,{class:"relative",appear:"",css:!1,onEnter:e.enter,onLeave:e.leave},{default:k(()=>[e.isVisible?(r(),f("div",Ve,[ye(e.$slots,"default")],512)):b("",!0)]),_:3},8,["onEnter","onLeave"])}const Pe=X(Ee,[["render",Oe]]),je="/assets/signature-fc5d986c.svg",ze=["src"],De={key:1,class:"w-8"},Ge=F({__name:"BalActionSteps",props:{actions:{},primaryActionType:{},disabled:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},loadingLabel:{default:""}},emits:["success","failed","setCurrentActionIndex"],setup(e,{emit:c}){const s=e,y={init:!1,confirming:!1,confirmed:!1,confirmedAt:""},p=B(0),m=B(s.actions),i=B([]);he(()=>{i.value=s.actions.map(()=>({...y}))}),D(()=>s.actions,n=>{n.forEach((t,l)=>{m.value[l]=t,i.value[l]||(i.value[l]={...y})})},{deep:!0}),D(()=>p.value,n=>{c("setCurrentActionIndex",n)},{immediate:!0});const{txListener:H,getTxConfirmedAt:T}=ke(),{formatErrorMsg:W}=le(),{t:$}=ce(),g=v(()=>m.value.map((n,t)=>{const l=i.value[t];return{label:n.label,loadingLabel:l.init?n.loadingLabel:n.confirmingLabel,pending:l.init||l.confirming,isSignAction:n.isSignAction,promise:ne.bind(null,n,l),step:{tooltip:n.stepTooltip,state:ee(l,t)}}})),u=v(()=>g.value[p.value]),E=v(()=>i.value[p.value]),I=v(()=>i.value[i.value.length-1]),M=v(()=>g.value.map(n=>n.step)),Z=v(()=>13-M.value.length),S=v(()=>{var n;return(n=u.value)!=null&&n.pending?u.value.loadingLabel:s.loadingLabel||$("loading")});function ee(n,t){return p.value<t?o.Todo:n.confirming?o.Pending:n.init?o.WalletOpen:n.confirmed?o.Success:o.Active}async function ne(n,t){var _;const{action:l}=n;try{t.init=!0,t.error=null;const d=await l();if(t.init=!1,t.confirming=!0,(_=u.value)!=null&&_.isSignAction){te(t);return}d&&se(d,t,n)}catch(d){t.init=!1,t.confirming=!1,t.error=W(d),ue({error:(d==null?void 0:d.cause)||d,action:s.primaryActionType,context:{level:"fatal"}})}}function te(n){p.value+=1,n.confirming=!1,n.confirmed=!0}async function se(n,t,l){const{postActionValidation:_,actionInvalidReason:d}=l;await H(n,{onTxConfirmed:async h=>{if(t.receipt=h,await Ce(n),await(_==null?void 0:_())||!_){const w=await T(h);t.confirmedAt=de(w),t.confirmed=!0,p.value>=g.value.length-1?c("success",h,t.confirmedAt):p.value+=1}else d&&(t.error=d),t.init=!1;t.confirming=!1},onTxFailed:()=>{t.confirming=!1,c("failed")}})}return(n,t)=>{const l=xe,_=$e,d=pe,h=ie;return r(),f("div",null,[L(Pe,{isVisible:""},{default:k(()=>{var V,w,N,q,Q;return[(V=a(E))!=null&&V.error&&!n.isLoading?(r(),C(l,{key:0,type:"error",title:(N=(w=a(E))==null?void 0:w.error)==null?void 0:N.title,description:(Q=(q=a(E))==null?void 0:q.error)==null?void 0:Q.description,block:"",class:"mb-4"},null,8,["title","description"])):b("",!0),L(h,{vertical:""},{default:k(()=>{var R,Y,G;return[a(g).length>1&&!((R=a(I))!=null&&R.confirmed)?(r(),C(_,{key:0,steps:a(M),spacerWidth:a(Z),class:"flex justify-center"},null,8,["steps","spacerWidth"])):b("",!0),(Y=a(I))!=null&&Y.confirmed?b("",!0):(r(),C(d,{key:1,disabled:s.disabled,color:"gradient",loading:((G=a(u))==null?void 0:G.pending)||n.isLoading,loadingLabel:a(S),block:"",onClick:t[0]||(t[0]=O=>{var A;return(A=a(u))==null?void 0:A.promise()})},{default:k(()=>{var O,A,J,K;return[j("div",{class:P({"flex grow justify-between items-center":(O=a(u))==null?void 0:O.isSignAction})},[(A=a(u))!=null&&A.isSignAction?(r(),f("img",{key:0,src:a(je)},null,8,ze)):b("",!0),Ae(" "+z((J=a(u))==null?void 0:J.label)+" ",1),(K=a(u))!=null&&K.isSignAction?(r(),f("div",De)):b("",!0)],2)]}),_:1},8,["disabled","loading","loadingLabel"]))]}),_:1})]}),_:1})])}}});export{Pe as A,o as S,Ge as _};
//# sourceMappingURL=BalActionSteps.vue_vue_type_script_setup_true_lang-f37eca6e.js.map
