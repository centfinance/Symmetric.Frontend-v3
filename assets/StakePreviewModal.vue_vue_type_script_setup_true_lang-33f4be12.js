import{_ as x}from"./balancer-sdk-d0995fe4.js";import{aS as j,aU as V,av as K,au as aa,aq as ea,ao as ta,aw as oa}from"./BalBtn-cca6788c.js";import{A as sa,_ as na}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-f37eca6e.js";import{_ as ia}from"./BalAssetSet-0f096fdb.js";import{_ as la}from"./BalStack.vue_vue_type_script_lang-342e535e.js";import{_ as ca}from"./BalCircle-324fa9cd.js";import{_ as ra}from"./ConfirmationIndicator.vue_vue_type_script_setup_true_lang-35a245bf.js";import{D as U,n as O}from"./usePoolHelpers-eb955974.js";import{_ as ua,a as ma}from"./BalDataListRow.vue_vue_type_script_setup_true_lang-e378cd32.js";import{_ as da}from"./BalTooltip.vue_vue_type_style_index_0_lang-8bf6235c.js";import{d as q,b as _,c as g,l as i,j as n,A as W,v as u,q as h,z as a,r as A,u as P,C as Z,ap as pa,i as C,o as fa,T as ka}from"./runtime-core.esm-bundler-558f8953.js";import{u as _a,A as ga}from"./useTokenApprovalActions-42c413d9.js";import{a as ha}from"./useTransactions-114fc9d7.js";import{u as Q}from"./pool-staking.provider-e441fa29.js";import{o as H,Z as J,at as va}from"./connector-16147cef.js";const wa={class:"lowercase"},Aa={class:"capitalize"},Sa={class:"capitalize"},ya=q({__name:"StakeSummary",props:{action:{},fiatValue:{},sharePercentage:{}},setup(e){const{fNum:m}=j();return(t,d)=>{const c=da,l=ua,r=ma;return _(),g(r,{title:t.$t("summary")},{default:i(()=>[n(l,null,{label:i(()=>[W(u(t.$t("totalValueTo"))+" Â  ",1),h("span",wa,u(t.action==="stake"?t.$t("stake"):t.$t("unstake"))+": ",1)]),value:i(()=>[h("span",Aa,u(a(m)(t.fiatValue,a(V).fiat)),1),n(c,{text:t.action==="stake"?t.$t("staking.stakeValueTooltip"):t.$t("staking.unstakeValueTooltip"),width:"40",textAlign:"center",class:"ml-2"},null,8,["text"])]),_:1}),n(l,{label:t.$t("staking.newTotalShare")},{value:i(()=>[h("span",Sa,u(a(m)(t.sharePercentage,a(V).percent)),1),n(c,{text:t.$t("staking.totalShareTooltip"),width:"40",textAlign:"center",class:"ml-2"},null,8,["text"])]),_:1},8,["label"])]),_:1},8,["title"])}}});function $a(e,m){const t=A(!1),d=A(!1),c=A(),l=A([]),{balanceFor:r,refetchBalances:p}=K(),{fNum:S}=j(),{t:o}=aa(),{addTransaction:L}=ha(),{getTokenApprovalActions:N}=_a(),{isLoading:z,stake:F,unstake:R,stakedShares:$,refetchAllPoolStakingData:s,preferentialGaugeAddress:v}=Q(),f=e.action==="stake"?r(H(e.pool.address)):$.value,b={label:o("stake"),loadingLabel:o("staking.staking"),confirmingLabel:o("confirming"),action:()=>E(F,"stake"),stepTooltip:o("staking.stakeTooltip")},k={label:o("unstake"),loadingLabel:o("staking.unstaking"),confirmingLabel:o("confirming"),action:()=>E(R,"unstake"),stepTooltip:e.action==="restake"?o("staking.restakeTooltip"):o("staking.unstakeTooltip")},D=P(()=>e.action==="stake"&&(f==="0"||f==="")),M=A(J(J($.value).plus(r(H(e.pool.address)))).div(e.pool.totalShares).toString()),T=P(()=>[{address:e.pool.address,amount:f}]),y=P(()=>t.value||z.value);async function E(w,G){try{const B=await w();return L({id:B.hash,type:"tx",action:G,summary:o(`transactionSummary.${G}`,{pool:e.pool.symbol,amount:S(U(e.pool,f),V.fiat)}),details:{total:S(U(e.pool,f),V.fiat),pool:e.pool}}),B}catch(B){throw new Error(`Failed create ${G} transaction`,{cause:B})}}async function I(){const w=await va(async()=>{if(v.value)return await N({amountsToApprove:T.value,spender:v.value,actionType:ga.Staking})},t);w&&l.value.unshift(...w)}async function X(w){d.value=!0,c.value=w,await Promise.all([p(),s()]),m("success")}function Y(){d.value=!1,c.value=void 0,m("close")}return Z(()=>e.action,()=>{e.action==="stake"&&(l.value=[b]),e.action==="unstake"&&(l.value=[k]),e.action==="restake"&&(l.value=[k,b])},{immediate:!0}),Z(v,async()=>{e.action!=="unstake"&&await I()}),pa(async()=>{e.action!=="unstake"&&await I()}),{isActionConfirmed:d,confirmationReceipt:c,isLoading:y,currentShares:f,stakeActions:l,totalUserPoolSharePct:M,handleSuccess:X,handleClose:Y,isStakeAndZero:D}}const ba={class:"py-2 px-4 rounded-lg border dark:border-gray-700 divide-y dark:divide-gray-700"},Ta={class:"text-secondary"},Ba=q({__name:"StakePreview",props:{pool:{},action:{}},emits:["close","success"],setup(e,{emit:m}){const t=e,{getToken:d}=K(),{fNum:c}=j(),{isMismatchedNetwork:l}=ea(),{isActionConfirmed:r,confirmationReceipt:p,isLoading:S,currentShares:o,stakeActions:L,totalUserPoolSharePct:N,handleSuccess:z,handleClose:F,isStakeAndZero:R}=$a(t,m),$=P(()=>O(t.pool).length*32/1.5);return(s,v)=>{const f=ta,b=ca,k=la,D=ia,M=na,T=oa;return _(),g(k,{vertical:""},{default:i(()=>[n(k,{horizontal:"",spacing:"sm",align:"center"},{default:i(()=>[a(r)?(_(),g(b,{key:0,size:"8",color:"green",class:"text-white"},{default:i(()=>[n(f,{name:"check"})]),_:1})):C("",!0),h("h4",null,u(s.$t(`${s.action}`))+" "+u(s.$t("lpTokens")),1)]),_:1}),h("div",ba,[n(k,{horizontal:"",justify:"between",align:"center"},{default:i(()=>[n(k,{vertical:"",spacing:"none"},{default:i(()=>{var y;return[h("h5",null,u(a(c)(a(o)))+" "+u(s.$t("lpTokens")),1),h("span",Ta,u((y=a(d)(s.pool.address))==null?void 0:y.symbol),1)]}),_:1}),n(D,{addresses:a(O)(s.pool),width:a($),size:32},null,8,["addresses","width"])]),_:1})]),n(ya,{action:s.action,fiatValue:a(U)(s.pool,a(o)),sharePercentage:a(N)},null,8,["action","fiatValue","sharePercentage"]),a(r)?C("",!0):(_(),g(M,{key:0,actions:a(L),primaryActionType:s.action,isLoading:a(S),disabled:a(R)||a(l),onSuccess:a(z)},null,8,["actions","primaryActionType","isLoading","disabled","onSuccess"])),a(r)&&a(p)?(_(),g(k,{key:1,vertical:""},{default:i(()=>[n(ra,{txReceipt:a(p)},null,8,["txReceipt"]),n(sa,{isVisible:a(r)},{default:i(()=>[s.action==="stake"?(_(),g(T,{key:0,color:"gradient",block:"",class:"mb-2",onClick:v[0]||(v[0]=y=>s.$router.push({name:"claim"}))},{default:i(()=>[W(u(s.$t("viewClaims")),1)]),_:1})):C("",!0),n(T,{color:"gray",outline:"",block:"",onClick:a(F)},{default:i(()=>[W(u(s.$t("close")),1)]),_:1},8,["onClick"])]),_:1},8,["isVisible"])]),_:1})):C("",!0)]),_:1})}}}),qa=q({__name:"StakePreviewModal",props:{isVisible:{type:Boolean},pool:{},action:{}},emits:["close","success"],setup(e,{emit:m}){const t=e,d=A(!1),{setCurrentPool:c}=Q();function l(){d.value=!1,m("close")}function r(){d.value=!0,m("success")}return fa(()=>{c(t.pool.id)}),Z(()=>t.pool,p=>{c(p.id)}),(p,S)=>{const o=x;return _(),g(ka,{to:"#modal"},[n(o,{show:p.isVisible,fireworks:a(d),onClose:l},{default:i(()=>[n(Ba,{pool:p.pool,action:p.action,onClose:l,onSuccess:r},null,8,["pool","action"])]),_:1},8,["show","fireworks"])])}}});export{qa as _};
//# sourceMappingURL=StakePreviewModal.vue_vue_type_script_setup_true_lang-33f4be12.js.map
