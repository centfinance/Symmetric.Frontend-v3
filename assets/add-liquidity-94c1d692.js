var Pt=Object.defineProperty;var It=(i,e,t)=>e in i?Pt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var pe=(i,e,t)=>(It(i,typeof e!="symbol"?e+"":e,t),t);import{_ as we}from"./BalAsset-fcab7531.js";import{a1 as Ie,n as Bt,f as xt,a2 as $t,D as Mt,c as Et,q as oe,a3 as Ne,a4 as Lt}from"./usePoolHelpers-eb955974.js";import{u as ze}from"./useBreakpoints-ee2a85bc.js";import{_ as Ct,u as Jt}from"./MyWallet.vue_vue_type_script_setup_true_lang-df5bc616.js";import{ae as Z,Z as q,c as qt,U as R,ao as jt,aa as Wt,Q as ve,aw as Ot,ax as Rt,i as ke,a4 as Ft,u as xe,o as Nt,av as Ht,T as Vt}from"./connector-16147cef.js";import{b5 as $e,b8 as Me,bb as fe,cD as Dt,aJ as zt,a_ as Ut,aZ as Gt,av as K,aS as he,cE as Ue,aq as Te,aQ as Qt,aX as Zt,aW as Kt,au as Ae,ax as Yt,ao as Ee,aU as ue,aA as Xt,aw as Ge,bl as Qe,b6 as de,aT as eo,bn as to}from"./BalBtn-cca6788c.js";import{i as He,a as oo}from"./useTransactions-114fc9d7.js";import{r as N,ak as so,u as r,aj as no,C as ye,ap as Ze,o as Ke,an as me,n as ao,d as V,z as s,b as m,c as b,l as M,j as I,ao as ge,e as io,p as W,A as te,v as J,q as j,i as O,F as Ye,x as ee,s as ro,k as lo,ah as Xe,T as co,h as Be,ar as et}from"./runtime-core.esm-bundler-558f8953.js";import{u as uo,R as Ve,a as po}from"./useRelayerApproval-b64164b6.js";import{u as mo}from"./useTxState-3f0a759d.js";import{H as vo,R as fo,d as ho,T as De,L as go}from"./TokenAmounts-579fbde0.js";import{h as Le,f as ko,g as _o,_ as yo}from"./balancer-sdk-d0995fe4.js";import{o as wo}from"./helpers-7076a817.js";import{u as To,A as Ao}from"./useTokenApprovalActions-42c413d9.js";import{b as bo}from"./useGnosisSafeApp-bf4524fc.js";import{u as tt}from"./pool.provider-20e73aa3.js";import{_ as So}from"./BalAccordion.vue_vue_type_script_setup_true_lang-a2418c88.js";import{_ as Po}from"./BalTabs.vue_vue_type_style_index_0_lang-73eb95bf.js";import{S as Io,_ as Bo}from"./SwapSettingsPopover.vue_vue_type_style_index_0_lang-f08855d4.js";import{_ as xo}from"./BalCheckbox-910bedd8.js";import{_ as Ce}from"./BalAlert-fdfde589.js";import{_ as Je}from"./BalTooltip.vue_vue_type_style_index_0_lang-8bf6235c.js";import{_ as $o}from"./StakePreviewModal.vue_vue_type_script_setup_true_lang-33f4be12.js";import{_ as Mo}from"./TokenInput.vue_vue_type_script_setup_true_lang-16ac0e09.js";import{c as Eo}from"./validations-969b3a37.js";import{u as ot}from"./useVeBAL-5fa15e49.js";import{_ as Lo}from"./BalCircle-324fa9cd.js";import{_ as Co,a as Jo}from"./BalDataListRow.vue_vue_type_script_setup_true_lang-e378cd32.js";import{_ as qo,u as jo}from"./useDisabledJoinPool-118f9751.js";import{_ as Wo}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-f37eca6e.js";import{_ as Oo}from"./ConfirmationIndicator.vue_vue_type_script_setup_true_lang-35a245bf.js";import{u as Ro,p as Fo}from"./pool-staking.provider-e441fa29.js";import{c as st}from"./index.esm-d99d5267.js";import{u as nt}from"./user-tokens.provider-ef101cbb.js";import{_ as qe}from"./_plugin-vue_export-helper-c27b6911.js";import{u as No,a as Ho}from"./vue-router-461057a5.js";import"./useDarkMode-6a81be08.js";import"./browser-6c45db04.js";import"./_commonjsHelpers-87174ba5.js";import"./Avatar.vue_vue_type_script_setup_true_lang-5ab9890e.js";import"./pools-18fd7fb0.js";import"./BalLink-65772d8f.js";import"./BalAssetSet-0f096fdb.js";import"./metamask.connector-0225016b.js";import"./index-fe1d1633.js";import"./events-5f626723.js";import"./readable-browser-a0df197a.js";import"./immutable-2b056f5a.js";import"./index-1de0572e.js";import"./index-18b6daea.js";import"./wallet-names-136aa5a2.js";import"./meta.service-1c1722a9.js";import"./voting.provider-3f46e556.js";import"./index-155f0d25.js";import"./liquidity-gauge-c56bdf84.js";import"./useVotingPools-44058ee3.js";import"./useQueryHelpers-8fe10019.js";import"./api-e32fdf3d.js";import"./subgraph-fallback.service-7e7c32be.js";import"./StablePhantomPool-f25cd4a4.js";import"./usePoolQuery-7e1952e9.js";import"./balancer-api.service-037872f8.js";import"./useAlerts-0e7ff1f0.js";import"./BalPopover-a283b4e9.js";import"./BalBtnGroup-92655bd2.js";import"./options-322e8a89.js";import"./BalStack.vue_vue_type_script_lang-342e535e.js";import"./BalTextInput-57c2e4cc.js";import"./tailwind.config-235e68cf.js";import"./SelectTokenModal-1ed87681.js";import"./anime.es-de4e5aa0.js";import"./numeral-77821a11.js";import"./useTailwind-38f80624.js";import"./token-lists.provider-00d13873.js";import"./wallet-logos-346092ca.js";import"./user-data.provider-8fbcf693.js";import"./useVeBalLockInfoQuery-e92ea085.js";var je=(i=>(i[i.PoolTokens=0]="PoolTokens",i[i.SingleToken=1]="SingleToken",i))(je||{});const be=[{value:0,label:He.global.t("investment.tabs.poolTokens")},{value:1,label:He.global.t("investment.tabs.singleToken")}],at=N(be[0].value);function Vo(){at.value=be[0].value}function it(){return{activeTab:at,resetTabs:Vo}}class Do{constructor(e,t){pe(this,"lastSwapRoute");this.pool=e,this.sdk=t}async join(e){const{signer:t,slippageBsp:o}=e,n=await t.getAddress();if(await this.queryJoin(e),!this.lastSwapRoute)throw new Error("Could not fetch swap route for join.");const{to:a,data:v,value:d}=this.getSwapAttributes(this.lastSwapRoute,o,n);return new $e(t).raw.sendTransaction({to:a,data:v,value:d})}async queryJoin({amountsIn:e,tokensIn:t,signer:o}){var p;if(e.length===0)throw new Error("Missing amounts to join with.");const n=e[0],a=Z(t,n.address);if(!a)throw new Error("Missing critical token metadata.");if(!n.value||q(n.value).eq(0))return{bptOut:"0",priceImpact:0};Le.value||await ko();const v=wo(n.value,a.decimals),d=Me(v,a.decimals),f=await this.getGasPrice(o);this.lastSwapRoute=await this.sdk.swaps.findRouteGivenIn({tokenIn:this.formatAddressForSor(n.address),tokenOut:this.pool.value.address,amount:d,gasPrice:f,maxPools:4});const g=fe(this.lastSwapRoute.returnAmount,((p=this.pool.value.onchain)==null?void 0:p.decimals)||18);if(q(g).eq(0))throw new Error("Not enough liquidity.");const T=this.calcPriceImpact(n.value,g,this.lastSwapRoute.marketSp);return{bptOut:g,priceImpact:T}}calcPriceImpact(e,t,o){const a=q(e).div(t).div(o).minus(1)||1;return Math.max(0,a.toNumber())}async getGasPrice(e){const t=(await e.getGasPrice()).toNumber();if(!t)throw new Error("Failed to fetch gas price.");return qt.from(t)}getSwapAttributes(e,t,o){const n=Dt(60).toString();return this.sdk.swaps.buildSwap({userAddress:o,swapInfo:e,kind:0,deadline:n,maxSlippage:t})}formatAddressForSor(e){return R(e,jt)?Wt.ZeroAddress:e}}class zo{constructor(e,t){pe(this,"lastJoinRes");this.pool=e,this.sdk=t}async join(e){if(await this.queryJoin(e),!this.lastJoinRes)throw new Error("Could not query generalised join");const t=new $e(e.signer),{to:o,encodedCall:n,value:a}=this.lastJoinRes;return t.raw.sendTransaction({to:o,data:n,value:a})}async queryJoin({amountsIn:e,tokensIn:t,signer:o,slippageBsp:n,relayerSignature:a,approvalActions:v}){var _;const d=e.map(({address:k,value:L})=>{const x=Z(t,k);if(!x||!x.decimals)throw new Error(`Token metadata missing for: ${k}`);return Me(L||"0",x.decimals).toString()}),f=e.map(({address:k})=>this.formatTokenAddress(k)),g=await o.getAddress(),T=n.toString(),p=this.pool.value.id,l=e.some(k=>!k.valid),c=e.some(k=>R(k.address,ve.network.nativeAsset.address)),S=this.getSimulationType({isNativeAssetJoin:c,hasInvalidAmounts:l,approvalActionsLength:v.length});if(console.log({simulationType:S}),this.lastJoinRes=await this.sdk.pools.generalisedJoin(p,f,d,g,T,o,S,a),!this.lastJoinRes)throw new Error("Failed to fetch expected output.");const w=fe(this.lastJoinRes.expectedOut,((_=this.pool.value.onchain)==null?void 0:_.decimals)||18),A=q(fe(this.lastJoinRes.priceImpact,18)).toNumber();if(q(w).eq(0))throw new Error("Not enough liquidity.");return{bptOut:w,priceImpact:A}}getSimulationType({isNativeAssetJoin:e,hasInvalidAmounts:t,approvalActionsLength:o}){return e?Ie.VaultModel:!t&&!o?Ie.Static:Ie.VaultModel}formatTokenAddress(e){const{nativeAsset:t}=ve.network.tokens.Addresses;return R(e,t)?zt:e}}class Uo{constructor(e,t){pe(this,"joinRes");this.pool=e,this.sdk=t}async join(e){if(await this.queryJoin(e),!this.joinRes)throw new Error("Could not query generalised join");const t=new $e(e.signer),{to:o,data:n,value:a}=this.joinRes;return t.raw.sendTransaction({to:o,data:n,value:a})}async queryJoin({amountsIn:e,tokensIn:t,signer:o,slippageBsp:n}){var A;const a=e.map(({address:_})=>_),v=this.formatPoolTokensList(a),d=v.map(_=>{var x;const k=Z(t,_);if(!k)return"0";const L=(x=Ot(e,_))==null?void 0:x.value;return Me(L||"0",k.decimals).toString()}),f=await o.getAddress(),g=n.toString(),T=await this.sdk.pools.find(this.pool.value.id);if(!T)throw new Error("Failed to find pool: "+this.pool.value.id);const p=v.map(_=>Rt(_));if(this.joinRes=await T.buildJoin(f,p,d,g),console.log(this.joinRes),!this.joinRes)throw new Error("Failed to fetch expected output.");const{expectedBPTOut:l}=this.joinRes;if(q(l).eq(0))throw new Error("Failed to fetch expected output.");const c=fe(l,((A=this.pool.value.onchain)==null?void 0:A.decimals)||18),S=await T.calcPriceImpact(d,l,!0),w=Number(fe(S,18));return{bptOut:c,priceImpact:w}}formatPoolTokensList(e){const{nativeAsset:t,wNativeAsset:o}=ve.network.tokens.Addresses,n=ke(e,t),a=Bt(this.pool.value);return n?a.map(v=>R(v,o)?t:v):a}}var _e=(i=>(i.Swap="Swap",i.Generalised="Generalised",i.ExactIn="ExactIn",i))(_e||{});class Go{constructor(e,t=_o()){pe(this,"joinHandler");this.pool=e,this.sdk=t,this.joinHandler=this.setJoinHandler("Generalised")}setJoinHandler(e){const{pool:t,sdk:o}=this,n=[t,o];switch(e){case"Swap":return this.joinHandler=new Do(...n);case"Generalised":return this.joinHandler=new zo(...n);case"ExactIn":return this.joinHandler=new Uo(...n);default:throw new Error(`Pool type not handled: ${t.value.poolType}`)}}async join(e){return this.joinHandler.join(e)}async queryJoin(e){return this.joinHandler.queryJoin(e)}}function Qo(i,e){throw Error(i,{cause:e})}const Zo=(i,e=1e3)=>{const t=N(!1),o=N([]),n=N("0"),a=N(0),v=N(!1),d=N(""),f=N([]),g=N(!1),T=ho(wt,e),p=r(()=>t.value&&!D.value),l=Ut(Gt.Pools.Joins.QueryJoin(o,Le,g),T,no({enabled:p,refetchOnWindowFocus:!1})),c=new Go(i),{getTokens:S,injectTokens:w,priceFor:A,nativeAsset:_,wrappedNativeAsset:k}=K(),{toFiat:L}=he(),{slippageBsp:x}=Ue(),{getSigner:H,appNetworkConfig:u}=Te(),{transactionDeadline:P}=bo(),{txState:F,txInProgress:D,resetTxState:ne}=mo(),ae=uo(Ve.BATCH),{getTokenApprovalActions:Y,updateAllowancesFor:ie}=To(),{relayerSignature:G,relayerApprovalAction:B}=po(Ve.BATCH),C=r(()=>xt(i.value)),re=r(()=>$t(i.value)),y=r(()=>S(o.value.map(h=>h.address))),$=r(()=>q(a.value).isGreaterThanOrEqualTo(vo)),Q=r(()=>q(a.value).isGreaterThanOrEqualTo(fo)),X=r(()=>$.value?v.value:!0),le=r(()=>o.value.every(h=>h.valid===!0)&&X.value),E=r(()=>o.value.some(h=>q(h.value).gt(0))),z=r(()=>o.value.filter(h=>q(h.value).gt(0))),ut=r(()=>!z.value.every(h=>q(A(h.address)).gt(0))),pt=r(()=>{const h=o.value.map(U=>L(U.value||0,U.address));return Ft(h).toString()}),dt=r(()=>Mt(i.value,n.value)),mt=r(()=>C.value&&!g.value&&!(ae.isUnlocked.value||G.value)),vt=r(()=>o.value.map(h=>({address:h.address,amount:h.value,spender:u.addresses.vault}))),ft=r(()=>l.isFetching.value),ht=r(()=>{var h;return(h=l.error.value)==null?void 0:h.message}),ce=r(()=>C.value?g.value?_e.Swap:_e.Generalised:_e.ExactIn),gt=r(()=>!Et(i.value.poolType));function We(h){o.value=h}function kt(h){We(h.map(U=>({address:U,value:"",valid:!0})))}function _t(){o.value.forEach((h,U)=>{o.value[U].value=""})}function yt(){n.value="0",a.value=0,l.remove()}async function Se(){const h=await Y({amountsToApprove:vt.value,spender:u.addresses.vault,actionType:Ao.AddLiquidity,skipAllowanceCheck:!0});f.value=mt.value?[B.value,...h]:h}function Oe(){return E.value?!0:(a.value=0,!1)}async function wt(){if(!Oe())return null;try{if(c.setJoinHandler(ce.value),await Se(),console.log("joinHandler:",ce.value),!Oe())return null;const h=await c.queryJoin({amountsIn:z.value,tokensIn:y.value,signer:H(),slippageBsp:x.value,relayerSignature:G.value,approvalActions:f.value,transactionDeadline:P.value});return console.log("to: ",h),n.value=h.bptOut,a.value=h.priceImpact,h}catch(h){Re(h,l),Qo("Failed to construct join.",h)}}async function Tt(){try{return d.value="",c.setJoinHandler(ce.value),await Se(),console.log("joinHandler:",ce.value),await c.join({amountsIn:z.value,tokensIn:y.value,signer:H(),slippageBsp:x.value,relayerSignature:G.value,approvalActions:f.value,transactionDeadline:P.value})}catch(h){throw Re(h),d.value=h.message,h}}function At(h){g.value=h}function bt(h){const U=h?_.address:k.value.address,Pe=h?k.value.address:_.address,Fe=o.value.find(St=>R(Pe,St.address));Fe&&(Fe.address=U)}async function Re(h,U){const Pe=await H().getAddress();Qt({error:h,action:"invest",query:U,context:{level:"fatal",extra:{joinHandler:ce.value,params:JSON.stringify({amountsIn:z.value,tokensIn:y.value,signer:Pe,slippageBsp:x.value,relayerSignature:G.value,approvalActions:f.value,transactionDeadline:P.value},null,2)}}})}return ye(g,()=>{yt(),c.setJoinHandler(ce.value)}),ye(B,async()=>await Se()),Ze(()=>{w(re.value),ie(u.addresses.vault)}),Ke(()=>t.value=!0),{amountsIn:o,highPriceImpactAccepted:v,txState:F,pool:me(i),isSingleAssetJoin:me(g),bptOut:me(n),priceImpact:me(a),txError:me(d),poolJoinTokens:re,isLoadingQuery:ft,queryError:ht,highPriceImpact:$,rektPriceImpact:Q,hasAcceptedHighPriceImpact:X,hasValidInputs:le,hasAmountsIn:E,fiatValueIn:pt,fiatValueOut:dt,txInProgress:D,approvalActions:f,missingPricesIn:ut,tokensIn:y,supportsProportionalOptimization:gt,setAmountsIn:We,setTokensIn:kt,resetAmounts:_t,join:Tt,resetTxState:ne,setIsSingleAssetJoin:At,setJoinWithNativeAsset:bt,queryJoinQuery:l}},rt=Symbol(Zt.Providers.JoinPool);function Ko(i){const e=Zo(i);return so(rt,e),e}const se=()=>Kt(rt);function Yo(){const{pool:i,isLoadingPool:e}=tt(),{setAmountsIn:t,setJoinWithNativeAsset:o,isSingleAssetJoin:n,amountsIn:a}=se(),{nativeAsset:v,wrappedNativeAsset:d,getMaxBalanceFor:f}=K(),{activeTab:g}=it(),T=r(()=>{var c;return(c=i.value)!=null&&c.address?[i.value.address]:[]});function p(c,S){if(n.value)t([{address:c,value:S,valid:!0}]);else{const w=R(c,v.address),A=R(c,d.value.address);(w||A)&&o(w);const _=a.value.find(k=>R(c,k.address));_&&(_.valid=!0,_.value=S)}}function l(c,S){const w=f(c);S?p(c,w):(g.value=be[je.SingleToken].value,ao(()=>{p(c,w)}))}return{handleMyWalletTokenClick:l,isLoadingPool:e,pool:i,excludedTokens:T,amountsIn:a,setAmountsIn:t,activeTab:g}}const lt=V({__name:"MyWallet",setup(i){const{handleMyWalletTokenClick:e,isLoadingPool:t,pool:o,excludedTokens:n}=Yo();return(a,v)=>{const d=we;return s(t)||!s(o)?(m(),b(d,{key:0,class:"h-64"})):(m(),b(Ct,{key:1,excludedTokens:s(n),pool:s(o),"onClick:asset":s(e)},null,8,["excludedTokens","pool","onClick:asset"]))}}}),Xo=V({__name:"Accordion",props:{pool:{}},setup(i){const e=i,t=r(()=>e.pool),{hasNativeBalance:o,nativeBalance:n,nativeCurrency:a}=Jt(),{t:v}=Ae(),{isDeepPool:d}=oe(t),f=r(()=>o?`${n.value} ${a}`:""),g=r(()=>d.value?`${v("myWallet2")} ${f.value}`:v("poolTransfer.myWalletTokensCard.title"));return(T,p)=>(m(),b(So,{sections:[{title:g.value,id:"myWalletTokens"}]},{myWalletTokens:M(()=>[I(lt,{pool:t.value},null,8,["pool"])]),_:1},8,["sections"]))}}),es={key:0,class:"flex items-center mb-4"},ts=["innerHTML"],os=V({__name:"WrapStEthLink",props:{pool:{}},setup(i){const e=i,{isMainnetWstETHPool:t}=oe(ge(e,"pool")),{networkConfig:o}=Yt(),{getToken:n}=K(),{networkSlug:a}=xe(),v=r(()=>n(o.tokens.Addresses.stETH||"")),d=r(()=>n(o.tokens.Addresses.wstETH||""));return(f,g)=>{const T=io("router-link"),p=Ee,l=Je;return s(t)?(m(),W("div",es,[I(T,{to:{name:"swap",params:{networkSlug:s(a),assetIn:v.value.address,assetOut:d.value.address}},class:"text-xs underline text-secondary"},{default:M(()=>[te(J(f.$t("wrapInstruction",[v.value.symbol,d.value.symbol])),1)]),_:1},8,["to"]),I(l,null,{activator:M(()=>[I(p,{name:"info",size:"xs",class:"ml-2 text-gray-400 dark:text-gray-500"})]),default:M(()=>[j("div",{innerHTML:f.$t("wrapStEthTooltip")},null,8,ts)]),_:1})])):O("",!0)}}}),ss=V({__name:"Summary",props:{pool:{},fiatTotal:{},priceImpact:{},isLoadingPriceImpact:{type:Boolean,default:!1},highPriceImpact:{type:Boolean,default:!1},summaryTitle:{default:void 0}},setup(i){const{fNum:e}=he(),{currency:t}=Ue();return(o,n)=>{const a=Je,v=Co,d=we,f=Jo;return m(),b(f,{title:o.$t("summary")},{default:M(()=>[I(v,{label:o.$t("investment.preview.summary.total")},{value:M(()=>[te(J(s(e)(o.fiatTotal,s(ue).fiat))+" ",1),I(a,{text:o.$t("tooltips.addLiquidity.total",[s(t).toUpperCase()]),iconSize:"sm",class:"ml-2"},null,8,["text"])]),_:1},8,["label"]),I(v,{label:o.$t("priceImpact"),class:ee({"bg-red-50 dark:bg-red-500 text-red-500 dark:text-white":o.highPriceImpact})},{value:M(()=>[o.isLoadingPriceImpact?(m(),b(d,{key:0,class:"w-10 h-6"})):(m(),W(Ye,{key:1},[te(J(s(e)(o.priceImpact,s(ue).percent))+" ",1),I(a,{text:o.$t("tooltips.addLiquidity.priceImpact"),iconSize:"sm",iconName:o.highPriceImpact?"alert-triangle":"info",iconClass:o.highPriceImpact?"text-red-500 dark:text-white":"text-gray-300",width:"72",class:"ml-2"},null,8,["text","iconName","iconClass"])],64))]),_:1},8,["label","class"])]),_:1},8,["title"])}}}),ns={key:1},as=V({__name:"Actions",props:{pool:{}},emits:["success","showStakeModal"],setup(i,{emit:e}){const t=i,{t:o}=Ae(),{fNum:n}=he(),{addTransaction:a}=oo(),{lockablePoolId:v}=ot(),{isStakablePool:d}=Ro(),{isMismatchedNetwork:f}=Te(),{poolWeightsLabel:g}=oe(ge(t,"pool")),{rektPriceImpact:T,fiatValueOut:p,join:l,txState:c,resetTxState:S,approvalActions:w}=se(),{networkSlug:A}=xe(),_=N(w.value),k=r(()=>[..._.value,{label:o("addLiquidity"),loadingLabel:o("investment.preview.loadingLabel.investment"),confirmingLabel:o("confirming"),action:H,stepTooltip:o("investmentTooltip")}]);async function L(u,P){c.receipt=u,c.confirmedAt=P,c.confirmed=!0,c.confirming=!1,e("success",u)}function x(){c.confirming=!1}async function H(){c.init=!0;try{const u=await l();return c.confirming=!0,a({id:u.hash,type:"tx",action:"invest",summary:o("transactionSummary.investInPool",[n(p.value,ue.fiat),g(t.pool)]),details:{total:n(p.value,ue.fiat),pool:t.pool}}),u}catch(u){throw c.confirming=!1,new Error("Failed to submit transaction.",{cause:u})}finally{c.init=!1}}return ro(()=>{S()}),(u,P)=>{const F=qo,D=Ge;return m(),b(Xt,null,{default:M(()=>[!s(c).confirmed||!s(c).receipt?(m(),b(Wo,{key:0,actions:k.value,primaryActionType:"invest",disabled:s(T)||s(f),onSuccess:L,onFailed:x},null,8,["actions","disabled"])):(m(),W("div",ns,[I(Oo,{txReceipt:s(c).receipt},null,8,["txReceipt"]),s(v)===u.pool.id?(m(),b(D,{key:0,tag:"router-link",to:{name:"get-vebal",query:{returnRoute:u.$route.name,returnParams:JSON.stringify({id:u.pool.id,networkSlug:s(A)})}},color:"gradient",block:"",class:"flex mt-2"},{default:M(()=>[I(F,{class:"mr-2 h-5 text-orange-300"}),te(J(u.$t("lockToGetVeBAL")),1)]),_:1},8,["to"])):s(d)?(m(),b(D,{key:1,color:"gradient",block:"",class:"flex mt-2",onClick:P[0]||(P[0]=ne=>e("showStakeModal"))},{default:M(()=>[I(F,{class:"mr-2 h-5 text-orange-300"}),te(J(u.$t("stakeToGetExtra")),1)]),_:1})):O("",!0),I(D,{tag:"router-link",to:{name:"pool",params:{id:u.pool.id}},color:"gray",outline:"",block:"",class:"mt-2"},{default:M(()=>[te(J(u.$t("returnToPool")),1)]),_:1},8,["to"])]))]),_:1})}}}),is={class:"flex items-center"},rs=V({__name:"AddLiquidityPreview",props:{pool:{}},emits:["close","showStakeModal"],setup(i,{emit:e}){const t=i,o=N(!1),{t:n}=Ae(),{getToken:a}=K(),{toFiat:v}=he(),{isSingleAssetJoin:d,amountsIn:f,bptOut:g,fiatValueIn:T,fiatValueOut:p,priceImpact:l,highPriceImpact:c,rektPriceImpact:S,isLoadingQuery:w,txInProgress:A,queryJoinQuery:_,missingPricesIn:k,resetAmounts:L}=se(),x=r(()=>o.value?n("investment.preview.titles.confirmed"):n("investment.preview.titles.default")),H=r(()=>!!Object.keys(D.value).length),u=r(()=>{const B={};return f.value.forEach(C=>{B[C.address]=C.value}),B}),P=r(()=>({[t.pool.address]:g.value})),F=r(()=>{const B={};return Object.keys(u.value).forEach(C=>{B[C]=a(C)}),B}),D=r(()=>({[t.pool.address]:a(t.pool.address)})),ne=r(()=>{const B={};return Object.keys(u.value).forEach(C=>{B[C]=v(u.value[C],C)}),B}),ae=r(()=>p.value?{[t.pool.address]:p.value}:{}),Y=r(()=>Object.values(ae.value).reduce((B,C)=>q(B).plus(C).toString(),"0"));function ie(){o.value&&(L(),o.value=!1),e("close")}function G(){ie(),e("showStakeModal")}return st(()=>{!w.value&&!A.value&&_.refetch()},Qe*10),(B,C)=>{const re=Ee,y=Lo,$=Ce,Q=yo;return m(),b(Q,{show:"",fireworks:o.value,onClose:ie},{header:M(()=>[j("div",is,[o.value?(m(),b(y,{key:0,size:"8",color:"green",class:"mr-2 text-white"},{default:M(()=>[I(re,{name:"check"})]),_:1})):O("",!0),j("h4",null,J(x.value),1)])]),default:M(()=>[I(De,{title:B.$t("investment.preview.titles.tokenIn"),amountMap:u.value,tokenMap:F.value,fiatAmountMap:ne.value,fiatTotal:s(T),hideAmountShare:s(d)},null,8,["title","amountMap","tokenMap","fiatAmountMap","fiatTotal","hideAmountShare"]),H.value?(m(),b(De,{key:0,showZeroAmounts:"",title:B.$t("investment.preview.titles.tokenOut"),class:"mt-4",amountMap:P.value,tokenMap:D.value,fiatAmountMap:ae.value,fiatTotal:Y.value,hideAmountShare:""},null,8,["title","amountMap","tokenMap","fiatAmountMap","fiatTotal"])):O("",!0),s(k)?(m(),b($,{key:1,type:"warning",title:B.$t("noPriceInfo"),class:"mt-4",block:""},null,8,["title"])):O("",!0),I(ss,{pool:B.pool,fiatTotal:s(k)?"-":s(T),priceImpact:s(l),highPriceImpact:s(c)},null,8,["pool","fiatTotal","priceImpact","highPriceImpact"]),s(S)?(m(),b($,{key:2,type:"error",title:B.$t("investment.error.rektPriceImpact.title"),description:B.$t("investment.error.rektPriceImpact.description"),class:"mt-6 mb-2"},null,8,["title","description"])):O("",!0),I(as,{pool:B.pool,class:"mt-4",onSuccess:C[0]||(C[0]=X=>o.value=!0),onShowStakeModal:G},null,8,["pool"])]),_:1},8,["fireworks"])}}});function ls(i,e,t=N(!1)){const o=ve,{balanceFor:n}=K(),a=r(()=>{const p=Object.keys(e.value);return t.value?p.map(l=>R(l,o.network.tokens.Addresses.wNativeAsset)?o.network.nativeAsset.address:l):p}),v=r(()=>{var p;return(p=i.onchain)!=null&&p.tokens?i.onchain.tokens:{}}),d=r(()=>{var c;if(!((c=i.onchain)!=null&&c.tokens))return{};const p=Z(v.value,o.network.tokens.Addresses.wNativeAsset),l={[o.network.nativeAsset.address]:de((p==null?void 0:p.balance)||"0",(p==null?void 0:p.decimals)||18)};return Object.keys(v.value).forEach(S=>{const w=Nt(S),A=Z(v.value,w);A&&(l[w]=de(A.balance,A.decimals||18))}),l});function f(p,l){if(R(p,l.address))return l.value;const c=Z(e.value,p),S=Z(d.value,p)||de("0"),w=Z(e.value,l.address),A=de(l.value,w==null?void 0:w.decimals),_=Z(d.value,l.address)||de("0"),k=A.mul(S).div(_);return eo(k,c==null?void 0:c.decimals)}function g(p){return p.value.trim()===""?[]:a.value.map(l=>({address:l,valid:!0,value:f(l,p)}))}function T(){let p=a.value.map(l=>({address:l,valid:!0,value:"0"}));return a.value.forEach(l=>{var A,_;let c=!0,S;if(R(l,o.network.nativeAsset.address)){const k=n(l);S=k?q(k).minus(o.network.nativeAsset.minTransactionBuffer).toString():"0"}else S=n(l);const w=g({address:l,value:S,valid:!0});if(w.forEach(k=>{q(k.value).gt(n(k.address))&&(c=!1)}),c){const k=((A=p.find(x=>R(x.address,l)))==null?void 0:A.value)||"0",L=((_=w.find(x=>R(x.address,l)))==null?void 0:_.value)||"0";q(L).gt(k)&&(p=w)}}),p}return{getPropMax:T}}function cs(i){const{poolJoinTokens:e,highPriceImpact:t,supportsProportionalOptimization:o,amountsIn:n,tokensIn:a,setAmountsIn:v}=se(),{isWethOrEth:d,nativeAsset:f,balanceFor:g}=K(),{tokensWithBalanceFrom:T,tokensWithoutBalanceFrom:p}=nt(),l=r(()=>n.value.some(u=>R(u.address,f.address))),{getPropMax:c}=ls(i,a,l),S=r(()=>({"dark:bg-gray-800":!t.value,"bg-red-500 dark:bg-red-500 text-white divide-red-400":t.value})),w=r(()=>({"text-gradient":!t.value,"text-red-500 px-2 py-1 bg-white rounded-lg":t.value})),A=r(()=>{const u=p(e.value).filter(P=>!d(P)).length===0;if(Ne(i)){const P=T(e.value).some(F=>d(F));return u&&P}return u}),_=r(()=>{const u=T(e.value).filter(P=>!d(P)).length>0;if(Ne(i)){const P=T(e.value).some(F=>d(F));return u||P}return u}),k=r(()=>n.value.every(u=>{if(R(u.address,f.address)){const P=g(u.address);return u.value===q(P).minus(f.minTransactionBuffer).toString()}else return u.value===g(u.address)})),L=r(()=>{if(!o.value)return!1;const u=c();return n.value.every((P,F)=>Number(P.value)===Number(u[F].value))});function x(){n.value.forEach(u=>{if(R(u.address,f.address)){const P=g(u.address);u.value=q(P).gt(f.minTransactionBuffer)?q(P).minus(f.minTransactionBuffer).toString():"0"}else u.value=g(u.address)})}function H(){const u=c();v(u)}return{priceImpactClasses:S,optimizeBtnClasses:w,hasBalanceForAllTokens:A,hasBalanceForSomeTokens:_,optimized:L,maximized:k,maximizeAmounts:x,optimizeAmounts:H}}const us={class:"data-table"},ps={class:"data-table-row total-row"},ds={class:"p-2"},ms={class:"data-table-number-col"},vs={key:0,class:"text-sm"},fs={key:0,class:"text-gray-400 dark:text-gray-600"},hs={class:"p-2"},gs={class:"data-table-number-col"},ks={class:"flex"},_s={key:0},ys={key:0,class:"text-sm font-semibold"},ws={key:0,class:"text-gray-400 dark:text-gray-600"},Ts=V({__name:"AddLiquidityTotals",props:{pool:{}},setup(i){const e=i,{fNum:t}=he(),{isWalletReady:o}=Te(),{highPriceImpact:n,isLoadingQuery:a,priceImpact:v,supportsProportionalOptimization:d,fiatValueIn:f}=se(),{priceImpactClasses:g,optimizeBtnClasses:T,hasBalanceForAllTokens:p,hasBalanceForSomeTokens:l,optimized:c,maximized:S,maximizeAmounts:w,optimizeAmounts:A}=cs(e.pool);return(_,k)=>{const L=we,x=Ee,H=Je;return m(),W("div",us,[j("div",ps,[j("div",ds,J(_.$t("total")),1),j("div",ms,[te(J(s(t)(s(f),s(ue).fiat))+" ",1),s(o)&&s(l)?(m(),W("div",vs,[s(S)?(m(),W("span",fs,J(_.$t("maxed")),1)):(m(),W("span",{key:1,class:"text-blue-500 cursor-pointer",onClick:k[0]||(k[0]=(...u)=>s(w)&&s(w)(...u))},J(_.$t("max")),1))])):O("",!0)])]),j("div",{class:ee(["data-table-row price-impact-row",s(g)])},[j("div",hs,J(_.$t("priceImpact")),1),j("div",gs,[j("div",ks,[s(a)?(m(),b(L,{key:1,class:"w-10"})):(m(),W("span",_s,J(s(t)(s(v),s(ue).percent)),1)),I(H,{text:_.$t("customAmountsTip")},{activator:M(()=>[s(n)?(m(),b(x,{key:0,name:"alert-triangle",size:"xs",class:"-mb-px ml-1"})):(m(),b(x,{key:1,name:"info",size:"xs",class:"-mb-px ml-1 text-gray-400"}))]),_:1},8,["text"])]),s(o)&&s(p)&&s(d)?(m(),W("div",ys,[s(c)?(m(),W("span",ws,J(_.$t("optimized")),1)):(m(),W("span",{key:1,class:ee(["cursor-pointer",s(T)]),onClick:k[1]||(k[1]=(...u)=>s(A)&&s(A)(...u))},J(_.$t("optimize")),3))])):O("",!0)])],2)])}}});const As=qe(Ts,[["__scopeId","data-v-9c11aed7"]]),bs={key:1,class:"italic-warning"},Ss=V({__name:"MissingPoolTokensAlert",props:{poolTokensWithoutBalance:{},poolTokensWithBalance:{},showSingleTokenSuggestion:{type:Boolean}},setup(i){const e=i,{t}=Ae(),{getToken:o}=K(),n=r(()=>e.poolTokensWithoutBalance.map(d=>{var f;return(f=o(d))==null?void 0:f.symbol})),a=r(()=>Ht(n.value,t)),v=r(()=>{const d=e.showSingleTokenSuggestion?` 

${t("investment.warning.noPoolTokensToJoinWith.paragraph2")}`:"";return t("investment.warning.noPoolTokensToJoinWith.paragraph1")+d});return(d,f)=>{const g=Ce;return d.poolTokensWithBalance.length?n.value.length?(m(),W("div",bs,J(s(t)("investment.warning.noBalanceSomeTokens"))+": "+J(a.value),1)):O("",!0):(m(),b(g,{key:0,class:"mb-4",type:"warning",title:s(t)("investment.warning.noPoolTokensToJoinWith.title"),description:v.value},null,8,["title","description"]))}}});const Ps=qe(Ss,[["__scopeId","data-v-fb4c23f9"]]),Is={"data-testid":"add-liquidity-form"},Bs={key:3,class:"p-2 pb-2 mt-5 rounded-lg border dark:border-gray-700 high-price-impact"},xs={class:"mt-4"},$s=V({__name:"AddLiquidityForm",props:{pool:{}},setup(i){const e=i,t=N(!1),o=N(!1),{managedPoolWithSwappingHalted:n,isDeepPool:a,isPreMintedBptPool:v,poolJoinTokens:d}=oe(ge(e,"pool")),{veBalTokenInfo:f}=ot(),{isWalletReady:g,startConnectWithInjectedProvider:T,isMismatchedNetwork:p}=Te(),{wrappedNativeAsset:l,nativeAsset:c,getToken:S}=K(),{isLoadingQuery:w,isSingleAssetJoin:A,amountsIn:_,highPriceImpact:k,highPriceImpactAccepted:L,hasValidInputs:x,hasAmountsIn:H,queryError:u,setTokensIn:P}=se(),{tokensWithBalance:F}=nt(),D=r(()=>n.value),ne=r(()=>q(e.pool.totalLiquidity).lt(go)),ae=r(()=>{const y=[e.pool.address];return f.value&&y.unshift(f.value.address),y}),Y=r(()=>d.value.filter(y=>ke(F.value,y)||R(y,l.value.address))),ie=r(()=>d.value.filter(y=>!ke(F.value,y)));async function G(y){P(y?[l.value.address]:Y.value)}function B(y){const $=S(y);return $==null?void 0:$.symbol}function C(y){return A.value?[]:ke([l.value.address,c.address],y)?[l.value.address,c.address]:[]}function re(){A.value&&_.value.length>0&&(_.value[0].value="")}return Ze(()=>{G(A.value)}),ye([A,Y],([y,$],[Q,X])=>{if(!t.value){const le=Q!==y;(!Vt.isEqual(X,$)||le)&&G(y)}}),(y,$)=>{const Q=Ce,X=xo,le=Ge;return m(),W("div",Is,[D.value?(m(),b(Q,{key:0,type:"warning",title:y.$t("investment.warning.managedPoolSwappingHalted.title"),description:y.$t("investment.warning.managedPoolSwappingHalted.description"),class:"mb-5"},null,8,["title","description"])):O("",!0),ne.value?(m(),b(Q,{key:1,type:"warning",title:y.$t("investment.warning.lowLiquidity.title"),description:y.$t("investment.warning.lowLiquidity.description"),class:"mb-5"},null,8,["title","description"])):O("",!0),(m(!0),W(Ye,null,lo(s(_),E=>(m(),b(Mo,{key:E.address,isValid:E.valid,"onUpdate:isValid":z=>E.valid=z,address:E.address,"onUpdate:address":[z=>E.address=z,re],amount:E.value,"onUpdate:amount":z=>E.value=z,name:E.address,weight:s(Lt)(y.pool,E.address),options:C(E.address),"aria-label":"Amount of: "+B(E.address),class:"mb-4",fixedToken:!s(A),excludedTokens:ae.value},null,8,["isValid","onUpdate:isValid","address","onUpdate:address","amount","onUpdate:amount","name","weight","options","aria-label","fixedToken","excludedTokens"]))),128)),s(A)?O("",!0):(m(),b(Ps,{key:2,showSingleTokenSuggestion:s(a)&&s(v),poolTokensWithBalance:Y.value,poolTokensWithoutBalance:ie.value},null,8,["showSingleTokenSuggestion","poolTokensWithBalance","poolTokensWithoutBalance"])),I(As,{pool:y.pool},null,8,["pool"]),s(k)?(m(),W("div",Bs,[I(X,{modelValue:s(L),"onUpdate:modelValue":$[0]||($[0]=E=>Xe(L)?L.value=E:null),rules:[s(Eo)(y.$t("priceImpactCheckbox"))],name:"highPriceImpactAccepted",size:"sm",label:y.$t("priceImpactAccept",[y.$t("depositing")])},null,8,["modelValue","rules","label"])])):O("",!0),I(os,{pool:y.pool,class:"mt-5"},null,8,["pool"]),s(u)?(m(),b(Q,{key:4,type:"error",title:y.$t("thereWasAnError"),description:s(u),class:"mt-4",block:""},null,8,["title","description"])):O("",!0),j("div",xs,[s(g)?(m(),b(le,{key:1,label:y.$t("preview"),color:"gradient",disabled:!s(H)||!s(x)||s(p)||s(w)||!!s(u),block:"",onClick:$[1]||($[1]=E=>t.value=!0)},null,8,["label","disabled"])):(m(),b(le,{key:0,label:y.$t("connectWallet"),color:"gradient",block:"",onClick:s(T)},null,8,["label","onClick"]))]),(m(),b(co,{to:"#modal"},[t.value?(m(),b(rs,{key:0,pool:y.pool,onClose:$[2]||($[2]=E=>t.value=!1),onShowStakeModal:$[3]||($[3]=E=>o.value=!0)},null,8,["pool"])):O("",!0),I($o,{pool:y.pool,isVisible:o.value,action:"stake",onClose:$[4]||($[4]=E=>o.value=!1)},null,8,["pool","isVisible"])]))])}}});const Ms=qe($s,[["__scopeId","data-v-7e47c812"]]),Es={class:"w-full"},Ls={class:"text-xs leading-none text-secondary"},Cs={class:"flex justify-between items-center"},Js=V({__name:"AddLiquidityCard",props:{pool:{}},setup(i){const t=ge(i,"pool"),{network:o}=ve,{activeTab:n,resetTabs:a}=it(),{setIsSingleAssetJoin:v}=se(),{isDeepPool:d,isPreMintedBptPool:f}=oe(t);return Ke(()=>a()),ye(n,g=>{v(g===je.SingleToken)}),(g,T)=>{const p=Po,l=to;return m(),b(l,{shadow:"xl",exposeOverflow:"",noBorder:""},{header:M(()=>[j("div",Es,[j("div",Ls,J(s(o).chainName),1),j("div",Cs,[j("h4",null,J(g.$t("addLiquidity")),1),I(Bo,{context:s(Io).invest},null,8,["context"])]),s(d)&&s(f)?(m(),b(p,{key:0,modelValue:s(n),"onUpdate:modelValue":T[0]||(T[0]=c=>Xe(n)?n.value=c:null),tabs:s(be),class:"p-0 m-0 -mb-px whitespace-nowrap",noPad:""},null,8,["modelValue","tabs"])):O("",!0)])]),default:M(()=>[I(Ms,{pool:s(t)},null,8,["pool"])]),_:1})}}}),ct=V({__name:"Col2Layout",props:{cols:{default:"12"},gap:{default:"8"},leftSpan:{default:"6"},rightSpan:{default:"6"},maxWidth:{default:"3xl"}},setup(i){const e=r(()=>({12:"lg:grid-cols-12"})),t=r(()=>({4:"lg:gap-x-4 gap-y-4",8:"lg:gap-x-8 gap-y-8"})),o=r(()=>({"3xl":"max-w-3xl"})),n=r(()=>({5:"col-span-5",6:"col-span-6",7:"col-span-7"}));return(a,v)=>(m(),W("div",{class:ee(`px-4 lg:px-0 mx-auto ${s(o)[a.maxWidth]}`)},[j("div",{class:ee(`grid grid-cols-1 ${s(e)[a.cols]} gap-x-0 ${s(t)[a.gap]}}`)},[j("div",{class:ee(s(n)[a.leftSpan])},[Be(a.$slots,"left")],2),j("div",{class:ee(s(n)[a.rightSpan])},[Be(a.$slots,"right")],2),Be(a.$slots,"default")],2)],2))}});function qs(i){const e=No(),{networkSlug:t}=xe(),{shouldDisableJoins:o}=jo(i);o.value&&n(i.id);function n(a){e.push({name:"pool",params:{id:a,networkSlug:t}})}}const js=V({__name:"Page",props:{pool:{}},setup(i){const e=i,t=ge(e,"pool");Ko(t),qs(e.pool);const{isDeepPool:o}=oe(t),{isMobile:n}=ze();return(a,v)=>(m(),b(ct,{leftSpan:"5",rightSpan:"7"},et({right:M(()=>[I(Js,{pool:s(t)},null,8,["pool"])]),default:M(()=>[s(n)?(m(),b(Xo,{key:0,pool:s(t),class:"mt-4",isDeepPool:s(o)},null,8,["pool","isDeepPool"])):O("",!0)]),_:2},[s(n)?void 0:{name:"left",fn:M(()=>[I(lt,{pool:s(t)},null,8,["pool"])]),key:"0"}]),1024))}}),ca=V({__name:"add-liquidity",setup(i){const t=Ho().params.id.toLowerCase();Fo(t);const{pool:o,isLoadingPool:n,refetchOnchainPoolData:a}=tt(),{isDeepPool:v}=oe(o),{isMobile:d}=ze(),f=r(()=>v.value&&!Le.value),g=r(()=>n.value||f.value);return st(a,Qe*20),(T,p)=>{const l=we;return m(),W("div",null,[s(g)||!s(o)?(m(),b(ct,{key:0,leftSpan:"5",rightSpan:"7"},et({right:M(()=>[I(l,{class:"h-96"})]),_:2},[s(d)?void 0:{name:"left",fn:M(()=>[I(l,{class:"h-24"})]),key:"0"}]),1024)):(m(),b(js,{key:1,pool:s(o)},null,8,["pool"]))])}}});export{ca as default};
//# sourceMappingURL=add-liquidity-94c1d692.js.map
