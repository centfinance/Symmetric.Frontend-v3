{"version":3,"file":"subgraph-fallback.service-7e7c32be.js","sources":["../../src/services/balancer/subgraph/subgraph-fallback.service.ts"],"sourcesContent":["import axios, { AxiosResponse } from 'axios';\nimport { computed, ref } from 'vue';\n\nimport { configService } from '@/services/config/config.service';\nimport { captureBalancerException } from '@/lib/utils/errors';\n\nconst DECENTRALIZED_SUBGRAPH_URL = 'https://gateway.thegraph.com';\n\nexport class SubgraphFallbackService {\n  private urlIndex = ref(0);\n\n  public url = computed(() => {\n    return this.urls[this.urlIndex.value];\n  });\n\n  constructor(private readonly urls = configService.subgraphUrls || []) {\n    console.log(urls);\n  }\n\n  public async get(payload: unknown): Promise<AxiosResponse | void> {\n    if (!payload) {\n      throw new Error('Payload is required');\n    }\n    try {\n      const response = await axios.post(this.url.value, payload);\n      console.log(response);\n      const errorMessage = response?.data.errors?.message;\n      if (errorMessage) {\n        throw new Error(errorMessage);\n      }\n      return response;\n    } catch (error) {\n      // Capture exception only with decentralized url\n      if (this.url.value.startsWith(DECENTRALIZED_SUBGRAPH_URL)) {\n        captureBalancerException({\n          error,\n          msgPrefix: `GraphQL request to [${\n            this.url.value\n          }] failed with message: ${(error as Error)?.message}`,\n          context: {\n            extra: {\n              Payload: `${JSON.stringify(payload)}`,\n            },\n          },\n        });\n      }\n\n      if (this.urlIndex.value + 1 === this.urls.length) {\n        throw error;\n      }\n\n      this.incrementUrlIndex();\n      return this.get(payload);\n    }\n  }\n\n  private incrementUrlIndex(): void {\n    this.urlIndex.value += 1;\n  }\n}\n\nexport const subgraphFallbackService = new SubgraphFallbackService();\n"],"names":["DECENTRALIZED_SUBGRAPH_URL","SubgraphFallbackService","urls","configService","__publicField","ref","computed","payload","response","axios","errorMessage","_a","error","captureBalancerException","subgraphFallbackService"],"mappings":"wUAMA,MAAMA,EAA6B,+BAE5B,MAAMC,CAAwB,CAOnC,YAA6BC,EAAOC,EAAc,cAAgB,CAAA,EAAI,CAN9DC,EAAA,gBAAWC,EAAI,CAAC,GAEjBD,EAAA,WAAME,EAAS,IACb,KAAK,KAAK,KAAK,SAAS,KAAK,CACrC,GAE4B,KAAA,KAAAJ,EAC3B,QAAQ,IAAIA,CAAI,CAClB,CAEA,MAAa,IAAIK,EAAiD,OAChE,GAAI,CAACA,EACG,MAAA,IAAI,MAAM,qBAAqB,EAEnC,GAAA,CACF,MAAMC,EAAW,MAAMC,EAAM,KAAK,KAAK,IAAI,MAAOF,CAAO,EACzD,QAAQ,IAAIC,CAAQ,EACd,MAAAE,GAAeC,EAAAH,GAAA,YAAAA,EAAU,KAAK,SAAf,YAAAG,EAAuB,QAC5C,GAAID,EACI,MAAA,IAAI,MAAMA,CAAY,EAEvB,OAAAF,QACAI,GAgBP,GAdI,KAAK,IAAI,MAAM,WAAWZ,CAA0B,GAC7Ba,EAAA,CACvB,MAAAD,EACA,UAAW,uBACT,KAAK,IAAI,+BACgBA,GAAA,YAAAA,EAAiB,UAC5C,QAAS,CACP,MAAO,CACL,QAAS,GAAG,KAAK,UAAUL,CAAO,GACpC,CACF,CAAA,CACD,EAGC,KAAK,SAAS,MAAQ,IAAM,KAAK,KAAK,OAClC,MAAAK,EAGR,YAAK,kBAAkB,EAChB,KAAK,IAAIL,CAAO,CACzB,CACF,CAEQ,mBAA0B,CAChC,KAAK,SAAS,OAAS,CACzB,CACF,CAEa,MAAAO,EAA0B,IAAIb"}