var U=Object.defineProperty;var M=(o,t,e)=>t in o?U(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var B=(o,t,e)=>(M(o,typeof t!="symbol"?t+"":t,e),e);import{_ as Y}from"./BalCircle-324fa9cd.js";import{aA as A,ao as F,aw as G,b1 as E,bn as H}from"./BalBtn-cca6788c.js";import{d as _,b as n,p as d,j as i,l as p,q as r,h as $,v as b,z as s,x as Q,i as k,F as T,c as m,m as Z,E as J,G as K,k as I,A as X,u as q,s as ee,ar as te,a as oe}from"./runtime-core.esm-bundler-558f8953.js";import{_ as L}from"./BalAlert-fdfde589.js";import{f as P,a as S,i as se,e as ne,s as ae,g as re,j as ie,p as le}from"./voting.provider-3f46e556.js";import{_ as ce}from"./BalTextInput-57c2e4cc.js";import{u as de,a as ue,_ as pe}from"./TimeLockedVote.vue_vue_type_script_setup_true_lang-4600de65.js";import{_ as me}from"./BalTooltip.vue_vue_type_style_index_0_lang-8bf6235c.js";import{i as _e}from"./validations-969b3a37.js";import{_ as ge}from"./BalChipNew.vue_vue_type_script_setup_true_lang-8ef0bb16.js";import{_ as fe}from"./TokenPills.vue_vue_type_script_setup_true_lang-7a301204.js";import{g as he,Q as ve,aa as be,c as ye}from"./connector-16147cef.js";import{c as xe,an as ke}from"./usePoolHelpers-eb955974.js";import{a as we,G as Se}from"./useVotingPools-44058ee3.js";import{c as Ve}from"./urls-2a720267.js";import{_ as $e}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Ae}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-f37eca6e.js";import{_ as Te}from"./ConfirmationIndicator.vue_vue_type_script_setup_true_lang-35a245bf.js";import{u as Be}from"./useTxState-3f0a759d.js";import{a as Ce}from"./useTransactions-114fc9d7.js";import{i as C}from"./useFakeModal-a0a71e6c.js";import"./useDarkMode-6a81be08.js";import"./browser-6c45db04.js";import"./_commonjsHelpers-87174ba5.js";import"./metamask.connector-0225016b.js";import"./useVeBAL-5fa15e49.js";import"./index-155f0d25.js";import"./liquidity-gauge-c56bdf84.js";import"./helpers-7076a817.js";import"./BalChip-951d5b52.js";import"./numeral-77821a11.js";import"./BalAsset-fcab7531.js";import"./Avatar.vue_vue_type_script_setup_true_lang-5ab9890e.js";import"./pools-18fd7fb0.js";import"./useQueryHelpers-8fe10019.js";import"./BalStack.vue_vue_type_script_lang-342e535e.js";import"./wallet-logos-346092ca.js";import"./anime.es-de4e5aa0.js";import"./BalLink-65772d8f.js";import"./index-fe1d1633.js";import"./events-5f626723.js";import"./readable-browser-a0df197a.js";import"./immutable-2b056f5a.js";import"./index-1de0572e.js";const Fe={class:"px-4 lg:px-0 mx-auto max-w-6xl"},Ge={key:0,class:"grid grid-cols-1 lg:grid-cols-10 gap-x-8 g:gap-x-8 gap-y-8"},Ie={class:"lg:col-span-4"},Le={class:"lg:col-span-6"},Pe={key:1,class:"flex justify-center"},Re={class:"w-3/5"},ze=_({__name:"VotingLayout",props:{isOneColumn:{type:Boolean,default:!1}},setup(o){return(t,e)=>(n(),d("div",Fe,[t.isOneColumn?(n(),d("div",Pe,[r("div",Re,[$(t.$slots,"right")])])):(n(),d("div",Ge,[i(A,null,{default:p(()=>[r("div",Ie,[$(t.$slots,"left")])]),_:3}),r("div",Le,[$(t.$slots,"right")]),$(t.$slots,"default")]))]))}}),We={class:"flex justify-between p-2"},Ne={key:0},Oe={key:1},je={key:0,class:"mt-3 ml-2 text-sm text-red-500"},R=_({__name:"VoteAllocation",props:{message:{},shares:{},error:{type:Boolean,default:!1},withDecimals:{type:Boolean,default:!1}},setup(o){const t=o;return(e,a)=>(n(),d(T,null,[r("div",{class:Q(["p-2 mb-2 text-base font-semibold rounded-lg border",t.error?"bg-red-50 dark:bg-red-500/10 border-red-200 dark:border-red-900 text-black dark:text-white":"bg-gray-100 dark:bg-gray-800 border-gray-100 dark:border-gray-800"])},[r("div",We,[r("div",null,b(t.message),1),e.withDecimals?(n(),d("div",Ne,b(s(P)(t.shares.toString()))+" % ",1)):(n(),d("div",Oe,b(t.shares)+" %",1))])],2),e.error?(n(),d("div",je," Your votes canâ€™t exceed 100% ")):k("",!0)],64))}}),De={class:"font-semibold"},Ue={class:"text-gray-500"},Me=_({__name:"OverLimitVote",props:{pool:{}},setup(o){const t=o,{lpVoteOverLimitWarning:e}=de(t.pool);return(a,c)=>{const u=F,l=me;return s(e)?(n(),m(l,{key:0,textAlign:"left"},{activator:p(()=>[i(u,{class:"ml-1",name:"alert-triangle",size:"sm"})]),default:p(()=>[r("div",null,[r("span",De,b(s(e).title),1),r("p",Ue,b(s(e).description),1)])]),_:1})):k("",!0)}}}),Ye={class:"flex items-center py-2 px-3"},Ee={class:"flex justify-center items-center w-8 h-8 bg-gray-50 dark:bg-gray-800 rounded shadow-sm"},He=["src","alt"],z=_({__name:"VotePoolDetails",props:{pool:{}},setup(o){const{getIsGaugeExpired:t}=S();return(e,a)=>(n(),d("div",Ye,[r("div",Ee,[r("img",{src:s(Ve)(s(he)(e.pool.network)),alt:e.pool.network.toString(),class:"w-6 h-6"},null,8,He)]),i(fe,{class:"pl-6 font-semibold",tokens:s(we)(e.pool),isStablePool:s(xe)(e.pool.poolType)||s(ke)(e.pool.poolType)},null,8,["tokens","isStablePool"]),s(se)(e.pool)?(n(),m(ge,{key:0,class:"ml-2"})):k("",!0),s(t)(e.pool.gauge.address)?(n(),m(ue,{key:1,class:"ml-2"})):k("",!0)]))}}),Qe={class:"flex items-center pl-16 mt-1 h-full text-sm text-gray-500 dark:text-gray-300"},W=_({__name:"VotePoolFooter",props:{pool:{}},setup(o){return(t,e)=>(n(),d("div",Qe,b(t.pool.symbol),1))}}),Ze=o=>(J("data-v-25962d3f"),o=o(),K(),o),Je={class:"special-input"},Ke={class:"flex items-center px-2 h-full"},Xe=Ze(()=>r("span",{class:"text-xl text-black dark:text-white"},"%",-1)),qe=_({__name:"VoteInput",props:{pool:{},modelValue:{default:""}},emits:["update:modelValue"],setup(o,{emit:t}){const e=[_e()];return(a,c)=>{const u=ce;return n(),d("div",Je,[i(u,Z({modelValue:a.modelValue},a.$attrs,{class:"mb-2",type:"number",name:"poolVote",rules:e,inputAlignRight:"",placeholder:"0",onInput:c[0]||(c[0]=l=>t("update:modelValue",l))}),{prepend:p(()=>[i(z,{pool:a.pool},null,8,["pool"])]),append:p(()=>[r("div",Ke,[Xe,i(pe,{class:"ml-2",pool:a.pool},null,8,["pool"]),i(Me,{class:"ml-2",pool:a.pool},null,8,["pool"])])]),footer:p(()=>[i(W,{pool:a.pool},null,8,["pool"])]),_:1},16,["modelValue"])])}}});const et=$e(qe,[["__scopeId","data-v-25962d3f"]]),tt=_({__name:"VoteInputList",setup(o){const{selectedPools:t,votingRequest:e,hasExpiredPoolsSelected:a,hasTimeLockedPools:c,totalAllocatedWeight:u,isVotingRequestValid:l,isRequestingTooMuchWeight:y,isInputDisabled:v,goToSubmissionStep:x}=S();return(g,f)=>{const V=L,O=G;return n(),d("div",null,[s(c)?(n(),m(V,{key:0,type:"tip",class:"mb-3",title:"You have a timelocked pool gauge",description:"You are not able to edit the votes on any pool gauge that you voted on within the last 10 days."})):k("",!0),s(a)?(n(),m(V,{key:1,type:"tip",class:"mb-3",title:"You have an expired pool",description:"Votes for expired pools must be removed. Select other pools from the veBAL page to reallocate these votes."})):k("",!0),(n(!0),d(T,null,I(s(t),(w,j)=>(n(),m(et,{key:w.gauge.address,modelValue:s(e)[w.gauge.address],"onUpdate:modelValue":D=>s(e)[w.gauge.address]=D,pool:w,disabled:s(v)(w),autoFocus:j===0},null,8,["modelValue","onUpdate:modelValue","pool","disabled","autoFocus"]))),128)),i(R,{message:"Total vote allocation",shares:s(u),error:s(y)},null,8,["shares","error"]),i(O,{class:"mt-3",size:"md",label:"Next",color:"gradient",disabled:!s(l),block:"",onClick:s(x)},null,8,["disabled","onClick"])])}}});class ot{constructor(t=ve,e=E){B(this,"abi");this.config=t,this.walletService=e,this.abi=Se}get address(){return this.config.network.addresses.gaugeController}async voteForManyGaugeWeights(t,e,a={}){return await this.walletService.txBuilder.contract.sendTransaction({contractAddress:this.address,abi:this.abi,action:"vote_for_many_gauge_weights",params:[t,e],options:a})}voteForGaugeWeights(t,e,a={}){return this.walletService.txBuilder.contract.sendTransaction({contractAddress:this.address,abi:this.abi,action:"vote_for_gauge_weights",params:[t,e],options:a})}}const st=new ot,{txState:nt,resetTxState:at}=Be();function N(){return{txState:nt,resetTxState:at}}const{txState:h}=N();function rt({request:o,expiredGauges:t,gaugeControllerService:e=st}){const{addTransaction:a}=Ce(),c=u();function u(){return o.length>8?[l(1),l(2)]:[l()]}function l(g=1){const f=dt(o,g),V=()=>y(f);return{label:lt(o,t),loadingLabel:"Confirm voting in wallet",confirmingLabel:"Voting",stepTooltip:it(g),action:V}}async function y(g){h.init=!0;try{const f=await ct(g,e);return h.confirming=!0,a({id:f.hash,type:"tx",action:"voteForGauge",summary:ut(g),details:pt(g)}),f}catch(f){throw h.confirming=!1,console.log(f),new Error("Failed to submit votes.",{cause:f})}finally{h.init=!1}}async function v(g,f){console.log("Voting receipt",g),ae(),h.receipt=g,h.confirmedAt=f,h.confirmed=!0,h.confirming=!1}function x(){h.confirming=!1}return{txState:h,votingActions:c,handleSuccess:v,handleFailed:x}}function it(o){return o===1?"Confirm first batch of votes":o===2?"Confirm second batch of votes":""}function lt(o,t){return ne(o.map(e=>e.gaugeAddress),t)?o.length>1?"Remove votes":"Remove vote":o.length>1?"Confirm votes":"Confirm vote"}async function ct(o,t){const e=o.map(l=>l.gaugeAddress),a=o.map(l=>re(l.weight)),c=new Array(8-e.length).fill(be.ZeroAddress),u=new Array(8-e.length).fill(ye.from(0));return console.log("Voting:",{addresses:[...e,...c],weights:[...a.map(l=>l.toNumber()),...u.map(l=>l.toNumber())]}),await t.voteForManyGaugeWeights([...e,...c],[...a,...u])}function dt(o,t){return t===2?o.slice(8):o.length>=8?o.slice(0,8):o}function ut(o){return o.length>1?`Voting on ${o.length} pools`:"Voting on 1 pool"}function pt(o){return{gaugeAddresses:o.map(t=>t.gaugeAddress),votes:o.map(t=>t.weight)}}const mt={key:1},_t=_({__name:"VotingActions",props:{request:{},expiredGauges:{}},setup(o){const t=o,{handleFailed:e,handleSuccess:a,txState:c,votingActions:u}=rt(t);return(l,y)=>{const v=G;return n(),m(A,null,{default:p(()=>[!s(c).confirmed||!s(c).receipt?(n(),m(Ae,{key:0,actions:s(u),primaryActionType:"voteForGauge",onSuccess:s(a),onFailed:s(e)},null,8,["actions","onSuccess","onFailed"])):(n(),d("div",mt,[i(Te,{txReceipt:s(c).receipt},null,8,["txReceipt"]),i(v,{tag:"router-link",to:{name:"vebal",params:{networkSlug:"ethereum"}},color:"gray",outline:"",block:"",class:"mt-2"},{default:p(()=>[X(" Return to veBAL list ")]),_:1})]))]),_:1})}}}),gt={class:"p-1 mb-2 text-base dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-800 shadow-inner"},ft={class:"flex justify-between"},ht={class:"mt-2"},vt={class:"flex items-center pr-4 h-full font-semibold"},bt={class:"text-xl text-black dark:text-white"},yt=_({__name:"ConfirmedVote",props:{pool:{}},setup(o){const{votingRequest:t}=S();return(e,a)=>(n(),d("div",gt,[r("div",ft,[i(z,{pool:e.pool},null,8,["pool"]),r("div",ht,[r("div",vt,[r("span",bt,b(s(P)(s(t)[e.pool.gauge.address]))+" % ",1)])])]),i(W,{pool:e.pool},null,8,["pool"])]))}}),xt=_({__name:"VotingSubmission",setup(o){const{unlockedSelectedPools:t,totalAllocatedWeight:e,expiredGauges:a,confirmedVotingRequest:c,shouldBatchVotes:u}=S();return(l,y)=>{const v=L;return n(),d("div",null,[s(u)?(n(),m(v,{key:0,type:"tip",class:"mb-3",title:"Your votes have been batched",description:"The protocol only supports up to 8 votes per transaction, so additional votes will be confirmed afterwards."})):k("",!0),(n(!0),d(T,null,I(s(t),x=>(n(),m(yt,{key:x.gauge.address,pool:x},null,8,["pool"]))),128)),i(R,{message:"Total vote allocation",shares:s(e),withDecimals:""},null,8,["shares"]),i(_t,{request:s(c),expiredGauges:s(a)},null,8,["request","expiredGauges"])])}}}),kt=r("div",{class:"p-3 w-full"},[r("h6",null,"How it works")],-1),wt={class:"p-3 -mt-2"},St={class:"flex justify-between items-center w-full"},Vt={class:"flex items-center"},$t=_({__name:"MultiVoting",setup(o){const{isSubmissionStep:t}=S(),{txState:e,resetTxState:a}=N(),c=q(()=>e.confirmed?"Your votes were registered ðŸŽ‰":"Pool gauge voting");return ee(()=>a()),(u,l)=>{const y=H,v=F,x=Y;return n(),d("div",null,[i(ze,{isOneColumn:s(e).confirmed},te({right:p(()=>[i(y,{class:"relative card-container",shadow:"xl",noBorder:""},{header:p(()=>[r("div",St,[r("div",Vt,[s(e).confirmed?(n(),m(x,{key:0,size:"8",color:"green",class:"mr-2 text-white"},{default:p(()=>[i(v,{name:"check"})]),_:1})):k("",!0),r("h4",null,b(s(c)),1)])])]),default:p(()=>[s(t)?(n(),m(A,{key:1,name:"appear",appear:""},{default:p(()=>[i(xt)]),_:1})):(n(),m(tt,{key:0}))]),_:1})]),_:2},[s(e).confirmed?void 0:{name:"left",fn:p(()=>[i(y,{noPad:"",shadow:"none"},{default:p(()=>[kt,r("div",wt," Your vote directs liquidity mining emissions for the future periods starting next Thursday at 0:00 UTC. Voting power is set at the time of a vote. If you get more veBAL later, resubmit your vote to use your increased power. Votes are timelocked for 10 days. If you vote now, no edits can be made until "+b(s(ie)())+". ",1)]),_:1})]),key:"0"}]),1032,["isOneColumn"])])}}}),bo=_({__name:"vebal-voting",setup(o){return le(),C.value=!0,oe(()=>C.value=!1),(t,e)=>(n(),m($t))}});export{bo as default};
//# sourceMappingURL=vebal-voting-9b83816e.js.map
