var ze=Object.defineProperty;var De=(t,s,a)=>s in t?ze(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var W=(t,s,a)=>(De(t,typeof s!="symbol"?s+"":s,a),a);import{d as Ue,u as y,b as U,p as $,q as $e,x as j,h as je,A as Je,v as He,i as Ze,aj as Ke,r as Y,al as Qe}from"./runtime-core.esm-bundler-558f8953.js";import{at as Ge,b5 as J,b2 as Ye,aT as Xe,aM as et,aJ as tt,av as nt,aq as st}from"./BalBtn-cca6788c.js";import{_ as ot}from"./_plugin-vue_export-helper-c27b6911.js";import{ag as X,B as C,aa as ee,Q as w,c as H,U as A,Z as k,T as Z,i as at,R as rt,ah as it,o as lt}from"./connector-16147cef.js";import{u as ut}from"./usePoolsQuery-5de67548.js";import{b as dt,a as ct}from"./useTransactions-114fc9d7.js";import{p as pt,C as te,w as ft}from"./usePoolHelpers-eb955974.js";import{d as S}from"./index-18b6daea.js";import{r as yt}from"./index-ee18f997.js";const mt=Ue({name:"BalRadio",props:{checked:{type:Boolean,default:!1},name:{type:String,required:!0},value:{type:[String,Number],required:!0},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},disabled:{type:Boolean,default:!1},size:{type:String,default:"md",validator:t=>["sm","md","lg"].includes(t)},color:{type:String,default:"blue",validator:t=>["blue"].includes(t)}},emits:["update:modelValue"],setup(t,{emit:s}){function a(m){t.disabled||s("update:modelValue",m)}const i=y(()=>{switch(t.size){case"sm":return"w-3 h-3";case"lg":return"w-6 h-6";default:return"w-4 h-4"}}),r=y(()=>{switch(t.size){case"sm":return"leading-none text-sm";case"lg":return"leading-none text-lg";default:return"leading-none text-base"}}),u=y(()=>t.disabled?"text-gray-500":`text-${t.color}-500`),d=y(()=>t.disabled?"cursor-not-allowed":"cursor-pointer"),f=y(()=>({[i.value]:!0,[u.value]:!0,[d.value]:!0})),c=y(()=>({[r.value]:!0,[d.value]:!0}));return{onChange:a,inputClasses:f,labelClasses:c}}});const gt={class:"inline-flex items-start"},vt=["value","checked","name","disabled"],ht=["for"];function kt(t,s,a,i,r,u){return U(),$("div",gt,[$e("input",{type:"radio",autofocus:"",value:t.value,checked:t.modelValue===t.value||t.checked,name:t.name,class:j(["bal-radio-input",t.inputClasses]),disabled:t.disabled,onClick:s[0]||(s[0]=d=>t.onChange(t.value))},null,10,vt),t.$slots.label||t.label?(U(),$("label",{key:0,for:t.name,class:j(["bal-radio-label",t.labelClasses]),onClick:s[1]||(s[1]=Ge(d=>t.onChange(t.value),["prevent"]))},[je(t.$slots,"label",{},()=>[Je(He(t.label),1)])],10,ht)):Ze("",!0)])}const $t=ot(mt,[["render",kt]]),Tt=[{inputs:[{internalType:"contract IVault",name:"vault",type:"address"},{internalType:"contract IProtocolFeePercentagesProvider",name:"protocolFeeProvider",type:"address"},{internalType:"string",name:"factoryVersion",type:"string"},{internalType:"string",name:"poolVersion",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[],name:"FactoryDisabled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"pool",type:"address"}],name:"PoolCreated",type:"event"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"symbol",type:"string"},{internalType:"contract IERC20[]",name:"tokens",type:"address[]"},{internalType:"uint256[]",name:"normalizedWeights",type:"uint256[]"},{internalType:"contract IRateProvider[]",name:"rateProviders",type:"address[]"},{internalType:"uint256",name:"swapFeePercentage",type:"uint256"},{internalType:"address",name:"owner",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"}],name:"create",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"disable",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"}],name:"getActionId",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getAuthorizer",outputs:[{internalType:"contract IAuthorizer",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCreationCode",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCreationCodeContracts",outputs:[{internalType:"address",name:"contractA",type:"address"},{internalType:"address",name:"contractB",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPauseConfiguration",outputs:[{internalType:"uint256",name:"pauseWindowDuration",type:"uint256"},{internalType:"uint256",name:"bufferPeriodDuration",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPoolVersion",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"getProtocolFeePercentagesProvider",outputs:[{internalType:"contract IProtocolFeePercentagesProvider",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getVault",outputs:[{internalType:"contract IVault",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isDisabled",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"pool",type:"address"}],name:"isPoolFromFactory",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}];var bt=yt();function wt(t,s,a){if(t instanceof Uint8Array)return a?new Uint8Array(t):t;if(typeof t=="string"&&t.match(/^0x([0-9a-f][0-9a-f])*$/i)){const i=new Uint8Array((t.length-2)/2);let r=2;for(let u=0;u<i.length;u++)i[u]=parseInt(t.substring(r,r+2),16),r+=2;return i}throw new Error("invalid BytesLike value")}function ne(t,s){return wt(t,s,!1)}const K="0123456789abcdef";function At(t){const s=ne(t);let a="0x";for(let i=0;i<s.length;i++){const r=s[i];a+=K[(r&240)>>4]+K[r&15]}return a}function Pt(t,s,a){const i=ne(t),r=new Uint8Array(s);return r.fill(0),a?r.set(i,s-i.length):r.set(i,0),At(r)}function St(t,s){return Pt(t,s,!1)}function Ct(t){const s=It(t);if(s.length>31)throw new Error("bytes32 string must be less than 32 bytes");return St(s,32)}function It(t,s){s!=null&&(t=t.normalize(s));const a=[];for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(r<128)a.push(r);else if(r<2048)a.push(r>>6|192),a.push(r&63|128);else if((r&64512)==55296){i++;const u=t.charCodeAt(i),d=65536+((r&1023)<<10)+(u&1023);a.push(d>>18|240),a.push(d>>12&63|128),a.push(d>>6&63|128),a.push(d&63|128)}else a.push(r>>12|224),a.push(r>>6&63|128),a.push(r&63|128)}return new Uint8Array(a)}function Ft(){return Ct(Bt(31))}const Bt=t=>{const s=[..."!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"],a=s.length,i=Math.floor(65536/a)*a-1,r=2*Math.ceil(1.1*t);let u="",d=0;for(;d<t;){const f=bt.randomBytes(r);let c=0;const m=(g,h)=>g[h]+(g[h+1]<<8);for(;c<r&&d<t;){const g=m(f,c);c+=2,!(g>i)&&(u+=s[g%a],d++)}}return u},Mt=0;class xt{async create(s,a,i,r,u,d){if(!d.length)return Promise.reject("No pool owner specified");const f=u.map(I=>I.tokenAddress),c=this.calculateTokenWeights(u),m=X(new C(r),18),g=Array(f.length).fill(ee.ZeroAddress),h=[a,i,f,c,g,m.toString(),d,Ft()];return await new J(s.getSigner()).contract.sendTransaction({contractAddress:w.network.addresses.weightedPoolFactory,abi:Tt,action:"create",params:h})}async retrievePoolIdAndAddress(s,a){const i=await s.getTransactionReceipt(a);if(!i)return null;const r=S.WeightedPoolFactory__factory.createInterface(),u=i.logs.filter(m=>m.address===w.network.addresses.weightedPoolFactory).map(m=>{try{return r.parseLog(m)}catch{return null}}).find(m=>(m==null?void 0:m.name)==="PoolCreated");if(!u)return null;const d=u.args.pool;return{id:await S.WeightedPool__factory.connect(d,s).getPoolId(),address:d}}async retrievePoolDetails(s,a){if(!a)return;const i=await this.retrievePoolIdAndAddress(s,a);if(i===null)return;const r=i.address,u=w.network.addresses.vault,d=Ye(),f=new d(w.network.key,s,[...S.WeightedPool__factory.abi,...S.Vault__factory.abi]);f.call("name",r,"name"),f.call("symbol",r,"symbol"),f.call("owner",r,"getOwner"),f.call("weights",r,"getNormalizedWeights"),f.call("tokenInfo",u,"getPoolTokens",[i.id]);const c=await f.execute();return{weights:c.weights.map(g=>Xe(g,18)),name:c.name,owner:c.owner,symbol:c.symbol,tokens:c.tokenInfo.tokens}}async initJoin(s,a,i,r,u,d){const f=et.encode(["uint256","uint256[]"],[Mt,d]),c=this.value(d,u);u=this.parseTokensIn(u);const m={assets:u,maxAmountsIn:d,userData:f,fromInternalBalance:!1},g=w.network.addresses.vault;return await new J(s.getSigner()).contract.sendTransaction({contractAddress:g,abi:S.Vault__factory.abi,action:"joinPool",params:[a,i,r,m],options:{value:c}})}calculateTokenWeights(s){const a=s.map(u=>{const d=new C(u.weight).multipliedBy(new C(1e16));return H.from(d.toString())});return pt(a).map(u=>u.toString())}value(s,a){let i="0";const r=w.network.nativeAsset;return s.forEach((u,d)=>{a[d]===r.address&&(i=u)}),H.from(i)}parseTokensIn(s){const a=w.network.nativeAsset;return s.map(i=>A(i,a.address)?tt:i)}}class se{constructor(){W(this,"weighted");this.weighted=new xt}}new se;class Lt{constructor(){W(this,"pools");this.pools=new se}}const x=new Lt,Nt="1.0",Q="poolCreationState",oe={name:"",seedTokens:[],activeStep:0,initialFee:"0.003",isFeeGovManaged:!1,feeManagementType:"governance",feeType:"fixed",feeController:"self",thirdPartyFeeController:"",fee:"",tokensList:[],poolId:"",poolAddress:"",symbol:"",manuallySetToken:"",autoOptimiseBalances:!1,useNativeAsset:!1,type:te.Weighted,needsSeeding:!1,createPoolTxHash:""},n=Ke({...oe}),G=Y([]),L=Y(null);function jt(){const{balanceFor:t,priceFor:s,getToken:a,nativeAsset:i,wrappedNativeAsset:r,balancerTokenListTokens:u,dynamicDataLoading:d}=nt(),{account:f,getProvider:c}=st(),{txListener:m}=dt(),{addTransaction:g}=ct(),h=y(()=>[...n.tokensList].sort((e,o)=>e>o?1:-1)),N=y(()=>h.value.some(e=>e&&z(e)));function I(){var B,M;const e=h.value.filter(b=>b!==""),o={};if(d.value)return o;let l=e[0],p=k(t(e[0])).times(s(e[0]));for(const b of e){const D=k(t(b)).times(s(b));D.lt(p)&&(p=D,l=b)}let v=((B=n.seedTokens.find(b=>A(b.tokenAddress,l)))==null?void 0:B.weight)||0,T=s(l||"0");if(n.useNativeAsset&&l===r.value.address&&(l=i.address,v=((M=n.seedTokens.find(b=>A(b.tokenAddress,r.value.address)))==null?void 0:M.weight)||0,T=s(r.value.address)),!l)return o;const q=k(T).times(t(l)).div(v);return V(q)}const ae=y(()=>{const e={},o=n.manuallySetToken===i.address?r.value.address:n.manuallySetToken,l=Ae(o);if(!l)return e;const p=k(s(l.tokenAddress||"0")).times(l.amount).div(l.weight);return V(p)}),re=y(()=>Z.sumBy(Object.values(I()),e=>Number(e.liquidityRequired))),ie=y(()=>{let e=k(0);for(const o of h.value)e=e.plus(k(s(o)).times(t(o)));return e}),le=y(()=>{let e=k(0);for(const o of n.seedTokens)e=e.plus(k(o.amount).times(s(o.tokenAddress)));return e}),ue=y(()=>{let e=k(0);for(const o of n.seedTokens)e=e.plus(k(o.amount).times(s(o.tokenAddress)));return e}),de=y(()=>{switch(n.type){case te.Weighted:return"weighted";default:return""}}),ce=y(()=>h.value.filter(o=>o!=="").filter(o=>s(o)===0)),P=y(()=>{var e;return Z.flatten((e=ge.value)==null?void 0:e.pages.map(o=>o.pools))}),pe=y(()=>{var o;return(o=P.value)!=null&&o.length?P.value.find(l=>{if(l.swapFee===n.initialFee){let p=!0;for(const v of l.tokens){const T=n.seedTokens.find(M=>A(M.tokenAddress,v.address)),q=Number(v.weight).toFixed(2),B=(((T==null?void 0:T.weight)||0)/100).toFixed(2);q!==B&&(p=!1)}return p}return!1}):null}),fe=y(()=>at(h.value,ft())),ye=y(()=>n.feeManagementType==="governance"?ee.DelegateOwner:n.feeController==="self"?f.value:n.thirdPartyFeeController),me=y(()=>({tokens:h.value,useExactTokens:!0})),{data:ge,isLoading:ve}=ut(me);function he(){for(const e of Object.keys(n))n[e]=oe[e];_(!1),R()}function ke(e){n.seedTokens=e}function Te(){n.seedTokens.sort((e,o)=>e.tokenAddress.toLowerCase()>o.tokenAddress.toLowerCase()?1:-1)}function be(){!P.value.length&&n.activeStep===1?n.activeStep+=2:n.activeStep+=1,F()}function we(){if(!P.value.length&&n.activeStep===3){n.activeStep-=2;return}n.activeStep-=1,L.value&&_(!1)}function Ae(e){return n.seedTokens.find(o=>A(o.tokenAddress,e))}function Pe(e){n.feeManagementType=e}function Se(e){n.feeType=e}function Ce(e){n.activeStep=e}function Ie(e){n.feeController=e}function Fe(e){n.thirdPartyFeeController=e}function Be(e){G.value=e}function Me(e){n.manuallySetToken=e}function xe(){for(const e of n.seedTokens)e.amount="0"}function Le(){for(const e of n.seedTokens)e.amount=t(e.tokenAddress)}function Ne(e){n.tokensList=e}function V(e){const o={};for(const l of n.seedTokens){const p=k(s(l.tokenAddress)),v=e.times(l.weight),T=v.div(p);o[l.tokenAddress]={liquidityRequired:v.toString(),balanceRequired:T.toString()}}return o}function Re(){return n.seedTokens.map(o=>o.amount)}function E(){return n.seedTokens.map(o=>{const l=a(o.tokenAddress);if(!l)return"0";const p=new C(o.amount);return X(p,l.decimals).toFixed(0,C.ROUND_FLOOR)})}function _e(){let e=!0;const o=n.seedTokens.map(l=>{const p=Math.round(l.weight),v=a(l.tokenAddress);return v||(e=!1),v?`${Math.round(p)}${v.symbol}`:""});return e?o.join("-"):""}async function Oe(){if(N.value)throw new Error("Invalid pool creation due to unlisted tokens.");const e=c(),o=await x.pools.weighted.create(e,n.name,n.symbol,n.initialFee,n.seedTokens,ye.value);return n.createPoolTxHash=o.hash,F(),g({id:o.hash,type:"tx",action:"createPool",summary:n.name,details:{name:n.name}}),m(o,{onTxConfirmed:async()=>{O(o.hash)},onTxFailed:()=>{console.log("Create failed")}}),o}async function qe(){const e=c(),o=n.seedTokens.map(p=>A(p.tokenAddress,r.value.address)&&n.useNativeAsset?i.address:p.tokenAddress),l=await x.pools.weighted.initJoin(e,n.poolId,f.value,f.value,o,E());return g({id:l.hash,type:"tx",action:"fundPool",summary:n.name}),m(l,{onTxConfirmed:async()=>{R()},onTxFailed:()=>{console.log("Seed failed")}}),l}function We(e){n.activeStep=e}function F(){rt(Q,JSON.stringify(n),Nt)}function R(){it(Q)}function Ve(e){for(const o of Object.keys(n))if(o!=="activeStep"){if(o==="seedTokens"){const l=e.seedTokens.filter(p=>!!p.address);n.seedTokens=l;continue}n[o]=e[o]}}function _(e){L.value=e}async function O(e){const o=await x.pools.weighted.retrievePoolIdAndAddress(c(),e);o!==null&&(n.poolId=o.id,n.poolAddress=o.address,n.needsSeeding=!0,F())}async function Ee(e){const o=await x.pools.weighted.retrievePoolDetails(c(),e);o&&(n.seedTokens=o.tokens.map((l,p)=>({tokenAddress:lt(l),weight:Number(o.weights[p])*100,isLocked:!0,amount:"0",id:p.toString()})).filter(l=>!!l.tokenAddress),n.tokensList=o.tokens,n.createPoolTxHash=e,n.activeStep=3,L.value=!0,await O(e))}function z(e){return e!==""&&!u.value[e]}return{...Qe(n),updateTokenWeights:ke,proceed:be,setFeeManagement:Pe,setFeeType:Se,setFeeController:Ie,setTrpController:Fe,setStep:Ce,resetPoolCreationState:he,updateTokenColors:Be,goBack:we,getPoolSymbol:_e,getAmounts:Re,getScaledAmounts:E,createPool:Oe,joinPool:qe,setActiveStep:We,updateManuallySetToken:Me,sortSeedTokens:Te,clearAmounts:xe,setAmountsToMaxBalances:Le,saveState:F,resetState:R,importState:Ve,setRestoredState:_,setTokensList:Ne,retrievePoolAddress:O,retrievePoolDetails:Ee,getOptimisedLiquidity:I,currentLiquidity:le,scaledLiquidity:ae,tokensWithNoPrice:ce,similarPools:P,isLoadingSimilarPools:ve,existingPool:pe,totalLiquidity:ie,maxInitialLiquidity:re,poolLiquidity:ue,poolTypeString:de,tokenColors:G,isWrappedNativeAssetPool:fe,hasUnlistedToken:N,hasRestoredFromSavedState:L,isUnlistedToken:z}}export{Nt as P,$t as _,Q as a,n as p,jt as u};
//# sourceMappingURL=usePoolCreation-dd4e6f0a.js.map
