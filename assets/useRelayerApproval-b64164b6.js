import{cF as O,aq as h,b0 as x,aP as W,aZ as B,a_ as F,au as E,b5 as I,bo as P,cE as q}from"./BalBtn-cca6788c.js";import{u as k,Q as d}from"./connector-16147cef.js";import{d as S}from"./index-18b6daea.js";import{u as p,aj as T,r as u,C as D}from"./runtime-core.esm-bundler-558f8953.js";import{b as H,a as N,C as Q}from"./useTransactions-114fc9d7.js";import{u as j}from"./useGnosisSafeApp-bf4524fc.js";import{i as M}from"./wallet-names-136aa5a2.js";import{a5 as U}from"./usePoolHelpers-eb955974.js";const V={refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1,staleTime:O};function Y(e,v={}){const{account:a,isWalletReady:t}=h(),{networkId:n}=k(),r=p(()=>t.value),f=x(),o=p(()=>new f(d.network.addresses.vault,S.Vault__factory.abi,W.jsonProvider)),y=T(B.Account.RelayerApprovals(n,a,e)),A=async()=>e.value?await o.value.hasApprovedRelayer(a.value,e.value):!0,s=T({enabled:r,...V,...v});return F(y,A,s)}const G=d.network.addresses.vault;function K(e,v=u(!0)){const a=u(!1),t=u(!1),n=u(!1),{getSigner:r,account:f}=h(),o=u(L[e]),{txListener:y}=H(),{addTransaction:A}=N(),{t:s}=E(),c=Y(o),l=p(()=>n.value||(v.value?!!c.data.value:!0)),R=p(()=>c.isLoading.value||c.isError.value),g=p(()=>({label:s("transactionSummary.approveRelayer",[e]),loadingLabel:s("actionSteps.approve.loadingLabel"),confirmingLabel:s("confirming"),stepTooltip:s("approveRelayerTooltip"),action:m}));async function m(){try{a.value=!0;const C=await new I(r()).contract.sendTransaction({contractAddress:d.network.addresses.vault,abi:S.Vault__factory.abi,action:"setRelayerApproval",params:[f.value,o.value,!0]});return a.value=!1,t.value=!0,w(C),C}catch(i){return console.log(i),a.value=!1,t.value=!1,Promise.reject(i)}}async function w(i){A({id:i.hash,type:"tx",action:"approve",summary:s("transactionSummary.approveRelayer",[e]),details:{contractAddress:G,spender:o.value}}),n.value=await y(i,{onTxConfirmed:async()=>{t.value=!1,c.refetch()},onTxFailed:()=>{t.value=!1}})}return{action:g,init:a,approve:m,approving:t,approved:n,isUnlocked:l,loading:R}}let _=U;function Z(){return _||P("Relayer"),_}var z=(e=>(e.COWSWAP="Cowswap",e.LIDO="Lido",e.BATCH="Batch",e))(z||{});const L={Cowswap:Q,Lido:d.network.addresses.lidoRelayer,Batch:d.network.addresses.batchRelayer},b=u("");function oe(e){const{account:v,getSigner:a,connector:t}=h(),{networkId:n}=k(),{t:r}=E(),{isGnosisSafeApp:f}=j(),o=K(e),{supportSignatures:y}=q(),A={label:r("signRelayerApproval"),loadingLabel:r("checkWallet"),confirmingLabel:r("signingRelayerApproval"),stepTooltip:r("signRelayerApprovalTooltip"),action:c,isSignAction:!0},s=p(()=>{var l;return!y.value||f.value||M((l=t.value)==null?void 0:l.id)?o.action.value:A});async function c(){const l=Z(),R=L[e],g=a(),m=await g.getAddress(),w=await l.signRelayerApproval(R,m,g,S.Vault__factory.connect(d.network.addresses.vault,g));b.value=w}return D([v,n],()=>{b.value=""}),{relayerSignature:b,relayerApprovalAction:s,relayerApprovalTx:o}}export{z as R,oe as a,Y as b,K as u};
//# sourceMappingURL=useRelayerApproval-b64164b6.js.map
