var U=Object.defineProperty;var z=(r,t,e)=>t in r?U(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var g=(r,t,e)=>(z(r,typeof t!="symbol"?t+"":t,e),e);import{_ as R}from"./BalAsset-fcab7531.js";import{T as C,Z as j,Q as q,W as I,V as P,o as B,S as G}from"./connector-16147cef.js";import{n as M}from"./numeral-77821a11.js";import{i as Y,S as W}from"./echarts-2876138a.js";import{u as X}from"./useDarkMode-6a81be08.js";import{bp as L,bq as F,br as K,aS as Q,bx as E,aO as Z,ci as J}from"./BalBtn-cca6788c.js";import{u as ee}from"./useTailwind-38f80624.js";import{d as te,r as S,u as $,C as N,o as ae,b as A,c as oe,p as _,q as O,v as D,z as x,x as T,i as re,j as se,y as ie}from"./runtime-core.esm-bundler-558f8953.js";import{r as ne}from"./useTransactions-114fc9d7.js";function le(r){L(1,arguments);var t=K(r);return F(t*1e3)}function ce(r){L(1,arguments);var t=F(r),e=t.getTime();return e}function ue(r){return L(1,arguments),Math.floor(ce(r)/1e3)}function he(r){L(1,arguments);var t=F(r);return t.setMinutes(0,0,0),t}const me={key:0,id:"lineChartHeader",class:"mb-4"},pe={class:"text-xl tracking-wider text-gray-800 dark:text-gray-400"},Fe=te({__name:"BalChart",props:{data:{},chartType:{},onAxisMoved:{},isLoading:{type:Boolean,default:!1},hideYAxis:{type:Boolean,default:!1},hideXAxis:{type:Boolean,default:!1},xAxisMinInterval:{},showHeader:{type:Boolean,default:!1},needChartValue:{type:Boolean,default:!1},axisLabelFormatter:{default:()=>({})},color:{},hoverColor:{},hoverBorderColor:{},height:{},showLegend:{type:Boolean,default:!1},legendState:{},forceResizeTick:{},isLastValueChipVisible:{type:Boolean},customGrid:{},chartClass:{},wrapperClass:{},showTooltip:{type:Boolean,default:!0},showTooltipLayer:{type:Boolean,default:!0},useMinMax:{type:Boolean,default:!1},areaStyle:{}},emits:["periodSelected","setCurrentChartValue","mouseLeaveEvent","mouseEnterEvent"],setup(r,{emit:t}){const e=r;Y();const c=S(),d=S("$0,00"),i=S(0),{fNum:n}=Q(),s=ee(),{darkMode:u}=X(),h=$(()=>({legend:{show:e.showLegend,left:0,top:0,icon:"roundRect",itemHeight:5,formatter:a=>{var l;const o=C.last((l=e.data.find(f=>f.name===a))==null?void 0:l.values);return`${a}: ${n(o[1],e.axisLabelFormatter.yAxis)}`},selected:e.legendState||{},textStyle:{color:u.value?s.theme.colors.gray[100]:s.theme.colors.gray[800]},inactiveColor:u.value?s.theme.colors.gray[700]:s.theme.colors.gray[300]},xAxis:{type:"time",show:!e.hideXAxis,axisTick:{show:!1},axisLine:{show:!1},minInterval:e.xAxisMinInterval,axisLabel:{formatter:e.axisLabelFormatter.xAxis?a=>n(a,e.axisLabelFormatter.xAxis):void 0,color:s.theme.colors.gray[400]},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}},yAxis:{axisLine:{show:!1},axisTick:{show:!1},min:e.useMinMax?"dataMin":null,max:e.useMinMax?"dataMax":null,type:"value",show:!e.hideYAxis,splitNumber:4,splitLine:{show:!1},position:"left",axisLabel:{show:!e.hideYAxis,formatter:e.axisLabelFormatter.yAxis?a=>n(a,e.axisLabelFormatter.yAxis):void 0,color:s.theme.colors.gray[400]},nameGap:25},color:e.color,grid:e.customGrid||{left:"2.5%",right:0,top:"10%",bottom:"5%",containLabel:!0},tooltip:{show:e.showTooltip,showContent:e.showTooltipLayer,trigger:"axis",confine:!0,axisPointer:{type:"shadow",label:{show:!1}},backgroundColor:u.value?s.theme.colors.gray[800]:s.theme.colors.white,borderColor:u.value?s.theme.colors.gray[900]:s.theme.colors.white,formatter:a=>`
            <div class='flex flex-col font-body bg-white dark:bg-gray-850 dark:text-white'>
              <span>${a[0].value[0]}</span>
              ${a.map(o=>`
                    <span>
                      ${o.marker} ${o.seriesName}
                      <span class='font-semibold'>
                        ${n(o.value[1],e.axisLabelFormatter.yAxis)}
                      </span>
                    </span>
                  `).join("")}
            </div>
          `},series:e.data.map((a,o)=>{var l,f;return{data:a.values,type:e.chartType,smooth:.3,showSymbol:!1,name:a.name,silent:!0,animationEasing:function(b){return b===1?1:1-Math.pow(2,-10*b)},lineStyle:{width:2},areaStyle:e.areaStyle,itemStyle:{borderRadius:100},emphasis:{itemStyle:{color:e.hoverColor,borderColor:e.hoverBorderColor}},markLine:{symbol:"roundRect",symbolSize:0,lineStyle:{color:"rgba(0, 0, 0, 0)"},precision:5,label:{backgroundColor:(e.color||[])[o]||"black",borderRadius:3,padding:4,formatter:b=>n(b.data.yAxis,e.axisLabelFormatter.yAxis),color:"#FFF",fontSize:10},data:e.isLastValueChipVisible?[{name:"Latest",yAxis:((l=e.data[o])==null?void 0:l.values.length)>0?(C.last((f=e.data[o])==null?void 0:f.values)||[])[1]:0}]:[],animation:!1}}})})),y=$(()=>{let a={};return e.height&&typeof e.height=="number"&&(a.height=`${e.height}px`),a});N(()=>e.forceResizeTick,()=>{c.value&&c.value.resize()});function m(a){const o=M((e.data[0].values[e.data[0].values.length-1]||[])[1]);if(a){d.value=n(o.value()||0,e.axisLabelFormatter.yAxis||{style:"currency",currency:"USD",fixedFormat:!0});const f=e.data[0].values[0];f&&t("setCurrentChartValue",{chartDate:f[0],chartValue:f[1]})}const l=M((e.data[0].values[0]||[])[1]);i.value=((o.value()||0)-(l.value()||0))/(l.value()||0)}N(()=>e.data,()=>{m(!0)}),ae(()=>{m(!0)});function p(){m(!0),t("mouseLeaveEvent")}function v(){t("mouseEnterEvent")}const H=({dataIndex:a,seriesIndex:o})=>{var l;if(!(!e.showHeader&&!e.needChartValue)&&(l=e.data[o])!=null&&l.values){e.onAxisMoved&&e.onAxisMoved(e.data[o].values[a]);const f=e.data[o].values[a];t("setCurrentChartValue",{chartDate:f[0],chartValue:f[1]});const b=j(e.data[o].values[a][1]).toFixed(6);if(d.value=n(b,e.axisLabelFormatter.yAxis||{style:"currency",currency:"USD",fixedFormat:!0}),a===0){const w=Number(e.data[o].values[0][1]),k=e.data[o].values[e.data[o].values.length-1][1];i.value=(k-w)/w}else{const w=e.data[o].values[a-1][1],k=e.data[o].values[a][1],V=(k-w)/w;if(w===0&&k!==0){i.value=1;return}if(isNaN(V)){i.value=0;return}i.value=V}}};return(a,o)=>{const l=R;return a.isLoading?(A(),oe(l,{key:0,class:"mt-16 h-96"})):(A(),_("div",{key:1,class:T(a.wrapperClass),onMouseenter:v,onTouchstartPassive:v,onMouseleave:p,onTouchend:p},[a.showHeader?(A(),_("div",me,[O("h3",pe,D(x(d)),1),O("span",{class:T({"text-green-400":x(i)>=0,"text-red-400":x(i)<0,"font-medium":!0})},D(x(M)(x(i)).format("+0.0%")),3)])):re("",!0),se(x(W),{ref_key:"chartInstance",ref:c,class:T([a.height&&typeof(a.height==="string")?`h-${a.height}`:"","w-full",a.chartClass]),option:x(h),autoresize:"",updateOptions:{replaceMerge:"series"},style:ie([x(y)]),onUpdateAxisPointer:H},null,8,["class","option","style"])],34))}}});class fe{constructor(t,e=q){g(this,"client");g(this,"fiatParam");g(this,"appNetwork");g(this,"platformId");this.configService=e,this.client=t.client,this.fiatParam=t.supportedFiat,this.appNetwork=this.configService.network.key,this.platformId=ve(this.appNetwork)}async getTokensHistorical(t,e,c=1,d="day"){try{if(t.length/c>10)throw new Error("To many requests for rate limit.");const i=Math.floor(Date.now()/1e3),n=d==="hour"?i:i-i%E,s=n-e*E;t=t.map(I).map(m=>this.addressMapIn(m));const u=[];t.forEach(m=>{const p=`/coins/${this.platformId}/contract/${m.toLowerCase()}/market_chart/range?vs_currency=${this.fiatParam}&from=${s}&to=${n}`,v=ne(this.client.get(p),2,2e3);u.push(v)});const h=await Promise.all(u);return this.parseHistoricalPrices(h,t,s,d)}catch(i){throw console.error("Unable to fetch token prices",t,i),i}}parseHistoricalPrices(t,e,c,d="day"){const i=Object.fromEntries(e.map((s,u)=>{s=this.addressMapOut(s);const h=t[u].prices,y={};if(d==="hour"){const m=C.groupBy(h,p=>ue(he(le(p[0]/1e3))));for(const p of Object.keys(m)){const v=(C.last(m[p])||[])[1]||0;y[Number(p)*1e3]=v}}else if(d==="day")for(const m in h){const[p,v]=h[m];y[p]=v}return[s,y]})),n={};for(const s in i){const u=i[s];for(const h in u){const y=u[h];h in n||(n[h]=[]),n[h].push(y)}}return n}addressMapIn(t){var c;const e=(c=P)==null?void 0:c.PriceChainMap;return e?B(e[t.toLowerCase()]||t):t}addressMapOut(t){var c;const e=(c=P)==null?void 0:c.PriceChainMap;return e?B(C.invert(e)[t.toLowerCase()]||t):t}}class de{constructor(){g(this,"baseUrl");this.baseUrl="https://api.coingecko.com/api/v3"}async get(t){const{data:e}=await Z.get(this.baseUrl+t);return e}}const ye=new de,ve=r=>Object.fromEntries(Object.values(G).map(e=>[e.chainId.toString(),e.thirdParty.coingecko.platformId]))[r]||"ethereum";class ge{constructor(t=ye,e=fe){g(this,"supportedFiat");g(this,"prices");this.client=t,this.supportedFiat=J.join(","),this.prices=new e(this)}}const Ve=new ge;export{Fe as _,Ve as c,le as f};
//# sourceMappingURL=coingecko.service-492c3cc3.js.map
